!function o(a,s,h){function l(r,e){if(!s[r]){if(!a[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(c)return c(r,!0);var i=new Error("Cannot find module '"+r+"'");throw i.code="MODULE_NOT_FOUND",i}var n=s[r]={exports:{}};a[r][0].call(n.exports,function(e){var t=a[r][1][e];return l(t||e)},n,n.exports,o,a,s,h)}return s[r].exports}for(var c="function"==typeof require&&require,e=0;e<h.length;e++)l(h[e]);return l}({1:[function(e,t,r){t.exports=e("./vendor/dat.gui"),t.exports.color=e("./vendor/dat.color")},{"./vendor/dat.color":2,"./vendor/dat.gui":3}],2:[function(e,t,r){var o,i,n,a,s,h,l,c,u,d=t.exports=d||{};d.color=d.color||{},d.utils=d.utils||{},d.utils.common=(o=Array.prototype.forEach,i=Array.prototype.slice,{BREAK:{},extend:function(r){return this.each(i.call(arguments,1),function(e){for(var t in e)this.isUndefined(e[t])||(r[t]=e[t])},this),r},defaults:function(r){return this.each(i.call(arguments,1),function(e){for(var t in e)this.isUndefined(r[t])&&(r[t]=e[t])},this),r},compose:function(){var r=i.call(arguments);return function(){for(var e=i.call(arguments),t=r.length-1;0<=t;t--)e=[r[t].apply(this,e)];return e[0]}},each:function(e,t,r){if(o&&e.forEach===o)e.forEach(t,r);else if(e.length===e.length+0){for(var i=0,n=e.length;i<n;i++)if(i in e&&t.call(r,e[i],i)===this.BREAK)return}else for(var i in e)if(t.call(r,e[i],i)===this.BREAK)return},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():i.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){return e!=e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}}),d.color.toString=(n=d.utils.common,function(e){if(1==e.a||n.isUndefined(e.a)){for(var t=e.hex.toString(16);t.length<6;)t="0"+t;return"#"+t}return"rgba("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+","+e.a+")"}),d.Color=d.color.Color=function(e,i,t,n){var r=function(){if(this.__state=e.apply(this,arguments),!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};function o(e,t,r){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||s(this,t,r),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(s(this,t,r),this.__state.space="RGB"),this.__state[t]=e}})}function a(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||h(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(h(this),this.__state.space="HSV"),this.__state[t]=e}})}function s(e,t,r){if("HEX"===e.__state.space)e.__state[t]=i.component_from_hex(e.__state.hex,r);else{if("HSV"!==e.__state.space)throw"Corrupted color state";n.extend(e.__state,i.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function h(e){var t=i.rgb_to_hsv(e.r,e.g,e.b);n.extend(e.__state,{s:t.s,v:t.v}),n.isNaN(t.h)?n.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h}return r.COMPONENTS=["r","g","b","h","s","v","hex","a"],n.extend(r.prototype,{toString:function(){return t(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),o(r.prototype,"r",2),o(r.prototype,"g",1),o(r.prototype,"b",0),a(r.prototype,"h"),a(r.prototype,"s"),a(r.prototype,"v"),Object.defineProperty(r.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(r.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=i.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),r}(d.color.interpret=(s=d.color.toString,h=d.utils.common,u=[{litmus:h.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString())}},write:s},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString())}},write:s},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:s},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:s}}},{litmus:h.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:h.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3==e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4==e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:h.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b)&&h.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(h.isNumber(e.r)&&h.isNumber(e.g)&&h.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v)&&h.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(h.isNumber(e.h)&&h.isNumber(e.s)&&h.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],function(){c=!1;var r=1<arguments.length?h.toArray(arguments):arguments[0];return h.each(u,function(e){if(e.litmus(r))return h.each(e.conversions,function(e,t){if(l=e.read(r),!1===c&&!1!==l)return(c=l).conversionName=t,l.conversion=e,h.BREAK}),h.BREAK}),c}),d.color.math={hsv_to_rgb:function(e,t,r){var i=Math.floor(e/60)%6,n=e/60-Math.floor(e/60),o=r*(1-t),a=r*(1-n*t),s=r*(1-(1-n)*t),h=[[r,s,o],[a,r,o],[o,r,s],[o,a,r],[s,o,r],[r,o,a]][i];return{r:255*h[0],g:255*h[1],b:255*h[2]}},rgb_to_hsv:function(e,t,r){var i,n=Math.min(e,t,r),o=Math.max(e,t,r),a=o-n;return 0==o?{h:NaN,s:0,v:0}:(i=e==o?(t-r)/a:t==o?2+(r-e)/a:4+(e-t)/a,(i/=6)<0&&(i+=1),{h:360*i,s:a/o,v:o/255})},rgb_to_hex:function(e,t,r){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,r)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,r){return r<<(a=8*t)|e&~(255<<a)}},d.color.toString,d.utils.common)},{}],3:[function(e,t,r){var o,i,n,a,s,h,l,c,u,d,p,f,m,g,v,y,x,_,b,w,M,S,E,T,C,A,L,P,k,R,D,F,V,U,B,O,N,G,I,z,H,j,W,X,q,Y,K,Q,Z=t.exports=Z||{};Z.gui=Z.gui||{},Z.utils=Z.utils||{},Z.controllers=Z.controllers||{},Z.dom=Z.dom||{},Z.color=Z.color||{},Z.utils.css={load:function(e,t){var r=(t=t||document).createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,t.getElementsByTagName("head")[0].appendChild(r)},inject:function(e,t){t=t||document;var r=document.createElement("style");r.type="text/css",r.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(r)}},Z.utils.common=(o=Array.prototype.forEach,i=Array.prototype.slice,{BREAK:{},extend:function(r){return this.each(i.call(arguments,1),function(e){for(var t in e)this.isUndefined(e[t])||(r[t]=e[t])},this),r},defaults:function(r){return this.each(i.call(arguments,1),function(e){for(var t in e)this.isUndefined(r[t])&&(r[t]=e[t])},this),r},compose:function(){var r=i.call(arguments);return function(){for(var e=i.call(arguments),t=r.length-1;0<=t;t--)e=[r[t].apply(this,e)];return e[0]}},each:function(e,t,r){if(o&&e.forEach===o)e.forEach(t,r);else if(e.length===e.length+0){for(var i=0,n=e.length;i<n;i++)if(i in e&&t.call(r,e[i],i)===this.BREAK)return}else for(var i in e)if(t.call(r,e[i],i)===this.BREAK)return},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():i.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){return e!=e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}}),Z.controllers.Controller=(n=function(e,t){this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0},Z.utils.common.extend(n.prototype,{onChange:function(e){return this.__onChange=e,this},onFinishChange:function(e){return this.__onFinishChange=e,this},setValue:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),n),Z.dom.dom=function(l){var c={};l.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){l.each(e,function(e){c[e]=t})});var r=/(\d+(\.\d+)?)px/;function i(e){if("0"===e||l.isUndefined(e))return 0;var t=e.match(r);return l.isNull(t)?0:parseFloat(t[1])}var n={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,r){l.isUndefined(t)&&(t=!0),l.isUndefined(r)&&(r=!0),e.style.position="absolute",t&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,r,i){r=r||{};var n=c[t];if(!n)throw new Error("Event type "+t+" not supported.");var o=document.createEvent(n);switch(n){case"MouseEvents":var a=r.x||r.clientX||0,s=r.y||r.clientY||0;o.initMouseEvent(t,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,a,s,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var h=o.initKeyboardEvent||o.initKeyEvent;l.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(t,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:o.initEvent(t,r.bubbles||!1,r.cancelable||!0)}l.defaults(o,i),e.dispatchEvent(o)},bind:function(e,t,r,i){return i=i||!1,e.addEventListener?e.addEventListener(t,r,i):e.attachEvent&&e.attachEvent("on"+t,r),n},unbind:function(e,t,r,i){return i=i||!1,e.removeEventListener?e.removeEventListener(t,r,i):e.detachEvent&&e.detachEvent("on"+t,r),n},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var r=e.className.split(/ +/);-1==r.indexOf(t)&&(r.push(t),e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return n},removeClass:function(e,t){if(t)if(void 0===e.className);else if(e.className===t)e.removeAttribute("class");else{var r=e.className.split(/ +/),i=r.indexOf(t);-1!=i&&(r.splice(i,1),e.className=r.join(" "))}else e.className=void 0;return n},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return i(t["border-left-width"])+i(t["border-right-width"])+i(t["padding-left"])+i(t["padding-right"])+i(t.width)},getHeight:function(e){var t=getComputedStyle(e);return i(t["border-top-width"])+i(t["border-bottom-width"])+i(t["padding-top"])+i(t["padding-bottom"])+i(t.height)},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent)for(;t.left+=e.offsetLeft,t.top+=e.offsetTop,e=e.offsetParent;);return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return n}(Z.utils.common),Z.controllers.OptionController=(a=Z.controllers.Controller,s=Z.dom.dom,h=Z.utils.common,(l=function(e,t,r){l.superclass.call(this,e,t);var i=this;if(this.__select=document.createElement("select"),h.isArray(r)){var n={};h.each(r,function(e){n[e]=e}),r=n}h.each(r,function(e,t){var r=document.createElement("option");r.innerHTML=t,r.setAttribute("value",e),i.__select.appendChild(r)}),this.updateDisplay(),s.bind(this.__select,"change",function(){var e=this.options[this.selectedIndex].value;i.setValue(e)}),this.domElement.appendChild(this.__select)}).superclass=a,h.extend(l.prototype,a.prototype,{setValue:function(e){var t=l.superclass.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),t},updateDisplay:function(){return this.__select.value=this.getValue(),l.superclass.prototype.updateDisplay.call(this)}}),l),Z.controllers.NumberController=(c=Z.controllers.Controller,u=Z.utils.common,(d=function(e,t,r){var i;d.superclass.call(this,e,t),r=r||{},this.__min=r.min,this.__max=r.max,this.__step=r.step,u.isUndefined(this.__step)?0==this.initialValue?this.__impliedStep=1:this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step,this.__precision=-1<(i=(i=this.__impliedStep).toString()).indexOf(".")?i.length-i.indexOf(".")-1:0}).superclass=c,u.extend(d.prototype,c.prototype,{setValue:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),d.superclass.prototype.setValue.call(this,e)},min:function(e){return this.__min=e,this},max:function(e){return this.__max=e,this},step:function(e){return this.__step=e,this}}),d),Z.controllers.NumberControllerBox=(p=Z.controllers.NumberController,f=Z.dom.dom,m=Z.utils.common,(g=function(e,t,r){this.__truncationSuspended=!1,g.superclass.call(this,e,t,r);var i,n=this;function o(){var e=parseFloat(n.__input.value);m.isNaN(e)||n.setValue(e)}function a(e){var t=i-e.clientY;n.setValue(n.getValue()+t*n.__impliedStep),i=e.clientY}function s(){f.unbind(window,"mousemove",a),f.unbind(window,"mouseup",s)}this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),f.bind(this.__input,"change",o),f.bind(this.__input,"blur",function(){o(),n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),f.bind(this.__input,"mousedown",function(e){f.bind(window,"mousemove",a),f.bind(window,"mouseup",s),i=e.clientY}),f.bind(this.__input,"keydown",function(e){13===e.keyCode&&(n.__truncationSuspended=!0,this.blur(),n.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)}).superclass=p,m.extend(g.prototype,p.prototype,{updateDisplay:function(){var e,t,r;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,r=Math.pow(10,t),Math.round(e*r)/r),g.superclass.prototype.updateDisplay.call(this)}}),g),Z.controllers.NumberControllerSlider=(v=Z.controllers.NumberController,y=Z.dom.dom,x=Z.utils.css,_=Z.utils.common,(b=function(e,t,r,i,n){b.superclass.call(this,e,t,{min:r,max:i,step:n});var h=this;function o(e){e.preventDefault();var t,r,i,n,o,a=y.getOffset(h.__background),s=y.getWidth(h.__background);return h.setValue((t=e.clientX,r=a.left,i=a.left+s,n=h.__min,o=h.__max,n+(t-r)/(i-r)*(o-n))),!1}function a(){y.unbind(window,"mousemove",o),y.unbind(window,"mouseup",a),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),y.bind(this.__background,"mousedown",function(e){y.bind(window,"mousemove",o),y.bind(window,"mouseup",a),o(e)}),y.addClass(this.__background,"slider"),y.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)}).superclass=v,b.useDefaultStyles=function(){x.inject(".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}")},_.extend(b.prototype,v.prototype,{updateDisplay:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",b.superclass.prototype.updateDisplay.call(this)}}),b),Z.controllers.FunctionController=(w=Z.controllers.Controller,M=Z.dom.dom,S=Z.utils.common,(E=function(e,t,r){E.superclass.call(this,e,t);var i=this;this.__button=document.createElement("div"),this.__button.innerHTML=void 0===r?"Fire":r,M.bind(this.__button,"click",function(e){return e.preventDefault(),i.fire(),!1}),M.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)}).superclass=w,S.extend(E.prototype,w.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),E),Z.controllers.BooleanController=(T=Z.controllers.Controller,C=Z.dom.dom,A=Z.utils.common,(L=function(e,t){L.superclass.call(this,e,t);var r=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),C.bind(this.__checkbox,"change",function(){r.setValue(!r.__prev)},!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()}).superclass=T,A.extend(L.prototype,T.prototype,{setValue:function(e){var t=L.superclass.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),t},updateDisplay:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,L.superclass.prototype.updateDisplay.call(this)}}),L),Z.color.toString=(P=Z.utils.common,function(e){if(1==e.a||P.isUndefined(e.a)){for(var t=e.hex.toString(16);t.length<6;)t="0"+t;return"#"+t}return"rgba("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+","+e.a+")"}),Z.color.interpret=(k=Z.color.toString,R=Z.utils.common,V=[{litmus:R.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString())}},write:k},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString())}},write:k},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:k},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:k}}},{litmus:R.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:R.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3==e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4==e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:R.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(R.isNumber(e.r)&&R.isNumber(e.g)&&R.isNumber(e.b)&&R.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(R.isNumber(e.r)&&R.isNumber(e.g)&&R.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(R.isNumber(e.h)&&R.isNumber(e.s)&&R.isNumber(e.v)&&R.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(R.isNumber(e.h)&&R.isNumber(e.s)&&R.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],function(){F=!1;var r=1<arguments.length?R.toArray(arguments):arguments[0];return R.each(V,function(e){if(e.litmus(r))return R.each(e.conversions,function(e,t){if(D=e.read(r),!1===F&&!1!==D)return(F=D).conversionName=t,D.conversion=e,R.BREAK}),R.BREAK}),F}),Z.GUI=Z.gui.GUI=function(e,t,r,l,c,u,d,p,f,i,m,n,o,g,v){e.inject(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");var y,h,x="Default",_=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),b=!0,a=!1,w=[],M=function(t){var r=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),g.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],t=t||{},t=v.defaults(t,{autoPlace:!0,width:M.DEFAULT_WIDTH}),t=v.defaults(t,{resizable:t.autoPlace,hideable:t.autoPlace}),v.isUndefined(t.load)?t.load={preset:x}:t.preset&&(t.load.preset=t.preset),v.isUndefined(t.parent)&&t.hideable&&w.push(this),t.resizable=v.isUndefined(t.parent)&&t.resizable,t.autoPlace&&v.isUndefined(t.scrollable)&&(t.scrollable=!0);var i=_&&"true"===localStorage.getItem(C(this,"isLocal"));if(Object.defineProperties(this,{parent:{get:function(){return t.parent}},scrollable:{get:function(){return t.scrollable}},autoPlace:{get:function(){return t.autoPlace}},preset:{get:function(){return r.parent?r.getRoot().preset:t.load.preset},set:function(e){r.parent?r.getRoot().preset=e:t.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value==e.preset&&(e.__preset_select.selectedIndex=t)}(this),r.revert()}},width:{get:function(){return t.width},set:function(e){t.width=e,A(r,e)}},name:{get:function(){return t.name},set:function(e){t.name=e,n&&(n.innerHTML=t.name)}},closed:{get:function(){return t.closed},set:function(e){t.closed=e,t.closed?g.addClass(r.__ul,M.CLASS_CLOSED):g.removeClass(r.__ul,M.CLASS_CLOSED),this.onResize(),r.__closeButton&&(r.__closeButton.innerHTML=e?M.TEXT_OPEN:M.TEXT_CLOSED)}},load:{get:function(){return t.load}},useLocalStorage:{get:function(){return i},set:function(e){_&&((i=e)?g.bind(window,"unload",a):g.unbind(window,"unload",a),localStorage.setItem(C(r,"isLocal"),e))}}}),v.isUndefined(t.parent)){if(t.closed=!1,g.addClass(this.domElement,M.CLASS_MAIN),g.makeSelectable(this.domElement,!1),_&&i){r.useLocalStorage=!0;var e=localStorage.getItem(C(this,"gui"));e&&(t.load=JSON.parse(e))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=M.TEXT_CLOSED,g.addClass(this.__closeButton,M.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),g.bind(this.__closeButton,"click",function(){r.closed=!r.closed})}else{void 0===t.closed&&(t.closed=!0);var n=document.createTextNode(t.name);g.addClass(n,"controller-name");var o=E(r,n);g.addClass(this.__ul,M.CLASS_CLOSED),g.addClass(o,"title"),g.bind(o,"click",function(e){return e.preventDefault(),r.closed=!r.closed,!1}),t.closed||(this.closed=!1)}function a(){localStorage.setItem(C(r,"gui"),JSON.stringify(r.getSaveObject()))}t.autoPlace&&(v.isUndefined(t.parent)&&(b&&(h=document.createElement("div"),g.addClass(h,"dg"),g.addClass(h,M.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(h),b=!1),h.appendChild(this.domElement),g.addClass(this.domElement,M.CLASS_AUTO_PLACE)),this.parent||A(r,t.width)),g.bind(window,"resize",function(){r.onResize()}),g.bind(this.__ul,"webkitTransitionEnd",function(){r.onResize()}),g.bind(this.__ul,"transitionend",function(){r.onResize()}),g.bind(this.__ul,"oTransitionEnd",function(){r.onResize()}),this.onResize(),t.resizable&&function(t){var r;function e(e){return e.preventDefault(),r=e.clientX,g.addClass(t.__closeButton,M.CLASS_DRAG),g.bind(window,"mousemove",i),g.bind(window,"mouseup",n),!1}function i(e){return e.preventDefault(),t.width+=r-e.clientX,t.onResize(),r=e.clientX,!1}function n(){g.removeClass(t.__closeButton,M.CLASS_DRAG),g.unbind(window,"mousemove",i),g.unbind(window,"mouseup",n)}t.__resize_handle=document.createElement("div"),v.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),g.bind(t.__resize_handle,"mousedown",e),g.bind(t.__closeButton,"mousedown",e),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}(this);var s;r.getRoot();t.parent||((s=r.getRoot()).width+=1,v.defer(function(){s.width-=1}))};function S(e,t,r,i){if(void 0===t[r])throw new Error("Object "+t+' has no property "'+r+'"');var n;if(i.color)n=new m(t,r);else{var o=[t,r].concat(i.factoryArgs);n=l.apply(e,o)}i.before instanceof c&&(i.before=i.before.__li),T(e,n),g.addClass(n.domElement,"c");var a=document.createElement("span");g.addClass(a,"property-name"),a.innerHTML=n.property;var s=document.createElement("div");s.appendChild(a),s.appendChild(n.domElement);var h=E(e,s,i.before);return g.addClass(h,M.CLASS_CONTROLLER_ROW),g.addClass(h,typeof n.getValue()),function(t,r,i){if(i.__li=r,i.__gui=t,v.extend(i,{options:function(e){return 1<arguments.length?(i.remove(),S(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[v.toArray(arguments)]})):v.isArray(e)||v.isObject(e)?(i.remove(),S(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[e]})):void 0},name:function(e){return i.__li.firstElementChild.firstElementChild.innerHTML=e,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof f){var n=new p(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});v.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=i[e],r=n[e];i[e]=n[e]=function(){var e=Array.prototype.slice.call(arguments);return t.apply(i,e),r.apply(n,e)}}),g.addClass(r,"has-slider"),i.domElement.insertBefore(n.domElement,i.domElement.firstElementChild)}else if(i instanceof p){var e=function(e){return v.isNumber(i.__min)&&v.isNumber(i.__max)?(i.remove(),S(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]})):e};i.min=v.compose(e,i.min),i.max=v.compose(e,i.max)}else i instanceof u?(g.bind(r,"click",function(){g.fakeEvent(i.__checkbox,"click")}),g.bind(i.__checkbox,"click",function(e){e.stopPropagation()})):i instanceof d?(g.bind(r,"click",function(){g.fakeEvent(i.__button,"click")}),g.bind(r,"mouseover",function(){g.addClass(i.__button,"hover")}),g.bind(r,"mouseout",function(){g.removeClass(i.__button,"hover")})):i instanceof m&&(g.addClass(r,"color"),i.updateDisplay=v.compose(function(e){return r.style.borderLeftColor=i.__color.toString(),e},i.updateDisplay),i.updateDisplay());i.setValue=v.compose(function(e){return t.getRoot().__preset_select&&i.isModified()&&P(t.getRoot(),!0),e},i.setValue)}(e,h,n),e.__controllers.push(n),n}function E(e,t,r){var i=document.createElement("li");return t&&i.appendChild(t),r?e.__ul.insertBefore(i,params.before):e.__ul.appendChild(i),e.onResize(),i}function T(e,t){var r=e.getRoot(),i=r.__rememberedObjects.indexOf(t.object);if(-1!=i){var n=r.__rememberedObjectIndecesToControllers[i];if(void 0===n&&(n={},r.__rememberedObjectIndecesToControllers[i]=n),n[t.property]=t,r.load&&r.load.remembered){var o,a=r.load.remembered;if(a[e.preset])o=a[e.preset];else{if(!a[x])return;o=a[x]}if(o[i]&&void 0!==o[i][t.property]){var s=o[i][t.property];t.initialValue=s,t.setValue(s)}}}}function C(e,t){return document.location.href+"."+t}function A(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function s(n,o){var a={};return v.each(n.__rememberedObjects,function(e,t){var r={},i=n.__rememberedObjectIndecesToControllers[t];v.each(i,function(e,t){r[t]=o?e.initialValue:e.getValue()}),a[t]=r}),a}function L(e,t,r){var i=document.createElement("option");i.innerHTML=t,i.value=t,e.__preset_select.appendChild(i),r&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function P(e,t){var r=e.__preset_select[e.__preset_select.selectedIndex];r.innerHTML=t?r.value+"*":r.value}return M.toggleHide=function(){a=!a,v.each(w,function(e){e.domElement.style.zIndex=a?-999:999,e.domElement.style.opacity=a?0:1})},M.CLASS_AUTO_PLACE="a",M.CLASS_AUTO_PLACE_CONTAINER="ac",M.CLASS_MAIN="main",M.CLASS_CONTROLLER_ROW="cr",M.CLASS_TOO_TALL="taller-than-window",M.CLASS_CLOSED="closed",M.CLASS_CLOSE_BUTTON="close-button",M.CLASS_DRAG="drag",M.DEFAULT_WIDTH=245,M.TEXT_CLOSED="Close Controls",M.TEXT_OPEN="Open Controls",g.bind(window,"keydown",function(e){"text"===document.activeElement.type||72!==e.which&&72!=e.keyCode||M.toggleHide()},!1),v.extend(M.prototype,{add:function(e,t){return S(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return S(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;v.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&h.removeChild(this.domElement)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var r=new M(t);this.__folders[e]=r;var i=E(this,r.domElement);return g.addClass(i,"folder"),r},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=g.getOffset(t.__ul).top,r=0;v.each(t.__ul.childNodes,function(e){t.autoPlace&&e===t.__save_row||(r+=g.getHeight(e))}),window.innerHeight-e-20<r?(g.addClass(t.domElement,M.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(g.removeClass(t.domElement,M.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&v.defer(function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"}),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},remember:function(){if(v.isUndefined(y)&&((y=new o).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;v.each(Array.prototype.slice.call(arguments),function(e){0==t.__rememberedObjects.length&&function(r){var e=r.__save_row=document.createElement("li");g.addClass(r.domElement,"has-save"),r.__ul.insertBefore(e,r.__ul.firstChild),g.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",g.addClass(t,"button gears");var i=document.createElement("span");i.innerHTML="Save",g.addClass(i,"button"),g.addClass(i,"save");var n=document.createElement("span");n.innerHTML="New",g.addClass(n,"button"),g.addClass(n,"save-as");var o=document.createElement("span");o.innerHTML="Revert",g.addClass(o,"button"),g.addClass(o,"revert");var a=r.__preset_select=document.createElement("select");r.load&&r.load.remembered?v.each(r.load.remembered,function(e,t){L(r,t,t==r.preset)}):L(r,x,!1);if(g.bind(a,"change",function(){for(var e=0;e<r.__preset_select.length;e++)r.__preset_select[e].innerHTML=r.__preset_select[e].value;r.preset=this.value}),e.appendChild(a),e.appendChild(t),e.appendChild(i),e.appendChild(n),e.appendChild(o),_){var s=document.getElementById("dg-save-locally"),h=document.getElementById("dg-local-explain");s.style.display="block";var l=document.getElementById("dg-local-storage");function c(){h.style.display=r.useLocalStorage?"block":"none"}"true"===localStorage.getItem(C(r,"isLocal"))&&l.setAttribute("checked","checked"),c(),g.bind(l,"change",function(){r.useLocalStorage=!r.useLocalStorage,c()})}var u=document.getElementById("dg-new-constructor");g.bind(u,"keydown",function(e){!e.metaKey||67!==e.which&&67!=e.keyCode||y.hide()}),g.bind(t,"click",function(){u.innerHTML=JSON.stringify(r.getSaveObject(),void 0,2),y.show(),u.focus(),u.select()}),g.bind(i,"click",function(){r.save()}),g.bind(n,"click",function(){var e=prompt("Enter a new preset name.");e&&r.saveAs(e)}),g.bind(o,"click",function(){r.revert()})}(t),-1==t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&A(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var r=this.load;return r.closed=this.closed,0<this.__rememberedObjects.length&&(r.preset=this.preset,r.remembered||(r.remembered={}),r.remembered[this.preset]=s(this)),r.folders={},v.each(this.__folders,function(e,t){r.folders[t]=e.getSaveObject()}),r},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=s(this),P(this,!1)},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[x]=s(this,!0)),this.load.remembered[e]=s(this),this.preset=e,L(this,e,!0)},revert:function(t){v.each(this.__controllers,function(e){this.getRoot().load.remembered?T(t||this.getRoot(),e):e.setValue(e.initialValue)},this),v.each(this.__folders,function(e){e.revert(e)}),t||P(this.getRoot(),!1)},listen:function(e){var t=0==this.__listening.length;this.__listening.push(e),t&&function e(t){0!=t.length&&n(function(){e(t)});v.each(t,function(e){e.updateDisplay()})}(this.__listening)}}),M}(Z.utils.css,0,0,Z.controllers.factory=(G=Z.controllers.OptionController,I=Z.controllers.NumberControllerBox,z=Z.controllers.NumberControllerSlider,H=Z.controllers.StringController=(q=Z.controllers.Controller,Y=Z.dom.dom,K=Z.utils.common,(Q=function(e,t){Q.superclass.call(this,e,t);var r=this;function i(){r.setValue(r.__input.value)}this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),Y.bind(this.__input,"keyup",i),Y.bind(this.__input,"change",i),Y.bind(this.__input,"blur",function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}),Y.bind(this.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)}).superclass=q,K.extend(Q.prototype,q.prototype,{updateDisplay:function(){return Y.isActive(this.__input)||(this.__input.value=this.getValue()),Q.superclass.prototype.updateDisplay.call(this)}}),Q),j=Z.controllers.FunctionController,W=Z.controllers.BooleanController,X=Z.utils.common,function(e,t){var r=e[t];return X.isArray(arguments[2])||X.isObject(arguments[2])?new G(e,t,arguments[2]):X.isNumber(r)?X.isNumber(arguments[2])&&X.isNumber(arguments[3])?new z(e,t,arguments[2],arguments[3]):new I(e,t,{min:arguments[2],max:arguments[3]}):X.isString(r)?new H(e,t):X.isFunction(r)?new j(e,t,""):X.isBoolean(r)?new W(e,t):void 0}),Z.controllers.Controller,Z.controllers.BooleanController,Z.controllers.FunctionController,Z.controllers.NumberControllerBox,Z.controllers.NumberControllerSlider,Z.controllers.OptionController,Z.controllers.ColorController=function(e,u,d,p,f){var m=function(e,t){m.superclass.call(this,e,t),this.__color=new d(this.getValue()),this.__temp=new d(0);var o=this;this.domElement=document.createElement("div"),u.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",u.bind(this.__input,"keydown",function(e){13===e.keyCode&&s.call(this)}),u.bind(this.__input,"blur",s),u.bind(this.__selector,"mousedown",function(e){u.addClass(this,"drag").bind(window,"mouseup",function(e){u.removeClass(o.__selector,"drag")})});var r,i=document.createElement("div");function n(e){l(e),u.bind(window,"mousemove",l),u.bind(window,"mouseup",a)}function a(){u.unbind(window,"mousemove",l),u.unbind(window,"mouseup",a)}function s(){var e=p(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function h(){u.unbind(window,"mousemove",c),u.unbind(window,"mouseup",h)}function l(e){e.preventDefault();var t=u.getWidth(o.__saturation_field),r=u.getOffset(o.__saturation_field),i=(e.clientX-r.left+document.body.scrollLeft)/t,n=1-(e.clientY-r.top+document.body.scrollTop)/t;return 1<n?n=1:n<0&&(n=0),1<i?i=1:i<0&&(i=0),o.__color.v=n,o.__color.s=i,o.setValue(o.__color.toOriginal()),!1}function c(e){e.preventDefault();var t=u.getHeight(o.__hue_field),r=u.getOffset(o.__hue_field),i=1-(e.clientY-r.top+document.body.scrollTop)/t;return 1<i?i=1:i<0&&(i=0),o.__color.h=360*i,o.setValue(o.__color.toOriginal()),!1}f.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),f.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),f.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),f.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),f.extend(i.style,{width:"100%",height:"100%",background:"none"}),g(i,"top","rgba(0,0,0,0)","#000"),f.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),(r=this.__hue_field).style.background="",r.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",r.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",f.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),u.bind(this.__saturation_field,"mousedown",n),u.bind(this.__field_knob,"mousedown",n),u.bind(this.__hue_field,"mousedown",function(e){c(e),u.bind(window,"mousemove",c),u.bind(window,"mouseup",h)}),this.__saturation_field.appendChild(i),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};m.superclass=e,f.extend(m.prototype,e.prototype,{updateDisplay:function(){var t=p(this.getValue());if(!1!==t){var r=!1;f.each(d.COMPONENTS,function(e){if(!f.isUndefined(t[e])&&!f.isUndefined(this.__color.__state[e])&&t[e]!==this.__color.__state[e])return r=!0,{}},this),r&&f.extend(this.__color.__state,t)}f.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var e=this.__color.v<.5||.5<this.__color.s?255:0,i=255-e;f.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,g(this.__saturation_field,"left","#fff",this.__temp.toString()),f.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}});var o=["-moz-","-o-","-webkit-","-ms-",""];function g(t,r,i,n){t.style.background="",f.each(o,function(e){t.style.cssText+="background: "+e+"linear-gradient("+r+", "+i+" 0%, "+n+" 100%); "})}return m}(Z.controllers.Controller,Z.dom.dom,Z.color.Color=function(e,i,t,n){var r=function(){if(this.__state=e.apply(this,arguments),!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};function o(e,t,r){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||s(this,t,r),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(s(this,t,r),this.__state.space="RGB"),this.__state[t]=e}})}function a(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||h(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(h(this),this.__state.space="HSV"),this.__state[t]=e}})}function s(e,t,r){if("HEX"===e.__state.space)e.__state[t]=i.component_from_hex(e.__state.hex,r);else{if("HSV"!==e.__state.space)throw"Corrupted color state";n.extend(e.__state,i.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function h(e){var t=i.rgb_to_hsv(e.r,e.g,e.b);n.extend(e.__state,{s:t.s,v:t.v}),n.isNaN(t.h)?n.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h}return r.COMPONENTS=["r","g","b","h","s","v","hex","a"],n.extend(r.prototype,{toString:function(){return t(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),o(r.prototype,"r",2),o(r.prototype,"g",1),o(r.prototype,"b",0),a(r.prototype,"h"),a(r.prototype,"s"),a(r.prototype,"v"),Object.defineProperty(r.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(r.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=i.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),r}(Z.color.interpret,Z.color.math={hsv_to_rgb:function(e,t,r){var i=Math.floor(e/60)%6,n=e/60-Math.floor(e/60),o=r*(1-t),a=r*(1-n*t),s=r*(1-(1-n)*t),h=[[r,s,o],[a,r,o],[o,r,s],[o,a,r],[s,o,r],[r,o,a]][i];return{r:255*h[0],g:255*h[1],b:255*h[2]}},rgb_to_hsv:function(e,t,r){var i,n=Math.min(e,t,r),o=Math.max(e,t,r),a=o-n;return 0==o?{h:NaN,s:0,v:0}:(i=e==o?(t-r)/a:t==o?2+(r-e)/a:4+(e-t)/a,(i/=6)<0&&(i+=1),{h:360*i,s:a/o,v:o/255})},rgb_to_hex:function(e,t,r){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,r)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,r){return r<<(N=8*t)|e&~(255<<N)}},Z.color.toString,Z.utils.common),Z.color.interpret,Z.utils.common),Z.utils.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)},Z.dom.CenteredDiv=(U=Z.dom.dom,B=Z.utils.common,(O=function(){this.backgroundElement=document.createElement("div"),B.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),U.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),B.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;U.bind(this.backgroundElement,"click",function(){e.hide()})}).prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),B.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},O.prototype.hide=function(){var e=this,t=function(){e.domElement.style.display="none",e.backgroundElement.style.display="none",U.unbind(e.domElement,"webkitTransitionEnd",t),U.unbind(e.domElement,"transitionend",t),U.unbind(e.domElement,"oTransitionEnd",t)};U.bind(this.domElement,"webkitTransitionEnd",t),U.bind(this.domElement,"transitionend",t),U.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},O.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-U.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-U.getHeight(this.domElement)/2+"px"},O),Z.dom.dom,Z.utils.common)},{}],4:[function(e,t,r){"object"==typeof t&&(t.exports=function(){var r=Date.now(),i=r,n=0,o=1/0,a=0,s=0,h=1/0,l=0,c=0,t=0,e=document.createElement("div");e.id="stats",e.addEventListener("mousedown",function(e){e.preventDefault(),y(++t%2)},!1),e.style.cssText="width:80px;opacity:0.9;cursor:pointer";var u=document.createElement("div");u.id="fps",u.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",e.appendChild(u);var d=document.createElement("div");d.id="fpsText",d.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",d.innerHTML="FPS",u.appendChild(d);var p=document.createElement("div");for(p.id="fpsGraph",p.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",u.appendChild(p);p.children.length<74;){var f=document.createElement("span");f.style.cssText="width:1px;height:30px;float:left;background-color:#113",p.appendChild(f)}var m=document.createElement("div");m.id="ms",m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",e.appendChild(m);var g=document.createElement("div");g.id="msText",g.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",g.innerHTML="MS",m.appendChild(g);var v=document.createElement("div");for(v.id="msGraph",v.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",m.appendChild(v);v.children.length<74;)(f=document.createElement("span")).style.cssText="width:1px;height:30px;float:left;background-color:#131",v.appendChild(f);var y=function(e){switch(t=e){case 0:u.style.display="block",m.style.display="none";break;case 1:u.style.display="none",m.style.display="block"}};return{REVISION:12,domElement:e,setMode:y,begin:function(){r=Date.now()},end:function(){var e=Date.now();n=e-r,o=Math.min(o,n),a=Math.max(a,n),g.textContent=n+" MS ("+o+"-"+a+")";var t=Math.min(30,30-n/200*30);return v.appendChild(v.firstChild).style.height=t+"px",c++,i+1e3<e&&(s=Math.round(1e3*c/(e-i)),h=Math.min(h,s),l=Math.max(l,s),d.textContent=s+" FPS ("+h+"-"+l+")",t=Math.min(30,30-s/100*30),p.appendChild(p.firstChild).style.height=t+"px",i=e,c=0),e},update:function(){r=this.end()}}})},{}],5:[function(e,t,r){t.exports=function(F){var V=F.MOUSE;function e(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new F.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:V.LEFT,ZOOM:V.MIDDLE,PAN:V.RIGHT};var r,i,o=this,a=new F.Vector2,s=new F.Vector2,h=new F.Vector2,l=new F.Vector2,c=new F.Vector2,u=new F.Vector2,n=new F.Vector3,d=new F.Vector3,p=new F.Vector2,f=new F.Vector2,m=new F.Vector2,g=0,v=0,y=1,x=new F.Vector3,_=new F.Vector3,b=new F.Quaternion,w={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},M=w.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone();var S=(new F.Quaternion).setFromUnitVectors(e.up,new F.Vector3(0,1,0)),E=S.clone().inverse(),T={type:"change"},C={type:"start"},A={type:"end"};function L(){return 2*Math.PI/60/60*o.autoRotateSpeed}function P(){return Math.pow(.95,o.zoomSpeed)}function k(e){if(!1!==o.enabled){e.preventDefault();var t=o.domElement===document?o.domElement.body:o.domElement;if(M===w.ROTATE){if(!0===o.noRotate)return;s.set(e.clientX,e.clientY),h.subVectors(s,a),o.rotateLeft(2*Math.PI*h.x/t.clientWidth*o.rotateSpeed),o.rotateUp(2*Math.PI*h.y/t.clientHeight*o.rotateSpeed),a.copy(s)}else if(M===w.DOLLY){if(!0===o.noZoom)return;f.set(e.clientX,e.clientY),m.subVectors(f,p),0<m.y?o.dollyIn():o.dollyOut(),p.copy(f)}else if(M===w.PAN){if(!0===o.noPan)return;c.set(e.clientX,e.clientY),u.subVectors(c,l),o.pan(u.x,u.y),l.copy(c)}M!==w.NONE&&o.update()}}function R(e){!1!==o.enabled&&(document.removeEventListener("mousemove",k,!1),document.removeEventListener("mouseup",R,!1),o.dispatchEvent(A),M=w.NONE)}function D(e){if(!1!==o.enabled&&!0!==o.noZoom&&M===w.NONE){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),0<t?o.dollyOut():o.dollyIn(),o.update(),o.dispatchEvent(C),o.dispatchEvent(A)}}this.rotateLeft=function(e){void 0===e&&(e=L()),v-=e},this.rotateUp=function(e){void 0===e&&(e=L()),g-=e},this.panLeft=function(e){var t=this.object.matrix.elements;n.set(t[0],t[1],t[2]),n.multiplyScalar(-e),x.add(n)},this.panUp=function(e){var t=this.object.matrix.elements;n.set(t[4],t[5],t[6]),n.multiplyScalar(e),x.add(n)},this.pan=function(e,t){var r=o.domElement===document?o.domElement.body:o.domElement;if(void 0!==o.object.fov){var i=o.object.position.clone().sub(o.target).length();i*=Math.tan(o.object.fov/2*Math.PI/180),o.panLeft(2*e*i/r.clientHeight),o.panUp(2*t*i/r.clientHeight)}else void 0!==o.object.top?(o.panLeft(e*(o.object.right-o.object.left)/r.clientWidth),o.panUp(t*(o.object.top-o.object.bottom)/r.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=P()),y/=e},this.dollyOut=function(e){void 0===e&&(e=P()),y*=e},this.update=function(){var e=this.object.position;d.copy(e).sub(this.target),d.applyQuaternion(S),r=Math.atan2(d.x,d.z),i=Math.atan2(Math.sqrt(d.x*d.x+d.z*d.z),d.y),this.autoRotate&&M===w.NONE&&this.rotateLeft(L()),r+=v,i+=g,r=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,r)),i=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,i)),i=Math.max(1e-6,Math.min(Math.PI-1e-6,i));var t=d.length()*y;t=Math.max(this.minDistance,Math.min(this.maxDistance,t)),this.target.add(x),d.x=t*Math.sin(i)*Math.sin(r),d.y=t*Math.cos(i),d.z=t*Math.sin(i)*Math.cos(r),d.applyQuaternion(E),e.copy(this.target).add(d),this.object.lookAt(this.target),g=v=0,y=1,x.set(0,0,0),(1e-6<_.distanceToSquared(this.object.position)||1e-6<8*(1-b.dot(this.object.quaternion)))&&(this.dispatchEvent(T),_.copy(this.object.position),b.copy(this.object.quaternion))},this.reset=function(){M=w.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.update()},this.getPolarAngle=function(){return i},this.getAzimuthalAngle=function(){return r},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",function(e){if(!1!==o.enabled){if(e.preventDefault(),e.button===o.mouseButtons.ORBIT){if(!0===o.noRotate)return;M=w.ROTATE,a.set(e.clientX,e.clientY)}else if(e.button===o.mouseButtons.ZOOM){if(!0===o.noZoom)return;M=w.DOLLY,p.set(e.clientX,e.clientY)}else if(e.button===o.mouseButtons.PAN){if(!0===o.noPan)return;M=w.PAN,l.set(e.clientX,e.clientY)}M!==w.NONE&&(document.addEventListener("mousemove",k,!1),document.addEventListener("mouseup",R,!1),o.dispatchEvent(C))}},!1),this.domElement.addEventListener("mousewheel",D,!1),this.domElement.addEventListener("DOMMouseScroll",D,!1),this.domElement.addEventListener("touchstart",function(e){if(!1!==o.enabled){switch(e.touches.length){case 1:if(!0===o.noRotate)return;M=w.TOUCH_ROTATE,a.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(!0===o.noZoom)return;M=w.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+r*r);p.set(0,i);break;case 3:if(!0===o.noPan)return;M=w.TOUCH_PAN,l.set(e.touches[0].pageX,e.touches[0].pageY);break;default:M=w.NONE}M!==w.NONE&&o.dispatchEvent(C)}},!1),this.domElement.addEventListener("touchend",function(){!1!==o.enabled&&(o.dispatchEvent(A),M=w.NONE)},!1),this.domElement.addEventListener("touchmove",function(e){if(!1!==o.enabled){e.preventDefault(),e.stopPropagation();var t=o.domElement===document?o.domElement.body:o.domElement;switch(e.touches.length){case 1:if(!0===o.noRotate)return;if(M!==w.TOUCH_ROTATE)return;s.set(e.touches[0].pageX,e.touches[0].pageY),h.subVectors(s,a),o.rotateLeft(2*Math.PI*h.x/t.clientWidth*o.rotateSpeed),o.rotateUp(2*Math.PI*h.y/t.clientHeight*o.rotateSpeed),a.copy(s),o.update();break;case 2:if(!0===o.noZoom)return;if(M!==w.TOUCH_DOLLY)return;var r=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(r*r+i*i);f.set(0,n),m.subVectors(f,p),0<m.y?o.dollyOut():o.dollyIn(),p.copy(f),o.update();break;case 3:if(!0===o.noPan)return;if(M!==w.TOUCH_PAN)return;c.set(e.touches[0].pageX,e.touches[0].pageY),u.subVectors(c,l),o.pan(u.x,u.y),l.copy(c),o.update();break;default:M=w.NONE}}},!1),window.addEventListener("keydown",function(e){if(!1!==o.enabled&&!0!==o.noKeys&&!0!==o.noPan)switch(e.keyCode){case o.keys.UP:o.pan(0,o.keyPanSpeed),o.update();break;case o.keys.BOTTOM:o.pan(0,-o.keyPanSpeed),o.update();break;case o.keys.LEFT:o.pan(o.keyPanSpeed,0),o.update();break;case o.keys.RIGHT:o.pan(-o.keyPanSpeed,0),o.update()}},!1),this.update()}return V||(V={LEFT:0,MIDDLE:1,RIGHT:2}),(e.prototype=Object.create(F.EventDispatcher.prototype)).constructor=e}},{}],6:[function(e,t,r){var i=e("three");console.warn("WARNING: The 'three.js' npm package is deprecated in favor of the 'three' npm package, please upgrade."),void 0!==r?(void 0!==t&&t.exports&&(r=t.exports=i),r.THREE=i):this.THREE=i},{three:7}],7:[function(e,t,r){var i,n,o,a,s,h,l,c,u,d,p,f,m,g,v,y,x,_,b,w,M,S,E,T,C,A,L,P,k,R,D,F,V,U,B,O,N,G,I,z,H,j,W,X,q,Y,K,Q,Z,J,$,ee,te,re,ie,ne,oe,ae,se,he,le,ce,ue,de,pe,fe,me,ge,ve,ye,xe,_e,be,we,Me,Se,Ee,Te,Ce,Ae,Le,Pe,ke,Re,De,Fe,Ve,Ue,Be,Oe,Ne,Ge,Ie,ze,He,je,We,Xe,qe,Ye,Ke,Qe,Ze,Je,$e,et,tt,rt,it,nt,ot,at,st,ht,lt,ct,ut,dt,pt,ft,mt,gt,vt,yt,xt,_t,bt,wt,Mt,St,Et,Tt,Ct,At,Lt,Pt,kt,Rt,Dt,Ft,Vt,Ut,Bt,Ot,Nt=Nt||{},Gt={REVISION:"73"};"function"==typeof define&&define.amd?define("three",Gt):void 0!==r&&void 0!==t&&(t.exports=Gt),void 0!==Nt.requestAnimationFrame&&void 0!==Nt.cancelAnimationFrame||function(){for(var n=0,e=["ms","moz","webkit","o"],t=0;t<e.length&&!Nt.requestAnimationFrame;++t)Nt.requestAnimationFrame=Nt[e[t]+"RequestAnimationFrame"],Nt.cancelAnimationFrame=Nt[e[t]+"CancelAnimationFrame"]||Nt[e[t]+"CancelRequestAnimationFrame"];void 0===Nt.requestAnimationFrame&&void 0!==Nt.setTimeout&&(Nt.requestAnimationFrame=function(e){var t=Date.now(),r=Math.max(0,16-(t-n)),i=Nt.setTimeout(function(){e(t+r)},r);return n=t+r,i}),void 0===Nt.cancelAnimationFrame&&void 0!==Nt.clearTimeout&&(Nt.cancelAnimationFrame=function(e){Nt.clearTimeout(e)})}(),void 0===Nt.performance&&(Nt.performance={}),void 0===Nt.performance.now&&(i=Date.now(),Nt.performance.now=function(){return Date.now()-i}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:0<e?1:+e}),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),Gt.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},Gt.CullFaceNone=0,Gt.CullFaceBack=1,Gt.CullFaceFront=2,Gt.CullFaceFrontBack=3,Gt.FrontFaceDirectionCW=0,Gt.FrontFaceDirectionCCW=1,Gt.BasicShadowMap=0,Gt.PCFShadowMap=1,Gt.PCFSoftShadowMap=2,Gt.FrontSide=0,Gt.BackSide=1,Gt.DoubleSide=2,Gt.FlatShading=1,Gt.SmoothShading=2,Gt.NoColors=0,Gt.FaceColors=1,Gt.VertexColors=2,Gt.NoBlending=0,Gt.NormalBlending=1,Gt.AdditiveBlending=2,Gt.SubtractiveBlending=3,Gt.MultiplyBlending=4,Gt.CustomBlending=5,Gt.AddEquation=100,Gt.SubtractEquation=101,Gt.ReverseSubtractEquation=102,Gt.MinEquation=103,Gt.MaxEquation=104,Gt.ZeroFactor=200,Gt.OneFactor=201,Gt.SrcColorFactor=202,Gt.OneMinusSrcColorFactor=203,Gt.SrcAlphaFactor=204,Gt.OneMinusSrcAlphaFactor=205,Gt.DstAlphaFactor=206,Gt.OneMinusDstAlphaFactor=207,Gt.DstColorFactor=208,Gt.OneMinusDstColorFactor=209,Gt.SrcAlphaSaturateFactor=210,Gt.NeverDepth=0,Gt.AlwaysDepth=1,Gt.LessDepth=2,Gt.LessEqualDepth=3,Gt.EqualDepth=4,Gt.GreaterEqualDepth=5,Gt.GreaterDepth=6,Gt.NotEqualDepth=7,Gt.MultiplyOperation=0,Gt.MixOperation=1,Gt.AddOperation=2,Gt.UVMapping=300,Gt.CubeReflectionMapping=301,Gt.CubeRefractionMapping=302,Gt.EquirectangularReflectionMapping=303,Gt.EquirectangularRefractionMapping=304,Gt.SphericalReflectionMapping=305,Gt.RepeatWrapping=1e3,Gt.ClampToEdgeWrapping=1001,Gt.MirroredRepeatWrapping=1002,Gt.NearestFilter=1003,Gt.NearestMipMapNearestFilter=1004,Gt.NearestMipMapLinearFilter=1005,Gt.LinearFilter=1006,Gt.LinearMipMapNearestFilter=1007,Gt.LinearMipMapLinearFilter=1008,Gt.UnsignedByteType=1009,Gt.ByteType=1010,Gt.ShortType=1011,Gt.UnsignedShortType=1012,Gt.IntType=1013,Gt.UnsignedIntType=1014,Gt.FloatType=1015,Gt.HalfFloatType=1025,Gt.UnsignedShort4444Type=1016,Gt.UnsignedShort5551Type=1017,Gt.UnsignedShort565Type=1018,Gt.AlphaFormat=1019,Gt.RGBFormat=1020,Gt.RGBAFormat=1021,Gt.LuminanceFormat=1022,Gt.LuminanceAlphaFormat=1023,Gt.RGBEFormat=Gt.RGBAFormat,Gt.RGB_S3TC_DXT1_Format=2001,Gt.RGBA_S3TC_DXT1_Format=2002,Gt.RGBA_S3TC_DXT3_Format=2003,Gt.RGBA_S3TC_DXT5_Format=2004,Gt.RGB_PVRTC_4BPPV1_Format=2100,Gt.RGB_PVRTC_2BPPV1_Format=2101,Gt.RGBA_PVRTC_4BPPV1_Format=2102,Gt.RGBA_PVRTC_2BPPV1_Format=2103,Gt.LoopOnce=2200,Gt.LoopRepeat=2201,Gt.LoopPingPong=2202,Gt.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},Gt.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},Gt.Color=function(e){return 3===arguments.length?this.fromArray(arguments):this.set(e)},Gt.Color.prototype={constructor:Gt.Color,r:1,g:1,b:1,set:function(e){return e instanceof Gt.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function o(e,t,r){return r<0&&(r+=1),1<r&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}return function(e,t,r){if(e=Gt.Math.euclideanModulo(e,1),t=Gt.Math.clamp(t,0,1),r=Gt.Math.clamp(r,0,1),0===t)this.r=this.g=this.b=r;else{var i=r<=.5?r*(1+t):r+t-r*t,n=2*r-i;this.r=o(n,i,e+1/3),this.g=o(n,i,e),this.b=o(n,i,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var i,n=r[1],o=r[2];switch(n){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,e(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,e(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,h=parseInt(i[3],10)/100;return e(i[5]),this.setHSL(a,s,h)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var l,c=(l=r[1]).length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}t&&0<t.length&&(void 0!==(l=Gt.ColorKeywords[t])?this.setHex(l):console.warn("THREE.Color: Unknown color "+t));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=0<t?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,r,i=e||{h:0,s:0,l:0},n=this.r,o=this.g,a=this.b,s=Math.max(n,o,a),h=Math.min(n,o,a),l=(h+s)/2;if(h===s)r=t=0;else{var c=s-h;switch(r=l<=.5?c/(s+h):c/(2-s-h),s){case n:t=(o-a)/c+(o<a?6:0);break;case o:t=(a-n)/c+2;break;case a:t=(n-o)/c+4}t/=6}return i.h=t,i.s=r,i.l=l,i},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=r,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},Gt.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gt.Quaternion=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==i?i:1},Gt.Quaternion.prototype={constructor:Gt.Quaternion,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof Gt.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=Math.cos(e._x/2),i=Math.cos(e._y/2),n=Math.cos(e._z/2),o=Math.sin(e._x/2),a=Math.sin(e._y/2),s=Math.sin(e._z/2),h=e.order;return"XYZ"===h?(this._x=o*i*n+r*a*s,this._y=r*a*n-o*i*s,this._z=r*i*s+o*a*n,this._w=r*i*n-o*a*s):"YXZ"===h?(this._x=o*i*n+r*a*s,this._y=r*a*n-o*i*s,this._z=r*i*s-o*a*n,this._w=r*i*n+o*a*s):"ZXY"===h?(this._x=o*i*n-r*a*s,this._y=r*a*n+o*i*s,this._z=r*i*s+o*a*n,this._w=r*i*n-o*a*s):"ZYX"===h?(this._x=o*i*n-r*a*s,this._y=r*a*n+o*i*s,this._z=r*i*s-o*a*n,this._w=r*i*n+o*a*s):"YZX"===h?(this._x=o*i*n+r*a*s,this._y=r*a*n+o*i*s,this._z=r*i*s-o*a*n,this._w=r*i*n-o*a*s):"XZY"===h&&(this._x=o*i*n-r*a*s,this._y=r*a*n-o*i*s,this._z=r*i*s+o*a*n,this._w=r*i*n+o*a*s),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,i=r[0],n=r[4],o=r[8],a=r[1],s=r[5],h=r[9],l=r[2],c=r[6],u=r[10],d=i+s+u;return 0<d?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(c-h)*t,this._y=(o-l)*t,this._z=(a-n)*t):s<i&&u<i?(t=2*Math.sqrt(1+i-s-u),this._w=(c-h)/t,this._x=.25*t,this._y=(n+a)/t,this._z=(o+l)/t):u<s?(t=2*Math.sqrt(1+s-i-u),this._w=(o-l)/t,this._x=(n+a)/t,this._y=.25*t,this._z=(h+c)/t):(t=2*Math.sqrt(1+u-i-s),this._w=(a-n)/t,this._x=(o+l)/t,this._y=(h+c)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(e,t){return void 0===n&&(n=new Gt.Vector3),(o=e.dot(t)+1)<1e-6?(o=0,Math.abs(e.x)>Math.abs(e.z)?n.set(-e.y,e.x,0):n.set(0,-e.z,e.y)):n.crossVectors(e,t),this._x=n.x,this._y=n.y,this._z=n.z,this._w=o,this.normalize(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,n=e._z,o=e._w,a=t._x,s=t._y,h=t._z,l=t._w;return this._x=r*l+o*a+i*h-n*s,this._y=i*l+o*s+n*a-r*h,this._z=n*l+o*h+r*s-i*a,this._w=o*l-r*a-i*s-n*h,this.onChangeCallback(),this},multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,i=this._y,n=this._z,o=this._w,a=o*e._w+r*e._x+i*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),1<=a)return this._w=o,this._x=r,this._y=i,this._z=n,this;var s=Math.acos(a),h=Math.sqrt(1-a*a);if(Math.abs(h)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(i+this._y),this._z=.5*(n+this._z),this;var l=Math.sin((1-t)*s)/h,c=Math.sin(t*s)/h;return this._w=o*l+this._w*c,this._x=r*l+this._x*c,this._y=i*l+this._y*c,this._z=n*l+this._z*c,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},Gt.Quaternion.slerp=function(e,t,r,i){return r.copy(e).slerp(t,i)},Gt.Vector2=function(e,t){this.x=e||0,this.y=t||0},Gt.Vector2.prototype={constructor:Gt.Vector2,get width(){return this.x},set width(e){this.x=e},get height(){return this.y},set height(e){this.y=e},set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e):(this.x=0,this.y=0),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return void 0===a&&(a=new Gt.Vector2,s=new Gt.Vector2),a.set(e,e),s.set(t,t),this.clamp(a,s)},clampLength:function(e,t){var r=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,r))/r),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this},rotateAround:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*r-o*i+e.x,this.y=n*i+o*r+e.y,this}},Gt.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},Gt.Vector3.prototype={constructor:Gt.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e instanceof Gt.Euler==0&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===v&&(v=new Gt.Quaternion),this.applyQuaternion(v.setFromEuler(e)),this},applyAxisAngle:function(e,t){return void 0===g&&(g=new Gt.Quaternion),this.applyQuaternion(g.setFromAxisAngle(e,t)),this},applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i+n[12],this.y=n[1]*t+n[5]*r+n[9]*i+n[13],this.z=n[2]*t+n[6]*r+n[10]*i+n[14],this},applyProjection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements,o=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*o,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*o,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,n=e.x,o=e.y,a=e.z,s=e.w,h=s*t+o*i-a*r,l=s*r+a*t-n*i,c=s*i+n*r-o*t,u=-n*t-o*r-a*i;return this.x=h*s+u*-n+l*-a-c*-o,this.y=l*s+u*-o+c*-n-h*-a,this.z=c*s+u*-a+h*-o-l*-n,this},project:function(e){return void 0===m&&(m=new Gt.Matrix4),m.multiplyMatrices(e.projectionMatrix,m.getInverse(e.matrixWorld)),this.applyProjection(m)},unproject:function(e){return void 0===f&&(f=new Gt.Matrix4),f.multiplyMatrices(e.matrixWorld,f.getInverse(e.projectionMatrix)),this.applyProjection(f)},transformDirection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return void 0===d&&(d=new Gt.Vector3,p=new Gt.Vector3),d.set(e,e,e),p.set(t,t,t),this.clamp(d,p)},clampLength:function(e,t){var r=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,r))/r),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,i=this.y,n=this.z;return this.x=i*e.z-n*e.y,this.y=n*e.x-r*e.z,this.z=r*e.y-i*e.x,this},crossVectors:function(e,t){var r=e.x,i=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-n*a,this.y=n*o-r*s,this.z=r*a-i*o,this},projectOnVector:function(e){return void 0===c&&(c=new Gt.Vector3),c.copy(e).normalize(),u=this.dot(c),this.copy(c).multiplyScalar(u)},projectOnPlane:function(e){return void 0===l&&(l=new Gt.Vector3),l.copy(this).projectOnVector(e),this.sub(l)},reflect:function(e){return void 0===h&&(h=new Gt.Vector3),this.sub(h.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(Gt.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){var r=4*e,i=t.elements;return this.x=i[r],this.y=i[r+1],this.z=i[r+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}},Gt.Vector4=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1},Gt.Vector4.prototype={constructor:Gt.Vector4,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e,this.w*=e):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*n,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*n,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*n,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,n,o=e.elements,a=o[0],s=o[4],h=o[8],l=o[1],c=o[5],u=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(s-l)<.01&&Math.abs(h-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(s+l)<.1&&Math.abs(h+d)<.1&&Math.abs(u+p)<.1&&Math.abs(a+c+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(c+1)/2,v=(f+1)/2,y=(s+l)/4,x=(h+d)/4,_=(u+p)/4;return g<m&&v<m?m<.01?(r=0,n=i=.707106781):(i=y/(r=Math.sqrt(m)),n=x/r):v<g?g<.01?(i=0,n=r=.707106781):(r=y/(i=Math.sqrt(g)),n=_/i):v<.01?(i=r=.707106781,n=0):(r=x/(n=Math.sqrt(v)),i=_/n),this.set(r,i,n,t),this}var b=Math.sqrt((p-u)*(p-u)+(h-d)*(h-d)+(l-s)*(l-s));return Math.abs(b)<.001&&(b=1),this.x=(p-u)/b,this.y=(h-d)/b,this.z=(l-s)/b,this.w=Math.acos((a+c+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return void 0===y&&(y=new Gt.Vector4,x=new Gt.Vector4),y.set(e,e,e,e),x.set(t,t,t,t),this.clamp(y,x)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this}},Gt.Euler=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||Gt.Euler.DefaultOrder},Gt.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Gt.Euler.DefaultOrder="XYZ",Gt.Euler.prototype={constructor:Gt.Euler,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var i=Gt.Math.clamp,n=e.elements,o=n[0],a=n[4],s=n[8],h=n[1],l=n[5],c=n[9],u=n[2],d=n[6],p=n[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-u,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(h,o))):"ZYX"===t?(this._y=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(h,o)):(this._x=0,this._z=Math.atan2(-a,l))):"YZX"===t?(this._z=Math.asin(i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===t?(this._z=Math.asin(-i(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,l),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(e,t,r){return void 0===b&&(b=new Gt.Matrix4),b.makeRotationFromQuaternion(e),this.setFromRotationMatrix(b,t,r),this},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(_=new Gt.Quaternion,function(e){_.setFromEuler(this),this.setFromQuaternion(_,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Gt.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},Gt.Line3=function(e,t){this.start=void 0!==e?e:new Gt.Vector3,this.end=void 0!==t?t:new Gt.Vector3},Gt.Line3.prototype={constructor:Gt.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new Gt.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new Gt.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new Gt.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(w=new Gt.Vector3,M=new Gt.Vector3,function(e,t){w.subVectors(e,this.start),M.subVectors(this.end,this.start);var r=M.dot(M),i=M.dot(w)/r;return t&&(i=Gt.Math.clamp(i,0,1)),i}),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t),n=r||new Gt.Vector3;return this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},Gt.Box2=function(e,t){this.min=void 0!==e?e:new Gt.Vector2(1/0,1/0),this.max=void 0!==t?t:new Gt.Vector2(-1/0,-1/0)},Gt.Box2.prototype={constructor:Gt.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:(E=new Gt.Vector2,function(e,t){var r=E.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new Gt.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new Gt.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new Gt.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new Gt.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:(S=new Gt.Vector2,function(e){return S.copy(e).clamp(this.min,this.max).sub(e).length()}),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Gt.Box3=function(e,t){this.min=void 0!==e?e:new Gt.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new Gt.Vector3(-1/0,-1/0,-1/0)},Gt.Box3.prototype={constructor:Gt.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:(P=new Gt.Vector3,function(e,t){var r=P.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}),setFromObject:(L=new Gt.Vector3,function(e){var a=this;return e.updateMatrixWorld(!0),this.makeEmpty(),e.traverse(function(e){var t=e.geometry;if(void 0!==t)if(t instanceof Gt.Geometry)for(var r=t.vertices,i=0,n=r.length;i<n;i++)L.copy(r[i]),L.applyMatrix4(e.matrixWorld),a.expandByPoint(L);else if(t instanceof Gt.BufferGeometry&&void 0!==t.attributes.position){var o=t.attributes.position.array;for(i=0,n=o.length;i<n;i+=3)L.set(o[i],o[i+1],o[i+2]),L.applyMatrix4(e.matrixWorld),a.expandByPoint(L)}}),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new Gt.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new Gt.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new Gt.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new Gt.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:(A=new Gt.Vector3,function(e){return A.copy(e).clamp(this.min,this.max).sub(e).length()}),getBoundingSphere:(C=new Gt.Vector3,function(e){var t=e||new Gt.Sphere;return t.center=this.center(),t.radius=.5*this.size(C).length(),t}),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(T=[new Gt.Vector3,new Gt.Vector3,new Gt.Vector3,new Gt.Vector3,new Gt.Vector3,new Gt.Vector3,new Gt.Vector3,new Gt.Vector3],function(e){return T[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),T[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),T[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),T[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),T[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),T[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),T[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),T[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(T),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Gt.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},Gt.Matrix3.prototype={constructor:Gt.Matrix3,set:function(e,t,r,i,n,o,a,s,h){var l=this.elements;return l[0]=e,l[3]=t,l[6]=r,l[1]=i,l[4]=n,l[7]=o,l[2]=a,l[5]=s,l[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(e,t,r){void 0===R&&(R=new Gt.Vector3),void 0===t&&(t=0),void 0===r&&(r=e.length);for(var i=0,n=t;i<r;i+=3,n+=3)R.fromArray(e,n),R.applyMatrix3(this),R.toArray(e,n);return e},applyToBuffer:function(e,t,r){void 0===k&&(k=new Gt.Vector3),void 0===t&&(t=0),void 0===r&&(r=e.length/e.itemSize);for(var i=0,n=t;i<r;i++,n++)k.x=e.getX(n),k.y=e.getY(n),k.z=e.getZ(n),k.applyMatrix3(this),e.setXYZ(k.x,k.y,k.z);return e},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],h=e[7],l=e[8];return t*o*l-t*a*h-r*n*l+r*a*s+i*n*h-i*o*s},getInverse:function(e,t){var r=e.elements,i=this.elements;i[0]=r[10]*r[5]-r[6]*r[9],i[1]=-r[10]*r[1]+r[2]*r[9],i[2]=r[6]*r[1]-r[2]*r[5],i[3]=-r[10]*r[4]+r[6]*r[8],i[4]=r[10]*r[0]-r[2]*r[8],i[5]=-r[6]*r[0]+r[2]*r[4],i[6]=r[9]*r[4]-r[5]*r[8],i[7]=-r[9]*r[0]+r[1]*r[8],i[8]=r[5]*r[0]-r[1]*r[4];var n=r[0]*i[0]+r[1]*i[3]+r[2]*i[6];if(0===n){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}},Gt.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},Gt.Matrix4.prototype={constructor:Gt.Matrix4,set:function(e,t,r,i,n,o,a,s,h,l,c,u,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=o,g[9]=a,g[13]=s,g[2]=h,g[6]=l,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Gt.Matrix4).fromArray(this.elements)},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){var i=this.elements;return e.set(i[0],i[1],i[2]),t.set(i[4],i[5],i[6]),r.set(i[8],i[9],i[10]),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(e){void 0===I&&(I=new Gt.Vector3);var t=this.elements,r=e.elements,i=1/I.set(r[0],r[1],r[2]).length(),n=1/I.set(r[4],r[5],r[6]).length(),o=1/I.set(r[8],r[9],r[10]).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,this},makeRotationFromEuler:function(e){e instanceof Gt.Euler==!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,i=e.y,n=e.z,o=Math.cos(r),a=Math.sin(r),s=Math.cos(i),h=Math.sin(i),l=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){var u=o*l,d=o*c,p=a*l,f=a*c;t[0]=s*l,t[4]=-s*c,t[8]=h,t[1]=d+p*h,t[5]=u-f*h,t[9]=-a*s,t[2]=f-u*h,t[6]=p+d*h,t[10]=o*s}else if("YXZ"===e.order){var m=s*l,g=s*c,v=h*l,y=h*c;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*h,t[1]=o*c,t[5]=o*l,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*l,g=s*c,v=h*l,y=h*c;t[0]=m-y*a,t[4]=-o*c,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*l,t[9]=y-m*a,t[2]=-o*h,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){u=o*l,d=o*c,p=a*l,f=a*c;t[0]=s*l,t[4]=p*h-d,t[8]=u*h+f,t[1]=s*c,t[5]=f*h+u,t[9]=d*h-p,t[2]=-h,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var x=o*s,_=o*h,b=a*s,w=a*h;t[0]=s*l,t[4]=w-x*c,t[8]=b*c+_,t[1]=c,t[5]=o*l,t[9]=-a*l,t[2]=-h*l,t[6]=_*c+b,t[10]=x-w*c}else if("XZY"===e.order){x=o*s,_=o*h,b=a*s,w=a*h;t[0]=s*l,t[4]=-c,t[8]=h*l,t[1]=x*c+w,t[5]=o*l,t[9]=_*c-b,t[2]=b*c-_,t[6]=a*l,t[10]=w*c+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z,o=e.w,a=r+r,s=i+i,h=n+n,l=r*a,c=r*s,u=r*h,d=i*s,p=i*h,f=n*h,m=o*a,g=o*s,v=o*h;return t[0]=1-(d+f),t[4]=c-v,t[8]=u+g,t[1]=c+v,t[5]=1-(l+f),t[9]=p-m,t[2]=u-g,t[6]=p+m,t[10]=1-(l+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(e,t,r){void 0===O&&(O=new Gt.Vector3),void 0===N&&(N=new Gt.Vector3),void 0===G&&(G=new Gt.Vector3);var i=this.elements;return G.subVectors(e,t).normalize(),0===G.lengthSq()&&(G.z=1),O.crossVectors(r,G).normalize(),0===O.lengthSq()&&(G.x+=1e-4,O.crossVectors(r,G).normalize()),N.crossVectors(G,O),i[0]=O.x,i[4]=N.x,i[8]=G.x,i[1]=O.y,i[5]=N.y,i[9]=G.y,i[2]=O.z,i[6]=N.z,i[10]=G.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,o=r[0],a=r[4],s=r[8],h=r[12],l=r[1],c=r[5],u=r[9],d=r[13],p=r[2],f=r[6],m=r[10],g=r[14],v=r[3],y=r[7],x=r[11],_=r[15],b=i[0],w=i[4],M=i[8],S=i[12],E=i[1],T=i[5],C=i[9],A=i[13],L=i[2],P=i[6],k=i[10],R=i[14],D=i[3],F=i[7],V=i[11],U=i[15];return n[0]=o*b+a*E+s*L+h*D,n[4]=o*w+a*T+s*P+h*F,n[8]=o*M+a*C+s*k+h*V,n[12]=o*S+a*A+s*R+h*U,n[1]=l*b+c*E+u*L+d*D,n[5]=l*w+c*T+u*P+d*F,n[9]=l*M+c*C+u*k+d*V,n[13]=l*S+c*A+u*R+d*U,n[2]=p*b+f*E+m*L+g*D,n[6]=p*w+f*T+m*P+g*F,n[10]=p*M+f*C+m*k+g*V,n[14]=p*S+f*A+m*R+g*U,n[3]=v*b+y*E+x*L+_*D,n[7]=v*w+y*T+x*P+_*F,n[11]=v*M+y*C+x*k+_*V,n[15]=v*S+y*A+x*R+_*U,this},multiplyToArray:function(e,t,r){var i=this.elements;return this.multiplyMatrices(e,t),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(e,t,r){void 0===B&&(B=new Gt.Vector3),void 0===t&&(t=0),void 0===r&&(r=e.length);for(var i=0,n=t;i<r;i+=3,n+=3)B.fromArray(e,n),B.applyMatrix4(this),B.toArray(e,n);return e},applyToBuffer:function(e,t,r){void 0===U&&(U=new Gt.Vector3),void 0===t&&(t=0),void 0===r&&(r=e.length/e.itemSize);for(var i=0,n=t;i<r;i++,n++)U.x=e.getX(n),U.y=e.getY(n),U.z=e.getZ(n),U.applyMatrix4(this),e.setXYZ(U.x,U.y,U.z);return e},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],o=e[1],a=e[5],s=e[9],h=e[13],l=e[2],c=e[6],u=e[10],d=e[14];return e[3]*(+n*s*c-i*h*c-n*a*u+r*h*u+i*a*d-r*s*d)+e[7]*(+t*s*d-t*h*u+n*o*u-i*o*d+i*h*l-n*s*l)+e[11]*(+t*h*c-t*a*d-n*o*c+r*o*d+n*a*l-r*h*l)+e[15]*(-i*a*l-t*s*c+t*a*u+i*o*c-r*o*u+r*s*l)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){void 0===V&&(V=new Gt.Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var e=this.elements;return V.set(e[12],e[13],e[14])},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,i=e.elements,n=i[0],o=i[4],a=i[8],s=i[12],h=i[1],l=i[5],c=i[9],u=i[13],d=i[2],p=i[6],f=i[10],m=i[14],g=i[3],v=i[7],y=i[11],x=i[15];r[0]=c*m*v-u*f*v+u*p*y-l*m*y-c*p*x+l*f*x,r[4]=s*f*v-a*m*v-s*p*y+o*m*y+a*p*x-o*f*x,r[8]=a*u*v-s*c*v+s*l*y-o*u*y-a*l*x+o*c*x,r[12]=s*c*p-a*u*p-s*l*f+o*u*f+a*l*m-o*c*m,r[1]=u*f*g-c*m*g-u*d*y+h*m*y+c*d*x-h*f*x,r[5]=a*m*g-s*f*g+s*d*y-n*m*y-a*d*x+n*f*x,r[9]=s*c*g-a*u*g-s*h*y+n*u*y+a*h*x-n*c*x,r[13]=a*u*d-s*c*d+s*h*f-n*u*f-a*h*m+n*c*m,r[2]=l*m*g-u*p*g+u*d*v-h*m*v-l*d*x+h*p*x,r[6]=s*p*g-o*m*g-s*d*v+n*m*v+o*d*x-n*p*x,r[10]=o*u*g-s*l*g+s*h*v-n*u*v-o*h*x+n*l*x,r[14]=s*l*d-o*u*d-s*h*p+n*u*p+o*h*m-n*l*m,r[3]=c*p*g-l*f*g-c*d*v+h*f*v+l*d*y-h*p*y,r[7]=o*f*g-a*p*g+a*d*v-n*f*v-o*d*y+n*p*y,r[11]=a*l*g-o*c*g-a*h*v+n*c*v+o*h*y-n*l*y,r[15]=o*c*d-a*l*d+a*h*p-n*c*p-o*h*f+n*l*f;var _=n*r[0]+h*r[4]+d*r[8]+g*r[12];if(0===_){var b="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(b);return console.warn(b),this.identity(),this}return this.multiplyScalar(1/_),this},translate:function(e){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,o=e.x,a=e.y,s=e.z,h=n*o,l=n*a;return this.set(h*o+r,h*a-i*s,h*s+i*a,0,h*a+i*s,l*a+r,l*s-i*o,0,h*s-i*a,l*s+i*o,n*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(e,t,r){void 0===D&&(D=new Gt.Vector3),void 0===F&&(F=new Gt.Matrix4);var i=this.elements,n=D.set(i[0],i[1],i[2]).length(),o=D.set(i[4],i[5],i[6]).length(),a=D.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),e.x=i[12],e.y=i[13],e.z=i[14],F.elements.set(this.elements);var s=1/n,h=1/o,l=1/a;return F.elements[0]*=s,F.elements[1]*=s,F.elements[2]*=s,F.elements[4]*=h,F.elements[5]*=h,F.elements[6]*=h,F.elements[8]*=l,F.elements[9]*=l,F.elements[10]*=l,t.setFromRotationMatrix(F),r.x=n,r.y=o,r.z=a,this},makeFrustum:function(e,t,r,i,n,o){var a=this.elements,s=2*n/(t-e),h=2*n/(i-r),l=(t+e)/(t-e),c=(i+r)/(i-r),u=-(o+n)/(o-n),d=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=h,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,r,i){var n=r*Math.tan(Gt.Math.degToRad(.5*e)),o=-n,a=o*t,s=n*t;return this.makeFrustum(a,s,o,n,r,i)},makeOrthographic:function(e,t,r,i,n,o){var a=this.elements,s=t-e,h=r-i,l=o-n,c=(t+e)/s,u=(r+i)/h,d=(o+n)/l;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2/h,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2/l,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}},Gt.Ray=function(e,t){this.origin=void 0!==e?e:new Gt.Vector3,this.direction=void 0!==t?t:new Gt.Vector3},Gt.Ray.prototype={constructor:Gt.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new Gt.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:(J=new Gt.Vector3,function(e){return this.origin.copy(this.at(e,J)),this}),closestPointToPoint:function(e,t){var r=t||new Gt.Vector3;r.subVectors(e,this.origin);var i=r.dot(this.direction);return i<0?r.copy(this.origin):r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:(Z=new Gt.Vector3,function(e){var t=Z.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Z.copy(this.direction).multiplyScalar(t).add(this.origin),Z.distanceToSquared(e))}),distanceSqToSegment:(Y=new Gt.Vector3,K=new Gt.Vector3,Q=new Gt.Vector3,function(e,t,r,i){Y.copy(e).add(t).multiplyScalar(.5),K.copy(t).sub(e).normalize(),Q.copy(this.origin).sub(Y);var n,o,a,s,h=.5*e.distanceTo(t),l=-this.direction.dot(K),c=Q.dot(this.direction),u=-Q.dot(K),d=Q.lengthSq(),p=Math.abs(1-l*l);if(0<p)if(o=l*c-u,s=h*p,0<=(n=l*u-c))if(-s<=o)if(o<=s){var f=1/p;a=(n*=f)*(n+l*(o*=f)+2*c)+o*(l*n+o+2*u)+d}else o=h,a=-(n=Math.max(0,-(l*o+c)))*n+o*(o+2*u)+d;else o=-h,a=-(n=Math.max(0,-(l*o+c)))*n+o*(o+2*u)+d;else o<=-s?a=-(n=Math.max(0,-(-l*h+c)))*n+(o=0<n?-h:Math.min(Math.max(-h,-u),h))*(o+2*u)+d:o<=s?(n=0,a=(o=Math.min(Math.max(-h,-u),h))*(o+2*u)+d):a=-(n=Math.max(0,-(l*h+c)))*n+(o=0<n?h:Math.min(Math.max(-h,-u),h))*(o+2*u)+d;else o=0<l?-h:h,a=-(n=Math.max(0,-(l*o+c)))*n+o*(o+2*u)+d;return r&&r.copy(this.direction).multiplyScalar(n).add(this.origin),i&&i.copy(K).multiplyScalar(o).add(Y),a}),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:(q=new Gt.Vector3,function(e,t){q.subVectors(e.center,this.origin);var r=q.dot(this.direction),i=q.dot(q)-r*r,n=e.radius*e.radius;if(n<i)return null;var o=Math.sqrt(n-i),a=r-o,s=r+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=r?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},isIntersectionBox:(X=new Gt.Vector3,function(e){return null!==this.intersectBox(e,X)}),intersectBox:function(e,t){var r,i,n,o,a,s,h=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,u=this.origin;return 0<=h?(r=(e.min.x-u.x)*h,i=(e.max.x-u.x)*h):(r=(e.max.x-u.x)*h,i=(e.min.x-u.x)*h),0<=l?(n=(e.min.y-u.y)*l,o=(e.max.y-u.y)*l):(n=(e.max.y-u.y)*l,o=(e.min.y-u.y)*l),o<r||i<n?null:((r<n||r!=r)&&(r=n),(o<i||i!=i)&&(i=o),0<=c?(a=(e.min.z-u.z)*c,s=(e.max.z-u.z)*c):(a=(e.max.z-u.z)*c,s=(e.min.z-u.z)*c),s<r||i<a?null:((r<a||r!=r)&&(r=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(0<=r?r:i,t)))},intersectTriangle:(z=new Gt.Vector3,H=new Gt.Vector3,j=new Gt.Vector3,W=new Gt.Vector3,function(e,t,r,i,n){H.subVectors(t,e),j.subVectors(r,e),W.crossVectors(H,j);var o,a=this.direction.dot(W);if(0<a){if(i)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}z.subVectors(this.origin,e);var s=o*this.direction.dot(j.crossVectors(z,j));if(s<0)return null;var h=o*this.direction.dot(H.cross(z));if(h<0)return null;if(a<s+h)return null;var l=-o*z.dot(W);return l<0?null:this.at(l/a,n)}),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},Gt.Sphere=function(e,t){this.center=void 0!==e?e:new Gt.Vector3,this.radius=void 0!==t?t:0},Gt.Sphere.prototype={constructor:Gt.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:($=new Gt.Box3,function(e,t){var r=this.center;void 0!==t?r.copy(t):$.setFromPoints(e).center(r);for(var i=0,n=0,o=e.length;n<o;n++)i=Math.max(i,r.distanceToSquared(e[n]));return this.radius=Math.sqrt(i),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),i=t||new Gt.Vector3;return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new Gt.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},Gt.Frustum=function(e,t,r,i,n,o){this.planes=[void 0!==e?e:new Gt.Plane,void 0!==t?t:new Gt.Plane,void 0!==r?r:new Gt.Plane,void 0!==i?i:new Gt.Plane,void 0!==n?n:new Gt.Plane,void 0!==o?o:new Gt.Plane]},Gt.Frustum.prototype={constructor:Gt.Frustum,set:function(e,t,r,i,n,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(n),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],n=r[1],o=r[2],a=r[3],s=r[4],h=r[5],l=r[6],c=r[7],u=r[8],d=r[9],p=r[10],f=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return t[0].setComponents(a-i,c-s,f-u,y-m).normalize(),t[1].setComponents(a+i,c+s,f+u,y+m).normalize(),t[2].setComponents(a+n,c+h,f+d,y+g).normalize(),t[3].setComponents(a-n,c-h,f-d,y-g).normalize(),t[4].setComponents(a-o,c-l,f-p,y-v).normalize(),t[5].setComponents(a+o,c+l,f+p,y+v).normalize(),this},intersectsObject:(re=new Gt.Sphere,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),re.copy(t.boundingSphere),re.applyMatrix4(e.matrixWorld),this.intersectsSphere(re)}),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(r)<i)return!1}return!0},intersectsBox:(ee=new Gt.Vector3,te=new Gt.Vector3,function(e){for(var t=this.planes,r=0;r<6;r++){var i=t[r];ee.x=0<i.normal.x?e.min.x:e.max.x,te.x=0<i.normal.x?e.max.x:e.min.x,ee.y=0<i.normal.y?e.min.y:e.max.y,te.y=0<i.normal.y?e.max.y:e.min.y,ee.z=0<i.normal.z?e.min.z:e.max.z,te.z=0<i.normal.z?e.max.z:e.min.z;var n=i.distanceToPoint(ee),o=i.distanceToPoint(te);if(n<0&&o<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}},Gt.Plane=function(e,t){this.normal=void 0!==e?e:new Gt.Vector3(1,0,0),this.constant=void 0!==t?t:0},Gt.Plane.prototype={constructor:Gt.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:(se=new Gt.Vector3,he=new Gt.Vector3,function(e,t,r){var i=se.subVectors(r,t).cross(he.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e);return(t||new Gt.Vector3).copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&0<r||r<0&&0<t},intersectLine:(ae=new Gt.Vector3,function(e,t){var r=t||new Gt.Vector3,i=e.delta(ae),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?r.copy(e.start):void 0;var o=-(e.start.dot(this.normal)+this.constant)/n;return o<0||1<o?void 0:r.copy(i).multiplyScalar(o).add(e.start)}),coplanarPoint:function(e){return(e||new Gt.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:(ie=new Gt.Vector3,ne=new Gt.Vector3,oe=new Gt.Matrix3,function(e,t){var r=t||oe.getNormalMatrix(e),i=ie.copy(this.normal).applyMatrix3(r),n=this.coplanarPoint(ne);return n.applyMatrix4(e),this.setFromNormalAndCoplanarPoint(i,n),this}),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},Gt.Math={generateUUID:(de="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),pe=new Array(36),fe=0,function(){for(var e=0;e<36;e++)8===e||13===e||18===e||23===e?pe[e]="-":14===e?pe[e]="4":(fe<=2&&(fe=33554432+16777216*Math.random()|0),ue=15&fe,fe>>=4,pe[e]=de[19===e?3&ue|8:ue]);return pe.join("")}),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},smoothstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:(ce=Math.PI/180,function(e){return e*ce}),radToDeg:(le=180/Math.PI,function(e){return e*le}),isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},Gt.Spline=function(e){this.points=e;var t,r,i,n,o,a,s,h,l,c=[],u={x:0,y:0,z:0};function d(e,t,r,i,n,o,a){var s=.5*(r-e),h=.5*(i-t);return(2*(t-r)+s+h)*a+(-3*(t-r)-2*s-h)*o+s*n+t}this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return t=(this.points.length-1)*e,r=Math.floor(t),i=t-r,c[0]=0===r?r:r-1,c[1]=r,c[2]=r>this.points.length-2?this.points.length-1:r+1,c[3]=r>this.points.length-3?this.points.length-1:r+2,a=this.points[c[0]],s=this.points[c[1]],h=this.points[c[2]],l=this.points[c[3]],o=i*(n=i*i),u.x=d(a.x,s.x,h.x,l.x,i,n,o),u.y=d(a.y,s.y,h.y,l.y,i,n,o),u.z=d(a.z,s.z,h.z,l.z,i,n,o),u},this.getControlPointsArray=function(){var e,t,r=this.points.length,i=[];for(e=0;e<r;e++)t=this.points[e],i[e]=[t.x,t.y,t.z];return i},this.getLength=function(e){var t,r,i,n,o=0,a=0,s=0,h=new Gt.Vector3,l=new Gt.Vector3,c=[],u=0;for(c[0]=0,e||(e=100),i=this.points.length*e,h.copy(this.points[0]),t=1;t<i;t++)r=t/i,n=this.getPoint(r),l.copy(n),u+=l.distanceTo(h),h.copy(n),o=(this.points.length-1)*r,(a=Math.floor(o))!==s&&(c[a]=u,s=a);return c[c.length]=u,{chunks:c,total:u}},this.reparametrizeByArcLength=function(e){var t,r,i,n,o,a,s,h,l=[],c=new Gt.Vector3,u=this.getLength();for(l.push(c.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(a=u.chunks[t]-u.chunks[t-1],s=Math.ceil(e*a/u.total),n=(t-1)/(this.points.length-1),o=t/(this.points.length-1),r=1;r<s-1;r++)i=n+r*(1/s)*(o-n),h=this.getPoint(i),l.push(c.copy(h).clone());l.push(c.copy(this.points[t]).clone())}this.points=l}},Gt.Triangle=function(e,t,r){this.a=void 0!==e?e:new Gt.Vector3,this.b=void 0!==t?t:new Gt.Vector3,this.c=void 0!==r?r:new Gt.Vector3},Gt.Triangle.normal=(me=new Gt.Vector3,function(e,t,r,i){var n=i||new Gt.Vector3;n.subVectors(r,t),me.subVectors(e,t),n.cross(me);var o=n.lengthSq();return 0<o?n.multiplyScalar(1/Math.sqrt(o)):n.set(0,0,0)}),Gt.Triangle.barycoordFromPoint=(ge=new Gt.Vector3,ve=new Gt.Vector3,ye=new Gt.Vector3,function(e,t,r,i,n){ge.subVectors(i,t),ve.subVectors(r,t),ye.subVectors(e,t);var o=ge.dot(ge),a=ge.dot(ve),s=ge.dot(ye),h=ve.dot(ve),l=ve.dot(ye),c=o*h-a*a,u=n||new Gt.Vector3;if(0===c)return u.set(-2,-1,-1);var d=1/c,p=(h*s-a*l)*d,f=(o*l-a*s)*d;return u.set(1-p-f,f,p)}),Gt.Triangle.containsPoint=(xe=new Gt.Vector3,function(e,t,r,i){var n=Gt.Triangle.barycoordFromPoint(e,t,r,i,xe);return 0<=n.x&&0<=n.y&&n.x+n.y<=1}),Gt.Triangle.prototype={constructor:Gt.Triangle,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:(_e=new Gt.Vector3,be=new Gt.Vector3,function(){return _e.subVectors(this.c,this.b),be.subVectors(this.a,this.b),.5*_e.cross(be).length()}),midpoint:function(e){return(e||new Gt.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return Gt.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new Gt.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return Gt.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return Gt.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},Gt.Channels=function(){this.mask=1},Gt.Channels.prototype={constructor:Gt.Channels,set:function(e){this.mask=1<<e},enable:function(e){this.mask|=1<<e},toggle:function(e){this.mask^=1<<e},disable:function(e){this.mask&=~(1<<e)}},Gt.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},Gt.Clock.prototype={constructor:Gt.Clock,start:function(){this.startTime=Nt.performance.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=Nt.performance.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},Gt.EventDispatcher=function(){},Gt.EventDispatcher.prototype={constructor:Gt.EventDispatcher,apply:function(e){e.addEventListener=Gt.EventDispatcher.prototype.addEventListener,e.hasEventListener=Gt.EventDispatcher.prototype.hasEventListener,e.removeEventListener=Gt.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=Gt.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=[],i=t.length,n=0;n<i;n++)r[n]=t[n];for(n=0;n<i;n++)r[n].call(this,e)}}}},function(n){function o(e,t){return e.distance-t.distance}function s(e,t,r,i){if(!1!==e.visible&&(e.raycast(t,r),!0===i))for(var n=e.children,o=0,a=n.length;o<a;o++)s(n[o],t,r,!0)}n.Raycaster=function(e,t,r,i){this.ray=new n.Ray(e,t),this.near=r||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})},n.Raycaster.prototype={constructor:n.Raycaster,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t instanceof n.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t instanceof n.OrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t){var r=[];return s(e,this,r,t),r.sort(o),r},intersectObjects:function(e,t){var r=[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var i=0,n=e.length;i<n;i++)s(e[i],this,r,t);return r.sort(o),r}}}(Gt),Gt.Object3D=function(){Object.defineProperty(this,"id",{value:Gt.Object3DIdCount++}),this.uuid=Gt.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.channels=new Gt.Channels,this.children=[],this.up=Gt.Object3D.DefaultUp.clone();var e=new Gt.Vector3,t=new Gt.Euler,r=new Gt.Quaternion,i=new Gt.Vector3(1,1,1);t.onChange(function(){r.setFromEuler(t,!1)}),r.onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:i},modelViewMatrix:{value:new Gt.Matrix4},normalMatrix:{value:new Gt.Matrix3}}),this.rotationAutoUpdate=!0,this.matrix=new Gt.Matrix4,this.matrixWorld=new Gt.Matrix4,this.matrixAutoUpdate=Gt.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},Gt.Object3D.DefaultUp=new Gt.Vector3(0,1,0),Gt.Object3D.DefaultMatrixAutoUpdate=!0,Gt.Object3D.prototype={constructor:Gt.Object3D,get eulerOrder(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set renderDepth(e){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(Be=new Gt.Quaternion,function(e,t){return Be.setFromAxisAngle(e,t),this.quaternion.multiply(Be),this}),rotateX:(Ue=new Gt.Vector3(1,0,0),function(e){return this.rotateOnAxis(Ue,e)}),rotateY:(Ve=new Gt.Vector3(0,1,0),function(e){return this.rotateOnAxis(Ve,e)}),rotateZ:(Fe=new Gt.Vector3(0,0,1),function(e){return this.rotateOnAxis(Fe,e)}),translateOnAxis:(De=new Gt.Vector3,function(e,t){return De.copy(e).applyQuaternion(this.quaternion),this.position.add(De.multiplyScalar(t)),this}),translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:(Re=new Gt.Vector3(1,0,0),function(e){return this.translateOnAxis(Re,e)}),translateY:(ke=new Gt.Vector3(0,1,0),function(e){return this.translateOnAxis(ke,e)}),translateZ:(Pe=new Gt.Vector3(0,0,1),function(e){return this.translateOnAxis(Pe,e)}),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(Le=new Gt.Matrix4,function(e){return e.applyMatrix4(Le.getInverse(this.matrixWorld))}),lookAt:(Ae=new Gt.Matrix4,function(e){Ae.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(Ae)}),add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e instanceof Gt.Object3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this},remove:function(e){if(1<arguments.length)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var r=this.children.indexOf(e);-1!==r&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(r,1))},getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){var t=e||new Gt.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(Te=new Gt.Vector3,Ce=new Gt.Vector3,function(e){var t=e||new Gt.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(Te,t,Ce),t}),getWorldRotation:(Ee=new Gt.Quaternion,function(e){var t=e||new Gt.Euler;return this.getWorldQuaternion(Ee),t.setFromQuaternion(Ee,this.rotation.order,!1)}),getWorldScale:(Me=new Gt.Vector3,Se=new Gt.Quaternion,function(e){var t=e||new Gt.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(Me,Se,t),t}),getWorldDirection:(we=new Gt.Quaternion,function(e){var t=e||new Gt.Vector3;return this.getWorldQuaternion(we),t.set(0,0,1).applyQuaternion(we)}),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e=!(this.matrixWorldNeedsUpdate=!1));for(var t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(e){var t=void 0===e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{}},r.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var i={};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),i.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===e.geometries[this.geometry.uuid]&&(e.geometries[this.geometry.uuid]=this.geometry.toJSON(e)),i.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===e.materials[this.material.uuid]&&(e.materials[this.material.uuid]=this.material.toJSON(e)),i.material=this.material.uuid),0<this.children.length){i.children=[];for(var n=0;n<this.children.length;n++)i.children.push(this.children[n].toJSON(e).object)}if(t){var o=l(e.geometries),a=l(e.materials),s=l(e.textures),h=l(e.images);0<o.length&&(r.geometries=o),0<a.length&&(r.materials=a),0<s.length&&(r.textures=s),0<h.length&&(r.images=h)}return r.object=i,r;function l(e){var t=[];for(var r in e){var i=e[r];delete i.metadata,t.push(i)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.rotationAutoUpdate=e.rotationAutoUpdate,this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var i=e.children[r];this.add(i.clone())}return this}},Gt.EventDispatcher.prototype.apply(Gt.Object3D.prototype),Gt.Object3DIdCount=0,Gt.Face3=function(e,t,r,i,n,o){this.a=e,this.b=t,this.c=r,this.normal=i instanceof Gt.Vector3?i:new Gt.Vector3,this.vertexNormals=Array.isArray(i)?i:[],this.color=n instanceof Gt.Color?n:new Gt.Color,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==o?o:0},Gt.Face3.prototype={constructor:Gt.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}},Gt.Face4=function(e,t,r,i,n,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Gt.Face3(e,t,r,n,o,a)},Gt.BufferAttribute=function(e,t){this.uuid=Gt.Math.generateUUID(),this.array=e,this.itemSize=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},Gt.BufferAttribute.prototype={constructor:Gt.BufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.array.length/this.itemSize},set needsUpdate(e){!0===e&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var i=0,n=this.itemSize;i<n;i++)this.array[e+i]=t.array[r+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new Gt.Color),t[r++]=o.r,t[r++]=o.g,t[r++]=o.b}return this},copyIndicesArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];t[r++]=o.a,t[r++]=o.b,t[r++]=o.c}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new Gt.Vector2),t[r++]=o.x,t[r++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new Gt.Vector3),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new Gt.Vector4),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z,t[r++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this},clone:function(){return(new this.constructor).copy(this)}},Gt.Int8Attribute=function(e,t){return new Gt.BufferAttribute(new Int8Array(e),t)},Gt.Uint8Attribute=function(e,t){return new Gt.BufferAttribute(new Uint8Array(e),t)},Gt.Uint8ClampedAttribute=function(e,t){return new Gt.BufferAttribute(new Uint8ClampedArray(e),t)},Gt.Int16Attribute=function(e,t){return new Gt.BufferAttribute(new Int16Array(e),t)},Gt.Uint16Attribute=function(e,t){return new Gt.BufferAttribute(new Uint16Array(e),t)},Gt.Int32Attribute=function(e,t){return new Gt.BufferAttribute(new Int32Array(e),t)},Gt.Uint32Attribute=function(e,t){return new Gt.BufferAttribute(new Uint32Array(e),t)},Gt.Float32Attribute=function(e,t){return new Gt.BufferAttribute(new Float32Array(e),t)},Gt.Float64Attribute=function(e,t){return new Gt.BufferAttribute(new Float64Array(e),t)},Gt.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new Gt.BufferAttribute(e,t).setDynamic(!0)},Gt.InstancedBufferAttribute=function(e,t,r){Gt.BufferAttribute.call(this,e,t),this.meshPerAttribute=r||1},Gt.InstancedBufferAttribute.prototype=Object.create(Gt.BufferAttribute.prototype),Gt.InstancedBufferAttribute.prototype.constructor=Gt.InstancedBufferAttribute,Gt.InstancedBufferAttribute.prototype.copy=function(e){return Gt.BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},Gt.InterleavedBuffer=function(e,t){this.uuid=Gt.Math.generateUUID(),this.array=e,this.stride=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},Gt.InterleavedBuffer.prototype={constructor:Gt.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(e){!0===e&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){this.array=new e.array.constructor(e.array),this.stride=e.stride,this.dynamic=e.dynamic},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var i=0,n=this.stride;i<n;i++)this.array[e+i]=t.array[r+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)}},Gt.InstancedInterleavedBuffer=function(e,t,r){Gt.InterleavedBuffer.call(this,e,t),this.meshPerAttribute=r||1},Gt.InstancedInterleavedBuffer.prototype=Object.create(Gt.InterleavedBuffer.prototype),Gt.InstancedInterleavedBuffer.prototype.constructor=Gt.InstancedInterleavedBuffer,Gt.InstancedInterleavedBuffer.prototype.copy=function(e){return Gt.InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},Gt.InterleavedBufferAttribute=function(e,t,r){this.uuid=Gt.Math.generateUUID(),this.data=e,this.itemSize=t,this.offset=r},Gt.InterleavedBufferAttribute.prototype={constructor:Gt.InterleavedBufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.data.array.length/this.data.stride},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}},Gt.Geometry=function(){Object.defineProperty(this,"id",{value:Gt.GeometryIdCount++}),this.uuid=Gt.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},Gt.Geometry.prototype={constructor:Gt.Geometry,applyMatrix:function(e){for(var t=(new Gt.Matrix3).getNormalMatrix(e),r=0,i=this.vertices.length;r<i;r++){this.vertices[r].applyMatrix4(e)}for(r=0,i=this.faces.length;r<i;r++){var n=this.faces[r];n.normal.applyMatrix3(t).normalize();for(var o=0,a=n.vertexNormals.length;o<a;o++)n.vertexNormals[o].applyMatrix3(t).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},rotateX:function(e){return void 0===He&&(He=new Gt.Matrix4),He.makeRotationX(e),this.applyMatrix(He),this},rotateY:function(e){return void 0===ze&&(ze=new Gt.Matrix4),ze.makeRotationY(e),this.applyMatrix(ze),this},rotateZ:function(e){return void 0===Ie&&(Ie=new Gt.Matrix4),Ie.makeRotationZ(e),this.applyMatrix(Ie),this},translate:function(e,t,r){return void 0===Ge&&(Ge=new Gt.Matrix4),Ge.makeTranslation(e,t,r),this.applyMatrix(Ge),this},scale:function(e,t,r){return void 0===Ne&&(Ne=new Gt.Matrix4),Ne.makeScale(e,t,r),this.applyMatrix(Ne),this},lookAt:function(e){void 0===Oe&&(Oe=new Gt.Object3D),Oe.lookAt(e),Oe.updateMatrix(),this.applyMatrix(Oe.matrix)},fromBufferGeometry:function(e){var a=this,t=null!==e.index?e.index.array:void 0,r=e.attributes,i=r.position.array,s=void 0!==r.normal?r.normal.array:void 0,h=void 0!==r.color?r.color.array:void 0,l=void 0!==r.uv?r.uv.array:void 0,c=void 0!==r.uv2?r.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var u=[],d=[],p=[],n=0,o=0,f=0;n<i.length;n+=3,o+=2,f+=4)a.vertices.push(new Gt.Vector3(i[n],i[n+1],i[n+2])),void 0!==s&&u.push(new Gt.Vector3(s[n],s[n+1],s[n+2])),void 0!==h&&a.colors.push(new Gt.Color(h[n],h[n+1],h[n+2])),void 0!==l&&d.push(new Gt.Vector2(l[o],l[o+1])),void 0!==c&&p.push(new Gt.Vector2(c[o],c[o+1]));function m(e,t,r){var i=void 0!==s?[u[e].clone(),u[t].clone(),u[r].clone()]:[],n=void 0!==h?[a.colors[e].clone(),a.colors[t].clone(),a.colors[r].clone()]:[],o=new Gt.Face3(e,t,r,i,n);a.faces.push(o),void 0!==l&&a.faceVertexUvs[0].push([d[e].clone(),d[t].clone(),d[r].clone()]),void 0!==c&&a.faceVertexUvs[1].push([p[e].clone(),p[t].clone(),p[r].clone()])}if(void 0!==t){var g=e.groups;if(0<g.length)for(n=0;n<g.length;n++)for(var v=g[n],y=v.start,x=(o=y,y+v.count);o<x;o+=3)m(t[o],t[o+1],t[o+2]);else for(n=0;n<t.length;n+=3)m(t[n],t[n+1],t[n+2])}else for(n=0;n<i.length/3;n+=3)m(n,n+1,n+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,i=new Gt.Matrix4;return i.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new Gt.Vector3,t=new Gt.Vector3,r=0,i=this.faces.length;r<i;r++){var n=this.faces[r],o=this.vertices[n.a],a=this.vertices[n.b],s=this.vertices[n.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,r,i,n,o,a;for(a=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)a[t]=new Gt.Vector3;if(e){var s,h,l,c=new Gt.Vector3,u=new Gt.Vector3;for(i=0,n=this.faces.length;i<n;i++)o=this.faces[i],s=this.vertices[o.a],h=this.vertices[o.b],l=this.vertices[o.c],c.subVectors(l,h),u.subVectors(s,h),c.cross(u),a[o.a].add(c),a[o.b].add(c),a[o.c].add(c)}else for(i=0,n=this.faces.length;i<n;i++)a[(o=this.faces[i]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,r=this.vertices.length;t<r;t++)a[t].normalize();for(i=0,n=this.faces.length;i<n;i++){var d=(o=this.faces[i]).vertexNormals;3===d.length?(d[0].copy(a[o.a]),d[1].copy(a[o.b]),d[2].copy(a[o.c])):(d[0]=a[o.a].clone(),d[1]=a[o.b].clone(),d[2]=a[o.c].clone())}},computeMorphNormals:function(){var e,t,r,i,n;for(r=0,i=this.faces.length;r<i;r++)for((n=this.faces[r]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var o=new Gt.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;r<i;r++)h=new Gt.Vector3,l={a:new Gt.Vector3,b:new Gt.Vector3,c:new Gt.Vector3},a.push(h),s.push(l)}var h,l,c=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,i=this.faces.length;r<i;r++)n=this.faces[r],h=c.faceNormals[r],l=c.vertexNormals[r],h.copy(n.normal),l.a.copy(n.vertexNormals[0]),l.b.copy(n.vertexNormals[1]),l.c.copy(n.vertexNormals[2])}for(r=0,i=this.faces.length;r<i;r++)(n=this.faces[r]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,i=t.length;r<i;r++)0<r&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Gt.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Gt.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e instanceof Gt.Geometry!=!1){var i,n=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,h=e.faces,l=this.faceVertexUvs[0],c=e.faceVertexUvs[0];void 0===r&&(r=0),void 0!==t&&(i=(new Gt.Matrix3).getNormalMatrix(t));for(var u=0,d=a.length;u<d;u++){var p=a[u].clone();void 0!==t&&p.applyMatrix4(t),o.push(p)}for(u=0,d=h.length;u<d;u++){var f,m,g,v=h[u],y=v.vertexNormals,x=v.vertexColors;(f=new Gt.Face3(v.a+n,v.b+n,v.c+n)).normal.copy(v.normal),void 0!==i&&f.normal.applyMatrix3(i).normalize();for(var _=0,b=y.length;_<b;_++)m=y[_].clone(),void 0!==i&&m.applyMatrix3(i).normalize(),f.vertexNormals.push(m);f.color.copy(v.color);for(_=0,b=x.length;_<b;_++)g=x[_],f.vertexColors.push(g.clone());f.materialIndex=v.materialIndex+r,s.push(f)}for(u=0,d=c.length;u<d;u++){var w=c[u],M=[];if(void 0!==w){for(_=0,b=w.length;_<b;_++)M.push(w[_].clone());l.push(M)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e instanceof Gt.Mesh!=!1?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,r,i,n,o,a,s,h={},l=[],c=[],u=Math.pow(10,4);for(r=0,i=this.vertices.length;r<i;r++)e=this.vertices[r],void 0===h[t=Math.round(e.x*u)+"_"+Math.round(e.y*u)+"_"+Math.round(e.z*u)]?(h[t]=r,l.push(this.vertices[r]),c[r]=l.length-1):c[r]=c[h[t]];var d=[];for(r=0,i=this.faces.length;r<i;r++){(n=this.faces[r]).a=c[n.a],n.b=c[n.b],n.c=c[n.c],o=[n.a,n.b,n.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){p,d.push(r);break}}for(r=d.length-1;0<=r;r--){var f=d[r];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-l.length;return this.vertices=l,m},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var i,n,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(i=[]),a&&a.length===t&&(n=[]);for(r=0;r<t;r++){var s=e[r]._id;i&&i.push(o[s]),n&&n.push(a[s])}i&&(this.faceVertexUvs[0]=i),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){var e={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var i=[],n=0;n<this.vertices.length;n++){var o=this.vertices[n];i.push(o.x,o.y,o.z)}var a=[],s=[],h={},l=[],c={},u=[],d={};for(n=0;n<this.faces.length;n++){var p=this.faces[n],f=void 0!==this.faceVertexUvs[0][n],m=0<p.normal.length(),g=0<p.vertexNormals.length,v=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=0<p.vertexColors.length,x=0;if(x=M(x=M(x=M(x=M(x=M(x=M(x=M(x=M(x,0,0),1,!1),2,!1),3,f),4,m),5,g),6,v),7,y),a.push(x),a.push(p.a,p.b,p.c),f){var _=this.faceVertexUvs[0][n];a.push(T(_[0]),T(_[1]),T(_[2]))}if(m&&a.push(S(p.normal)),g){var b=p.vertexNormals;a.push(S(b[0]),S(b[1]),S(b[2]))}if(v&&a.push(E(p.color)),y){var w=p.vertexColors;a.push(E(w[0]),E(w[1]),E(w[2]))}}function M(e,t,r){return r?e|1<<t:e&~(1<<t)}function S(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==h[t]||(h[t]=s.length/3,s.push(e.x,e.y,e.z)),h[t]}function E(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=l.length,l.push(e.getHex())),c[t]}function T(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=u.length/2,u.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=i,e.data.normals=s,0<l.length&&(e.data.colors=l),0<u.length&&(e.data.uvs=[u]),e.data.faces=a,e},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];for(var t=e.vertices,r=0,i=t.length;r<i;r++)this.vertices.push(t[r].clone());var n=e.faces;for(r=0,i=n.length;r<i;r++)this.faces.push(n[r].clone());for(r=0,i=e.faceVertexUvs.length;r<i;r++){var o=e.faceVertexUvs[r];void 0===this.faceVertexUvs[r]&&(this.faceVertexUvs[r]=[]);for(var a=0,s=o.length;a<s;a++){for(var h=o[a],l=[],c=0,u=h.length;c<u;c++){var d=h[c];l.push(d.clone())}this.faceVertexUvs[r].push(l)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},Gt.EventDispatcher.prototype.apply(Gt.Geometry.prototype),Gt.GeometryIdCount=0,Gt.DirectGeometry=function(){Object.defineProperty(this,"id",{value:Gt.GeometryIdCount++}),this.uuid=Gt.Math.generateUUID(),this.name="",this.type="DirectGeometry",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1},Gt.DirectGeometry.prototype={constructor:Gt.DirectGeometry,computeBoundingBox:Gt.Geometry.prototype.computeBoundingBox,computeBoundingSphere:Gt.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(e){for(var t,r,i=[],n=e.faces,o=0;o<n.length;o++){var a=n[o];a.materialIndex!==r&&(r=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,i.push(t)),t={start:3*o,materialIndex:r})}void 0!==t&&(t.count=3*o-t.start,i.push(t)),this.groups=i},fromGeometry:function(e){var t=e.faces,r=e.vertices,i=e.faceVertexUvs,n=i[0]&&0<i[0].length,o=i[1]&&0<i[1].length,a=e.morphTargets,s=a.length;if(0<s){for(var h=[],l=0;l<s;l++)h[l]=[];this.morphTargets.position=h}var c=e.morphNormals,u=c.length;if(0<u){var d=[];for(l=0;l<u;l++)d[l]=[];this.morphTargets.normal=d}var p=e.skinIndices,f=e.skinWeights,m=p.length===r.length,g=f.length===r.length;for(l=0;l<t.length;l++){var v=t[l];this.vertices.push(r[v.a],r[v.b],r[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var x=v.normal;this.normals.push(x,x,x)}var _,b=v.vertexColors;if(3===b.length)this.colors.push(b[0],b[1],b[2]);else{var w=v.color;this.colors.push(w,w,w)}if(!0===n)void 0!==(_=i[0][l])?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",l),this.uvs.push(new Gt.Vector2,new Gt.Vector2,new Gt.Vector2));if(!0===o)void 0!==(_=i[1][l])?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new Gt.Vector2,new Gt.Vector2,new Gt.Vector2));for(var M=0;M<s;M++){var S=a[M].vertices;h[M].push(S[v.a],S[v.b],S[v.c])}for(M=0;M<u;M++){var E=c[M].vertexNormals[l];d[M].push(E.a,E.b,E.c)}m&&this.skinIndices.push(p[v.a],p[v.b],p[v.c]),g&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},Gt.EventDispatcher.prototype.apply(Gt.DirectGeometry.prototype),Gt.BufferGeometry=function(){Object.defineProperty(this,"id",{value:Gt.GeometryIdCount++}),this.uuid=Gt.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}},Gt.BufferGeometry.prototype={constructor:Gt.BufferGeometry,addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},getIndex:function(){return this.index},setIndex:function(e){this.index=e},addAttribute:function(e,t){return t instanceof Gt.BufferAttribute==!1&&t instanceof Gt.InterleavedBufferAttribute==!1?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new Gt.BufferAttribute(t,arguments[2]))):"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):void(this.attributes[e]=t)},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){delete this.attributes[e]},get drawcalls(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups},get offsets(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var r=this.attributes.normal;void 0!==r&&((new Gt.Matrix3).getNormalMatrix(e).applyToVector3Array(r.array),r.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},rotateX:function(e){return void 0===Je&&(Je=new Gt.Matrix4),Je.makeRotationX(e),this.applyMatrix(Je),this},rotateY:function(e){return void 0===Ze&&(Ze=new Gt.Matrix4),Ze.makeRotationY(e),this.applyMatrix(Ze),this},rotateZ:function(e){return void 0===Qe&&(Qe=new Gt.Matrix4),Qe.makeRotationZ(e),this.applyMatrix(Qe),this},translate:function(e,t,r){return void 0===Ke&&(Ke=new Gt.Matrix4),Ke.makeTranslation(e,t,r),this.applyMatrix(Ke),this},scale:function(e,t,r){return void 0===Ye&&(Ye=new Gt.Matrix4),Ye.makeScale(e,t,r),this.applyMatrix(Ye),this},lookAt:function(e){void 0===qe&&(qe=new Gt.Object3D),qe.lookAt(e),qe.updateMatrix(),this.applyMatrix(qe.matrix)},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e instanceof Gt.Points||e instanceof Gt.Line){var r=new Gt.Float32Attribute(3*t.vertices.length,3),i=new Gt.Float32Attribute(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new Gt.Float32Attribute(t.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e instanceof Gt.Mesh&&t instanceof Gt.Geometry&&this.fromGeometry(t);return this},updateFromObject:function(e){var t,r=e.geometry;if(e instanceof Gt.Mesh){var i=r.__directGeometry;if(void 0===i)return this.fromGeometry(r);i.verticesNeedUpdate=r.verticesNeedUpdate,i.normalsNeedUpdate=r.normalsNeedUpdate,i.colorsNeedUpdate=r.colorsNeedUpdate,i.uvsNeedUpdate=r.uvsNeedUpdate,i.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=i}!0===r.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1);!0===r.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1);!0===r.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1);r.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1);r.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1);return r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Gt.DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new Gt.BufferAttribute(t,3).copyVector3sArray(e.vertices)),0<e.normals.length){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new Gt.BufferAttribute(r,3).copyVector3sArray(e.normals))}if(0<e.colors.length){var i=new Float32Array(3*e.colors.length);this.addAttribute("color",new Gt.BufferAttribute(i,3).copyColorsArray(e.colors))}if(0<e.uvs.length){var n=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new Gt.BufferAttribute(n,2).copyVector2sArray(e.uvs))}if(0<e.uvs2.length){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new Gt.BufferAttribute(o,2).copyVector2sArray(e.uvs2))}if(0<e.indices.length){var a=new(65535<e.vertices.length?Uint32Array:Uint16Array)(3*e.indices.length);this.setIndex(new Gt.BufferAttribute(a,1).copyIndicesArray(e.indices))}for(var s in this.groups=e.groups,e.morphTargets){for(var h=[],l=e.morphTargets[s],c=0,u=l.length;c<u;c++){var d=l[c],p=new Gt.Float32Attribute(3*d.length,3);h.push(p.copyVector3sArray(d))}this.morphAttributes[s]=h}if(0<e.skinIndices.length){var f=new Gt.Float32Attribute(4*e.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(0<e.skinWeights.length){var m=new Gt.Float32Attribute(4*e.skinWeights.length,4);this.addAttribute("skinWeight",m.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:(Xe=new Gt.Vector3,function(){null===this.boundingBox&&(this.boundingBox=new Gt.Box3);var e=this.attributes.position.array;if(e){var t=this.boundingBox;t.makeEmpty();for(var r=0,i=e.length;r<i;r+=3)Xe.fromArray(e,r),t.expandByPoint(Xe)}void 0!==e&&0!==e.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}),computeBoundingSphere:(je=new Gt.Box3,We=new Gt.Vector3,function(){null===this.boundingSphere&&(this.boundingSphere=new Gt.Sphere);var e=this.attributes.position.array;if(e){je.makeEmpty();for(var t=this.boundingSphere.center,r=0,i=e.length;r<i;r+=3)We.fromArray(e,r),je.expandByPoint(We);je.center(t);var n=0;for(r=0,i=e.length;r<i;r+=3)We.fromArray(e,r),n=Math.max(n,t.distanceToSquared(We));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,r=this.groups;if(t.position){var i=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new Gt.BufferAttribute(new Float32Array(i.length),3));else for(var n=0,o=(l=t.normal.array).length;n<o;n++)l[n]=0;var a,s,h,l=t.normal.array,c=new Gt.Vector3,u=new Gt.Vector3,d=new Gt.Vector3,p=new Gt.Vector3,f=new Gt.Vector3;if(e){var m=e.array;0===r.length&&this.addGroup(0,m.length);for(var g=0,v=r.length;g<v;++g){var y=r[g],x=y.start;for(n=x,o=x+y.count;n<o;n+=3)a=3*m[n+0],s=3*m[n+1],h=3*m[n+2],c.fromArray(i,a),u.fromArray(i,s),d.fromArray(i,h),p.subVectors(d,u),f.subVectors(c,u),p.cross(f),l[a]+=p.x,l[a+1]+=p.y,l[a+2]+=p.z,l[s]+=p.x,l[s+1]+=p.y,l[s+2]+=p.z,l[h]+=p.x,l[h+1]+=p.y,l[h+2]+=p.z}}else for(n=0,o=i.length;n<o;n+=9)c.fromArray(i,n),u.fromArray(i,n+3),d.fromArray(i,n+6),p.subVectors(d,u),f.subVectors(c,u),p.cross(f),l[n]=p.x,l[n+1]=p.y,l[n+2]=p.z,l[n+3]=p.x,l[n+4]=p.y,l[n+5]=p.z,l[n+6]=p.x,l[n+7]=p.y,l[n+8]=p.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(e){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},merge:function(e,t){if(e instanceof Gt.BufferGeometry!=!1){void 0===t&&(t=0);var r=this.attributes;for(var i in r)if(void 0!==e.attributes[i])for(var n=r[i].array,o=e.attributes[i],a=o.array,s=0,h=o.itemSize*t;s<a.length;s++,h++)n[h]=a[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e,t,r,i,n=this.attributes.normal.array,o=0,a=n.length;o<a;o+=3)e=n[o],t=n[o+1],r=n[o+2],i=1/Math.sqrt(e*e+t*t+r*r),n[o]*=i,n[o+1]*=i,n[o+2]*=i},toJSON:function(){var e={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var i=this.index;if(null!==i){var n=Array.prototype.slice.call(i.array);e.data.index={type:i.array.constructor.name,array:n}}var o=this.attributes;for(var r in o){var a=o[r];n=Array.prototype.slice.call(a.array);e.data.attributes[r]={itemSize:a.itemSize,type:a.array.constructor.name,array:n}}var s=this.groups;0<s.length&&(e.data.groups=JSON.parse(JSON.stringify(s)));var h=this.boundingSphere;return null!==h&&(e.data.boundingSphere={center:h.center.toArray(),radius:h.radius}),e},clone:function(){return(new this.constructor).copy(this)},copy:function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var r=e.attributes;for(var i in r){var n=r[i];this.addAttribute(i,n.clone())}for(var o=e.groups,a=0,s=o.length;a<s;a++){var h=o[a];this.addGroup(h.start,h.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},Gt.EventDispatcher.prototype.apply(Gt.BufferGeometry.prototype),Gt.BufferGeometry.MaxIndex=65535,Gt.InstancedBufferGeometry=function(){Gt.BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0},Gt.InstancedBufferGeometry.prototype=Object.create(Gt.BufferGeometry.prototype),Gt.InstancedBufferGeometry.prototype.constructor=Gt.InstancedBufferGeometry,Gt.InstancedBufferGeometry.prototype.addGroup=function(e,t,r){this.groups.push({start:e,count:t,instances:r})},Gt.InstancedBufferGeometry.prototype.copy=function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var r=e.attributes;for(var i in r){var n=r[i];this.addAttribute(i,n.clone())}for(var o=e.groups,a=0,s=o.length;a<s;a++){var h=o[a];this.addGroup(h.start,h.count,h.instances)}return this},Gt.EventDispatcher.prototype.apply(Gt.InstancedBufferGeometry.prototype),Gt.AnimationAction=function(e,t,r,i,n){if(void 0===e)throw new Error("clip is null");this.clip=e,this.localRoot=null,this.startTime=t||0,this.timeScale=r||1,this.weight=i||1,this.loop=n||Gt.LoopRepeat,this.loopCount=0,this.enabled=!0,this.actionTime=-this.startTime,this.clipTime=0,this.propertyBindings=[]},Gt.AnimationAction.prototype={constructor:Gt.AnimationAction,setLocalRoot:function(e){return this.localRoot=e,this},updateTime:function(e){var t=this.clipTime,r=this.loopCount,i=(this.actionTime,this.clip.duration);if(this.actionTime=this.actionTime+e,this.loop===Gt.LoopOnce)return this.loopCount=0,this.clipTime=Math.min(Math.max(this.actionTime,0),i),this.clipTime!==t&&(this.clipTime===i?this.mixer.dispatchEvent({type:"finished",action:this,direction:1}):0===this.clipTime&&this.mixer.dispatchEvent({type:"finished",action:this,direction:-1})),this.clipTime;this.loopCount=Math.floor(this.actionTime/i);var n=this.actionTime-this.loopCount*i;return n%=i,this.loop==Gt.LoopPingPong&&1===Math.abs(this.loopCount%2)&&(n=i-n),this.clipTime=n,this.loopCount!==r&&this.mixer.dispatchEvent({type:"loop",action:this,loopDelta:this.loopCount-this.loopCount}),this.clipTime},syncWith:function(e){return this.actionTime=e.actionTime,this.timeScale=e.timeScale,this},warpToDuration:function(e){return this.timeScale=this.clip.duration/e,this},init:function(e){return this.clipTime=e-this.startTime,this},update:function(e){return this.updateTime(e),this.clip.getAt(this.clipTime)},getTimeScaleAt:function(e){return this.timeScale.getAt?this.timeScale.getAt(e):this.timeScale},getWeightAt:function(e){return this.weight.getAt?this.weight.getAt(e):this.weight}},Gt.AnimationClip=function(e,t,r){if(this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.duration<0)for(var i=0;i<this.tracks.length;i++){var n=this.tracks[i];this.duration=Math.max(n.keys[n.keys.length-1].time)}this.trim(),this.optimize(),this.results=[]},Gt.AnimationClip.prototype={constructor:Gt.AnimationClip,getAt:function(e){e=Math.max(0,Math.min(e,this.duration));for(var t=0;t<this.tracks.length;t++){var r=this.tracks[t];this.results[t]=r.getAt(e)}return this.results},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},Gt.AnimationClip.CreateFromMorphTargetSequence=function(e,t,r){for(var i=t.length,n=[],o=0;o<i;o++){var a=[];a.push({time:(o+i-1)%i,value:0}),a.push({time:o,value:1}),a.push({time:(o+1)%i,value:0}),a.sort(Gt.KeyframeTrack.keyComparer),0===a[0].time&&a.push({time:i,value:a[0].value}),n.push(new Gt.NumberKeyframeTrack(".morphTargetInfluences["+t[o].name+"]",a).scale(1/r))}return new Gt.AnimationClip(e,-1,n)},Gt.AnimationClip.findByName=function(e,t){for(var r=0;r<e.length;r++)if(e[r].name===t)return e[r];return null},Gt.AnimationClip.CreateClipsFromMorphTargetSequences=function(e,t){for(var r={},i=/^([\w-]*?)([\d]+)$/,n=0,o=e.length;n<o;n++){var a=e[n],s=a.name.match(i);if(s&&1<s.length){var h=r[c=s[1]];h||(r[c]=h=[]),h.push(a)}}var l=[];for(var c in r)l.push(Gt.AnimationClip.CreateFromMorphTargetSequence(c,r[c],t));return l},Gt.AnimationClip.parse=function(e){for(var t=[],r=0;r<e.tracks.length;r++)t.push(Gt.KeyframeTrack.parse(e.tracks[r]).scale(1/e.fps));return new Gt.AnimationClip(e.name,e.duration,t)},Gt.AnimationClip.parseAnimation=function(e,t,r){if(!e)return console.error("  no animation in JSONLoader data"),null;for(var i=function(e,t,r,i,n){for(var o=[],a=0;a<t.length;a++){var s=t[a];void 0!==s[r]&&o.push({time:s.time,value:n(s)})}return 0<o.length?new i(e,o):null},n=[],o=e.name||"default",a=e.length||-1,s=e.fps||30,h=e.hierarchy||[],l=0;l<h.length;l++){var c=h[l].keys;if(c&&0!=c.length)if(c[0].morphTargets){for(var u={},d=0;d<c.length;d++)if(c[d].morphTargets)for(var p=0;p<c[d].morphTargets.length;p++)u[c[d].morphTargets[p]]=-1;for(var f in u){var m=[];for(p=0;p<c[d].morphTargets.length;p++){var g=c[d];m.push({time:g.time,value:g.morphTarget===f?1:0})}n.push(new Gt.NumberKeyframeTrack(r+".morphTargetInfluence["+f+"]",m))}a=u.length*(s||1)}else{var v=r+".bones["+t[l].name+"]",y=i(v+".position",c,"pos",Gt.VectorKeyframeTrack,function(e){return(new Gt.Vector3).fromArray(e.pos)});y&&n.push(y);var x=i(v+".quaternion",c,"rot",Gt.QuaternionKeyframeTrack,function(e){return e.rot.slerp?e.rot.clone():(new Gt.Quaternion).fromArray(e.rot)});x&&n.push(x);var _=i(v+".scale",c,"scl",Gt.VectorKeyframeTrack,function(e){return(new Gt.Vector3).fromArray(e.scl)});_&&n.push(_)}}return 0===n.length?null:new Gt.AnimationClip(o,a,n)},Gt.AnimationMixer=function(e){this.root=e,this.time=0,this.timeScale=1,this.actions=[],this.propertyBindingMap={}},Gt.AnimationMixer.prototype={constructor:Gt.AnimationMixer,addAction:function(e){this.actions.push(e),e.init(this.time),e.mixer=this;for(var t=e.clip.tracks,r=e.localRoot||this.root,i=0;i<t.length;i++){var n=t[i],o=r.uuid+"-"+n.name,a=this.propertyBindingMap[o];void 0===a&&(a=new Gt.PropertyBinding(r,n.name),this.propertyBindingMap[o]=a),e.propertyBindings.push(a),a.referenceCount+=1}},removeAllActions:function(){for(var e=0;e<this.actions.length;e++)this.actions[e].mixer=null;for(var t in this.propertyBindingMap)this.propertyBindingMap[t].unbind();return this.actions=[],this.propertyBindingMap={},this},removeAction:function(e){var t=this.actions.indexOf(e);-1!==t&&(this.actions.splice(t,1),e.mixer=null);for(var r=e.localRoot||this.root,i=e.clip.tracks,n=0;n<i.length;n++){var o=i[n],a=r.uuid+"-"+o.name,s=this.propertyBindingMap[a];s.referenceCount-=1,s.referenceCount<=0&&(s.unbind(),delete this.propertyBindingMap[a])}return this},findActionByName:function(e){for(var t=0;t<this.actions.length;t++)if(this.actions[t].name===e)return this.actions[t];return null},play:function(e,t){return e.startTime=this.time,this.addAction(e),this},fadeOut:function(e,t){var r=[];return r.push({time:this.time,value:1}),r.push({time:this.time+t,value:0}),e.weight=new Gt.NumberKeyframeTrack("weight",r),this},fadeIn:function(e,t){var r=[];return r.push({time:this.time,value:0}),r.push({time:this.time+t,value:1}),e.weight=new Gt.NumberKeyframeTrack("weight",r),this},warp:function(e,t,r,i){var n=[];return n.push({time:this.time,value:t}),n.push({time:this.time+i,value:r}),e.timeScale=new Gt.NumberKeyframeTrack("timeScale",n),this},crossFade:function(e,t,r,i){if(this.fadeOut(e,r),this.fadeIn(t,r),i){var n=e.clip.duration/t.clip.duration,o=1/n;this.warp(e,1,n,r),this.warp(t,o,1,r)}return this},update:function(e){var t=e*this.timeScale;this.time+=t;for(var r=0;r<this.actions.length;r++){var i=this.actions[r],n=i.getWeightAt(this.time),o=t*i.getTimeScaleAt(this.time),a=i.update(o);if(!(i.weight<=0)&&i.enabled)for(var s=0;s<a.length;s++){i.clip.tracks[s].name;i.propertyBindings[s].accumulate(a[s],n)}}for(var h in this.propertyBindingMap)this.propertyBindingMap[h].apply();return this}},Gt.EventDispatcher.prototype.apply(Gt.AnimationMixer.prototype),Gt.AnimationUtils={getEqualsFunc:function(e){return e.equals?function(e,t){return e.equals(t)}:function(e,t){return e===t}},clone:function(e){if("object"===typeof e){if(e.clone)return e.clone();console.error("can not figure out how to copy exemplarValue",e)}return e},lerp:function(e,t,r,i){return Gt.AnimationUtils.getLerpFunc(e,i)(e,t,r)},lerp_object:function(e,t,r){return e.lerp(t,r)},slerp_object:function(e,t,r){return e.slerp(t,r)},lerp_number:function(e,t,r){return e*(1-r)+t*r},lerp_boolean:function(e,t,r){return r<.5?e:t},lerp_boolean_immediate:function(e,t,r){return e},lerp_string:function(e,t,r){return r<.5?e:t},lerp_string_immediate:function(e,t,r){return e},getLerpFunc:function(e,t){if(null==e)throw new Error("examplarValue is null");switch(typeof e){case"object":if(e.lerp)return Gt.AnimationUtils.lerp_object;if(e.slerp)return Gt.AnimationUtils.slerp_object;break;case"number":return Gt.AnimationUtils.lerp_number;case"boolean":return t?Gt.AnimationUtils.lerp_boolean:Gt.AnimationUtils.lerp_boolean_immediate;case"string":return t?Gt.AnimationUtils.lerp_string:Gt.AnimationUtils.lerp_string_immediate}}},Gt.KeyframeTrack=function(e,t){if(void 0===e)throw new Error("track name is undefined");if(void 0===t||0===t.length)throw new Error("no keys in track named "+e);this.name=e,this.keys=t,this.lastIndex=0,this.validate(),this.optimize()},Gt.KeyframeTrack.prototype={constructor:Gt.KeyframeTrack,getAt:function(e){for(;this.lastIndex<this.keys.length&&e>=this.keys[this.lastIndex].time;)this.lastIndex++;for(;0<this.lastIndex&&e<this.keys[this.lastIndex-1].time;)this.lastIndex--;if(this.lastIndex>=this.keys.length)return this.setResult(this.keys[this.keys.length-1].value),this.result;if(0===this.lastIndex)return this.setResult(this.keys[0].value),this.result;var t=this.keys[this.lastIndex-1];if(this.setResult(t.value),t.constantToNext)return this.result;var r=this.keys[this.lastIndex],i=(e-t.time)/(r.time-t.time);return this.result=this.lerpValues(this.result,r.value,i),this.result},shift:function(e){if(0!==e)for(var t=0;t<this.keys.length;t++)this.keys[t].time+=e;return this},scale:function(e){if(1!==e)for(var t=0;t<this.keys.length;t++)this.keys[t].time*=e;return this},trim:function(e,t){for(var r=0,i=1;i<this.keys.length;i++)this.keys[i]<=e&&r++;var n=0;for(i=this.keys.length-2;0<i&&this.keys[i]>=t;i++)n++;return 0<r+n&&(this.keys=this.keys.splice(r,this.keys.length-n-r)),this},validate:function(){var e=null;if(0!==this.keys.length){for(var t=0;t<this.keys.length;t++){var r=this.keys[t];if(!r)return void console.error("  key is null in track",this,t);if("number"!=typeof r.time||isNaN(r.time))return void console.error("  key.time is not a valid number",this,t,r);if(void 0===r.value||null===r.value)return void console.error("  key.value is null in track",this,t,r);if(e&&e.time>r.time)return void console.error("  key.time is less than previous key time, out of order keys",this,t,r,e);e=r}return this}console.error("  track is empty, no keys",this)},optimize:function(){var e=[],t=this.keys[0];e.push(t);Gt.AnimationUtils.getEqualsFunc(t.value);for(var r=1;r<this.keys.length-1;r++){var i=this.keys[r],n=this.keys[r+1];t.time!==i.time&&(this.compareValues(t.value,i.value)&&this.compareValues(i.value,n.value)||(t.constantToNext=this.compareValues(t.value,i.value),e.push(i),t=i))}return e.push(this.keys[this.keys.length-1]),this.keys=e,this}},Gt.KeyframeTrack.keyComparer=function(e,t){return e.time-t.time},Gt.KeyframeTrack.parse=function(e){if(void 0===e.type)throw new Error("track type undefined, can not parse");return Gt.KeyframeTrack.GetTrackTypeForTypeName(e.type).parse(e)},Gt.KeyframeTrack.GetTrackTypeForTypeName=function(e){switch(e.toLowerCase()){case"vector":case"vector2":case"vector3":case"vector4":return Gt.VectorKeyframeTrack;case"quaternion":return Gt.QuaternionKeyframeTrack;case"integer":case"scalar":case"double":case"float":case"number":return Gt.NumberKeyframeTrack;case"bool":case"boolean":return Gt.BooleanKeyframeTrack;case"string":return Gt.StringKeyframeTrack}throw new Error("Unsupported typeName: "+e)},Gt.PropertyBinding=function(e,t){this.rootNode=e,this.trackName=t,this.referenceCount=0,this.originalValue=null;var r=Gt.PropertyBinding.parseTrackName(t);this.directoryName=r.directoryName,this.nodeName=r.nodeName,this.objectName=r.objectName,this.objectIndex=r.objectIndex,this.propertyName=r.propertyName,this.propertyIndex=r.propertyIndex,this.node=Gt.PropertyBinding.findNode(e,this.nodeName)||e,this.cumulativeValue=null,this.cumulativeWeight=0},Gt.PropertyBinding.prototype={constructor:Gt.PropertyBinding,reset:function(){this.cumulativeValue=null,this.cumulativeWeight=0},accumulate:function(e,t){if(this.isBound||this.bind(),0===this.cumulativeWeight)0<t&&(null===this.cumulativeValue&&(this.cumulativeValue=Gt.AnimationUtils.clone(e)),this.cumulativeWeight=t);else{var r=t/(this.cumulativeWeight+t);this.cumulativeValue=this.lerpValue(this.cumulativeValue,e,r),this.cumulativeWeight+=t}},unbind:function(){this.isBound&&(this.setValue(this.originalValue),this.setValue=null,this.getValue=null,this.lerpValue=null,this.equalsValue=null,this.triggerDirty=null,this.isBound=!1)},bind:function(){if(!this.isBound){var t=this.node;if(t){if(this.objectName){if("materials"===this.objectName){if(!t.material)return void console.error("  can not bind to material as node does not have a material",this);if(!t.material.materials)return void console.error("  can not bind to material.materials as node.material does not have a materials array",this);t=t.material.materials}else if("bones"===this.objectName){if(!t.skeleton)return void console.error("  can not bind to bones as node does not have a skeleton",this);t=t.skeleton.bones;for(var e=0;e<t.length;e++)if(t[e].name===this.objectIndex){this.objectIndex=e;break}}else{if(void 0===t[this.objectName])return void console.error("  can not bind to objectName of node, undefined",this);t=t[this.objectName]}if(void 0!==this.objectIndex){if(void 0===t[this.objectIndex])return void console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,t);t=t[this.objectIndex]}}var r=t[this.propertyName];if(r){if(void 0!==this.propertyIndex){if("morphTargetInfluences"===this.propertyName){t.geometry||console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this),t.geometry.morphTargets||console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);for(e=0;e<this.node.geometry.morphTargets.length;e++)if(t.geometry.morphTargets[e].name===this.propertyIndex){this.propertyIndex=e;break}}this.setValue=function(e){return!this.equalsValue(r[this.propertyIndex],e)&&(r[this.propertyIndex]=e,!0)},this.getValue=function(){return r[this.propertyIndex]}}else r.copy?(this.setValue=function(e){return!this.equalsValue(r,e)&&(r.copy(e),!0)},this.getValue=function(){return r}):(this.setValue=function(e){return!this.equalsValue(t[this.propertyName],e)&&(t[this.propertyName]=e,!0)},this.getValue=function(){return t[this.propertyName]});void 0!==t.needsUpdate?this.triggerDirty=function(){this.node.needsUpdate=!0}:void 0!==t.matrixWorldNeedsUpdate&&(this.triggerDirty=function(){t.matrixWorldNeedsUpdate=!0}),this.originalValue=this.getValue(),this.equalsValue=Gt.AnimationUtils.getEqualsFunc(this.originalValue),this.lerpValue=Gt.AnimationUtils.getLerpFunc(this.originalValue,!0),this.isBound=!0}else console.error("  trying to update property for track: "+this.nodeName+"."+this.propertyName+" but it wasn't found.",t)}else console.error("  trying to update node for track: "+this.trackName+" but it wasn't found.")}},apply:function(){if(this.isBound||this.bind(),0<this.cumulativeWeight){if(this.cumulativeWeight<1){var e=1-this.cumulativeWeight,t=e/(this.cumulativeWeight+e);this.cumulativeValue=this.lerpValue(this.cumulativeValue,this.originalValue,t)}this.setValue(this.cumulativeValue)&&this.triggerDirty&&this.triggerDirty(),this.cumulativeValue=null,this.cumulativeWeight=0}}},Gt.PropertyBinding.parseTrackName=function(e){var t=/^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_. ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/,r=t.exec(e);if(!r)throw new Error("cannot parse trackName at all: "+e);r.index===t.lastIndex&&t.lastIndex++;var i={directoryName:r[1],nodeName:r[3],objectName:r[5],objectIndex:r[7],propertyName:r[9],propertyIndex:r[11]};if(null===i.propertyName||0===i.propertyName.length)throw new Error("can not parse propertyName from trackName: "+e);return i},Gt.PropertyBinding.findNode=function(e,o){if(!o||""===o||"root"===o||"."===o||-1===o||o===e.name||o===e.uuid)return e;if(e.skeleton){var t=function(e){for(var t=0;t<e.bones.length;t++){var r=e.bones[t];if(r.name===o)return r}return null}(e.skeleton);if(t)return t}if(e.children){var r=function e(t){for(var r=0;r<t.length;r++){var i=t[r];if(i.name===o||i.uuid===o)return i;var n=e(i.children);if(n)return n}return null}(e.children);if(r)return r}return null},Gt.VectorKeyframeTrack=function(e,t){Gt.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value.clone()},Gt.VectorKeyframeTrack.prototype=Object.create(Gt.KeyframeTrack.prototype),Gt.VectorKeyframeTrack.prototype.constructor=Gt.VectorKeyframeTrack,Gt.VectorKeyframeTrack.prototype.setResult=function(e){this.result.copy(e)},Gt.VectorKeyframeTrack.prototype.lerpValues=function(e,t,r){return e.lerp(t,r)},Gt.VectorKeyframeTrack.prototype.compareValues=function(e,t){return e.equals(t)},Gt.VectorKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value.clone()})}return new Gt.VectorKeyframeTrack(this.name,e)},Gt.VectorKeyframeTrack.parse=function(e){for(var t=e.keys[0].value.length,r=Gt["Vector"+t],i=[],n=0;n<e.keys.length;n++){var o=e.keys[n];i.push({value:(new r).fromArray(o.value),time:o.time})}return new Gt.VectorKeyframeTrack(e.name,i)},Gt.QuaternionKeyframeTrack=function(e,t){Gt.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value.clone()},Gt.QuaternionKeyframeTrack.prototype=Object.create(Gt.KeyframeTrack.prototype),Gt.QuaternionKeyframeTrack.prototype.constructor=Gt.QuaternionKeyframeTrack,Gt.QuaternionKeyframeTrack.prototype.setResult=function(e){this.result.copy(e)},Gt.QuaternionKeyframeTrack.prototype.lerpValues=function(e,t,r){return e.slerp(t,r)},Gt.QuaternionKeyframeTrack.prototype.compareValues=function(e,t){return e.equals(t)},Gt.QuaternionKeyframeTrack.prototype.multiply=function(e){for(var t=0;t<this.keys.length;t++)this.keys[t].value.multiply(e);return this},Gt.QuaternionKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value.clone()})}return new Gt.QuaternionKeyframeTrack(this.name,e)},Gt.QuaternionKeyframeTrack.parse=function(e){for(var t=[],r=0;r<e.keys.length;r++){var i=e.keys[r];t.push({value:(new Gt.Quaternion).fromArray(i.value),time:i.time})}return new Gt.QuaternionKeyframeTrack(e.name,t)},Gt.StringKeyframeTrack=function(e,t){Gt.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},Gt.StringKeyframeTrack.prototype=Object.create(Gt.KeyframeTrack.prototype),Gt.StringKeyframeTrack.prototype.constructor=Gt.StringKeyframeTrack,Gt.StringKeyframeTrack.prototype.setResult=function(e){this.result=e},Gt.StringKeyframeTrack.prototype.lerpValues=function(e,t,r){return r<1?e:t},Gt.StringKeyframeTrack.prototype.compareValues=function(e,t){return e===t},Gt.StringKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value})}return new Gt.StringKeyframeTrack(this.name,e)},Gt.StringKeyframeTrack.parse=function(e){return new Gt.StringKeyframeTrack(e.name,e.keys)},Gt.BooleanKeyframeTrack=function(e,t){Gt.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},Gt.BooleanKeyframeTrack.prototype=Object.create(Gt.KeyframeTrack.prototype),Gt.BooleanKeyframeTrack.prototype.constructor=Gt.BooleanKeyframeTrack,Gt.BooleanKeyframeTrack.prototype.setResult=function(e){this.result=e},Gt.BooleanKeyframeTrack.prototype.lerpValues=function(e,t,r){return r<1?e:t},Gt.BooleanKeyframeTrack.prototype.compareValues=function(e,t){return e===t},Gt.BooleanKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value})}return new Gt.BooleanKeyframeTrack(this.name,e)},Gt.BooleanKeyframeTrack.parse=function(e){return new Gt.BooleanKeyframeTrack(e.name,e.keys)},Gt.NumberKeyframeTrack=function(e,t){Gt.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},Gt.NumberKeyframeTrack.prototype=Object.create(Gt.KeyframeTrack.prototype),Gt.NumberKeyframeTrack.prototype.constructor=Gt.NumberKeyframeTrack,Gt.NumberKeyframeTrack.prototype.setResult=function(e){this.result=e},Gt.NumberKeyframeTrack.prototype.lerpValues=function(e,t,r){return e*(1-r)+t*r},Gt.NumberKeyframeTrack.prototype.compareValues=function(e,t){return e===t},Gt.NumberKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var r=this.keys[t];e.push({time:r.time,value:r.value})}return new Gt.NumberKeyframeTrack(this.name,e)},Gt.NumberKeyframeTrack.parse=function(e){return new Gt.NumberKeyframeTrack(e.name,e.keys)},Gt.Camera=function(){Gt.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Gt.Matrix4,this.projectionMatrix=new Gt.Matrix4},Gt.Camera.prototype=Object.create(Gt.Object3D.prototype),Gt.Camera.prototype.constructor=Gt.Camera,Gt.Camera.prototype.getWorldDirection=($e=new Gt.Quaternion,function(e){var t=e||new Gt.Vector3;return this.getWorldQuaternion($e),t.set(0,0,-1).applyQuaternion($e)}),Gt.Camera.prototype.lookAt=(et=new Gt.Matrix4,function(e){et.lookAt(this.position,e,this.up),this.quaternion.setFromRotationMatrix(et)}),Gt.Camera.prototype.clone=function(){return(new this.constructor).copy(this)},Gt.Camera.prototype.copy=function(e){return Gt.Object3D.prototype.copy.call(this,e),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},Gt.CubeCamera=function(e,t,r){Gt.Object3D.call(this),this.type="CubeCamera";var n=new Gt.PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new Gt.Vector3(1,0,0)),this.add(n);var o=new Gt.PerspectiveCamera(90,1,e,t);o.up.set(0,-1,0),o.lookAt(new Gt.Vector3(-1,0,0)),this.add(o);var a=new Gt.PerspectiveCamera(90,1,e,t);a.up.set(0,0,1),a.lookAt(new Gt.Vector3(0,1,0)),this.add(a);var s=new Gt.PerspectiveCamera(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new Gt.Vector3(0,-1,0)),this.add(s);var h=new Gt.PerspectiveCamera(90,1,e,t);h.up.set(0,-1,0),h.lookAt(new Gt.Vector3(0,0,1)),this.add(h);var l=new Gt.PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new Gt.Vector3(0,0,-1)),this.add(l),this.renderTarget=new Gt.WebGLRenderTargetCube(r,r,{format:Gt.RGBFormat,magFilter:Gt.LinearFilter,minFilter:Gt.LinearFilter}),this.updateCubeMap=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,i=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,n,r),r.activeCubeFace=1,e.render(t,o,r),r.activeCubeFace=2,e.render(t,a,r),r.activeCubeFace=3,e.render(t,s,r),r.activeCubeFace=4,e.render(t,h,r),r.texture.generateMipmaps=i,r.activeCubeFace=5,e.render(t,l,r),e.setRenderTarget(null)}},Gt.CubeCamera.prototype=Object.create(Gt.Object3D.prototype),Gt.CubeCamera.prototype.constructor=Gt.CubeCamera,Gt.OrthographicCamera=function(e,t,r,i,n,o){Gt.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},Gt.OrthographicCamera.prototype=Object.create(Gt.Camera.prototype),Gt.OrthographicCamera.prototype.constructor=Gt.OrthographicCamera,Gt.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-e,r+e,i+t,i-t,this.near,this.far)},Gt.OrthographicCamera.prototype.copy=function(e){return Gt.Camera.prototype.copy.call(this,e),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this},Gt.OrthographicCamera.prototype.toJSON=function(e){var t=Gt.Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,t},Gt.PerspectiveCamera=function(e,t,r,i){Gt.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},Gt.PerspectiveCamera.prototype=Object.create(Gt.Camera.prototype),Gt.PerspectiveCamera.prototype.constructor=Gt.PerspectiveCamera,Gt.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*Gt.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},Gt.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,i,n,o){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=i,this.width=n,this.height=o,this.updateProjectionMatrix()},Gt.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=Gt.Math.radToDeg(2*Math.atan(Math.tan(.5*Gt.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,r=Math.tan(Gt.Math.degToRad(.5*e))*this.near,i=-r,n=t*i,o=t*r,a=Math.abs(o-n),s=Math.abs(r-i);this.projectionMatrix.makeFrustum(n+this.x*a/this.fullWidth,n+(this.x+this.width)*a/this.fullWidth,r-(this.y+this.height)*s/this.fullHeight,r-this.y*s/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},Gt.PerspectiveCamera.prototype.copy=function(e){return Gt.Camera.prototype.copy.call(this,e),this.fov=e.fov,this.aspect=e.aspect,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this},Gt.PerspectiveCamera.prototype.toJSON=function(e){var t=Gt.Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.fov=this.fov,t.object.aspect=this.aspect,t.object.near=this.near,t.object.far=this.far,t},Gt.Light=function(e){Gt.Object3D.call(this),this.type="Light",this.color=new Gt.Color(e),this.receiveShadow=void 0},Gt.Light.prototype=Object.create(Gt.Object3D.prototype),Gt.Light.prototype.constructor=Gt.Light,Object.defineProperties(Gt.Light.prototype,{onlyShadow:{set:function(e){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){this.shadow.camera.far=e}},shadowCameraVisible:{set:function(e){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow ) instead.")}},shadowBias:{set:function(e){this.shadow.bias=e}},shadowDarkness:{set:function(e){this.shadow.darkness=e}},shadowMapWidth:{set:function(e){this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){this.shadow.mapSize.height=e}}}),Gt.Light.prototype.copy=function(e){return Gt.Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this},Gt.Light.prototype.toJSON=function(e){var t=Gt.Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.intensity&&(t.object.intensity=this.intensity),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.exponent&&(t.object.exponent=this.exponent),t},Gt.LightShadow=function(e){this.camera=e,this.bias=0,this.darkness=1,this.mapSize=new Gt.Vector2(512,512),this.map=null,this.matrix=null},Gt.LightShadow.prototype={constructor:Gt.LightShadow,copy:function(e){this.camera=e.camera.clone(),this.bias=e.bias,this.darkness=e.darkness,this.mapSize.copy(e.mapSize)},clone:function(){return(new this.constructor).copy(this)}},Gt.AmbientLight=function(e){Gt.Light.call(this,e),this.type="AmbientLight",this.castShadow=void 0},Gt.AmbientLight.prototype=Object.create(Gt.Light.prototype),Gt.AmbientLight.prototype.constructor=Gt.AmbientLight,Gt.DirectionalLight=function(e,t){Gt.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new Gt.Object3D,this.intensity=void 0!==t?t:1,this.shadow=new Gt.LightShadow(new Gt.OrthographicCamera(-500,500,500,-500,50,5e3))},Gt.DirectionalLight.prototype=Object.create(Gt.Light.prototype),Gt.DirectionalLight.prototype.constructor=Gt.DirectionalLight,Gt.DirectionalLight.prototype.copy=function(e){return Gt.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},Gt.HemisphereLight=function(e,t,r){Gt.Light.call(this,e),this.type="HemisphereLight",this.castShadow=void 0,this.position.set(0,1,0),this.updateMatrix(),this.groundColor=new Gt.Color(t),this.intensity=void 0!==r?r:1},Gt.HemisphereLight.prototype=Object.create(Gt.Light.prototype),Gt.HemisphereLight.prototype.constructor=Gt.HemisphereLight,Gt.HemisphereLight.prototype.copy=function(e){return Gt.Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this.intensity=e.intensity,this},Gt.PointLight=function(e,t,r,i){Gt.Light.call(this,e),this.type="PointLight",this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.decay=void 0!==i?i:1,this.shadow=new Gt.LightShadow(new Gt.PerspectiveCamera(90,1,1,500))},Gt.PointLight.prototype=Object.create(Gt.Light.prototype),Gt.PointLight.prototype.constructor=Gt.PointLight,Gt.PointLight.prototype.copy=function(e){return Gt.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this},Gt.SpotLight=function(e,t,r,i,n,o){Gt.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new Gt.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.exponent=void 0!==n?n:10,this.decay=void 0!==o?o:1,this.shadow=new Gt.LightShadow(new Gt.PerspectiveCamera(50,1,50,5e3))},Gt.SpotLight.prototype=Object.create(Gt.Light.prototype),Gt.SpotLight.prototype.constructor=Gt.SpotLight,Gt.SpotLight.prototype.copy=function(e){return Gt.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.distance=e.distance,this.angle=e.angle,this.exponent=e.exponent,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},Gt.Cache={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Gt.Loader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},Gt.Loader.prototype={constructor:Gt.Loader,crossOrigin:void 0,extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t,r){for(var i=[],n=0;n<e.length;++n)i[n]=this.createMaterial(e[n],t,r);return i},createMaterial:function(e,l,c){void 0===tt&&(tt=new Gt.Color),void 0===rt&&(rt=new Gt.TextureLoader),void 0===it&&(it=new Gt.MaterialLoader);var u={};function t(e,t,r,i,n){var o,a=l+e,s=Gt.Loader.Handlers.get(a);null!==s?o=s.load(a):(rt.setCrossOrigin(c),o=rt.load(a)),void 0!==t&&(o.repeat.fromArray(t),1!==t[0]&&(o.wrapS=Gt.RepeatWrapping),1!==t[1]&&(o.wrapT=Gt.RepeatWrapping)),void 0!==r&&o.offset.fromArray(r),void 0!==i&&("repeat"===i[0]&&(o.wrapS=Gt.RepeatWrapping),"mirror"===i[0]&&(o.wrapS=Gt.MirroredRepeatWrapping),"repeat"===i[1]&&(o.wrapT=Gt.RepeatWrapping),"mirror"===i[1]&&(o.wrapT=Gt.MirroredRepeatWrapping)),void 0!==n&&(o.anisotropy=n);var h=Gt.Math.generateUUID();return u[h]=o,h}var r={uuid:Gt.Math.generateUUID(),type:"MeshLambertMaterial"};for(var i in e){var n=e[i];switch(i){case"DbgColor":r.color=n;break;case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":r.name=n;break;case"blending":r.blending=Gt[n];break;case"colorDiffuse":r.color=tt.fromArray(n).getHex();break;case"colorSpecular":r.specular=tt.fromArray(n).getHex();break;case"colorEmissive":r.emissive=tt.fromArray(n).getHex();break;case"specularCoef":r.shininess=n;break;case"shading":"basic"===n.toLowerCase()&&(r.type="MeshBasicMaterial"),"phong"===n.toLowerCase()&&(r.type="MeshPhongMaterial");break;case"mapDiffuse":r.map=t(n,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapLight":r.lightMap=t(n,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":r.aoMap=t(n,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":r.bumpMap=t(n,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case"mapBumpScale":r.bumpScale=n;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":r.normalMap=t(n,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case"mapNormalFactor":r.normalScale=[n,n];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":r.specularMap=t(n,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapAlpha":r.alphaMap=t(n,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":r.side=Gt.BackSide;break;case"doubleSided":r.side=Gt.DoubleSide;break;case"transparency":console.warn("THREE.Loader: transparency has been renamed to opacity"),r.opacity=n;break;case"opacity":case"transparent":case"depthTest":case"depthWrite":case"transparent":case"visible":case"wireframe":r[i]=n;break;case"vertexColors":!0===n&&(r.vertexColors=Gt.VertexColors),"face"===n&&(r.vertexColors=Gt.FaceColors);break;default:console.error("Loader.createMaterial: Unsupported",i,n)}}return"MeshPhongMaterial"!==r.type&&delete r.specular,r.opacity<1&&(r.transparent=!0),it.setTextures(u),it.parse(r)}},Gt.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,i=t.length;r<i;r+=2){var n=t[r],o=t[r+1];if(n.test(e))return o}return null}},Gt.XHRLoader=function(e){this.manager=void 0!==e?e:Gt.DefaultLoadingManager},Gt.XHRLoader.prototype={constructor:Gt.XHRLoader,load:function(r,i,t,n){var o=this,e=Gt.Cache.get(r);if(void 0!==e)return i&&setTimeout(function(){i(e)},0),e;var a=new XMLHttpRequest;return a.open("GET",r,!0),a.addEventListener("load",function(e){var t=e.target.response;Gt.Cache.add(r,t),i&&i(t),o.manager.itemEnd(r)},!1),void 0!==t&&a.addEventListener("progress",function(e){t(e)},!1),a.addEventListener("error",function(e){n&&n(e),o.manager.itemError(r)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.send(null),o.manager.itemStart(r),a},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e},setWithCredentials:function(e){this.withCredentials=e}},Gt.ImageLoader=function(e){this.manager=void 0!==e?e:Gt.DefaultLoadingManager},Gt.ImageLoader.prototype={constructor:Gt.ImageLoader,load:function(t,r,i,n){var o=this,e=Gt.Cache.get(t);if(void 0!==e)return o.manager.itemStart(t),r?setTimeout(function(){r(e),o.manager.itemEnd(t)},0):o.manager.itemEnd(t),e;var a=document.createElement("img");return a.addEventListener("load",function(e){Gt.Cache.add(t,this),r&&r(this),o.manager.itemEnd(t)},!1),void 0!==i&&a.addEventListener("progress",function(e){i(e)},!1),a.addEventListener("error",function(e){n&&n(e),o.manager.itemError(t)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),o.manager.itemStart(t),a.src=t,a},setCrossOrigin:function(e){this.crossOrigin=e}},Gt.JSONLoader=function(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:Gt.DefaultLoadingManager,this.withCredentials=!1},Gt.JSONLoader.prototype={constructor:Gt.JSONLoader,get statusDomElement(){return void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div")),console.warn("THREE.JSONLoader: .statusDomElement has been removed."),this._statusDomElement},load:function(n,o,e,t){var a=this,s=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:Gt.Loader.prototype.extractUrlBase(n),r=new Gt.XHRLoader(this.manager);r.setCrossOrigin(this.crossOrigin),r.setWithCredentials(this.withCredentials),r.load(n,function(e){var t=JSON.parse(e),r=t.metadata;if(void 0!==r){if("object"===r.type)return void console.error("THREE.JSONLoader: "+n+" should be loaded with THREE.ObjectLoader instead.");if("scene"===r.type)return void console.error("THREE.JSONLoader: "+n+" should be loaded with THREE.SceneLoader instead.")}var i=a.parse(t,s);o(i.geometry,i.materials)})},setCrossOrigin:function(e){this.crossOrigin=e},setTexturePath:function(e){this.texturePath=e},parse:function(F,e){var V=new Gt.Geometry,t=void 0!==F.scale?1/F.scale:1;if(function(e){function t(e,t){return e&1<<t}var r,i,n,o,a,s,h,l,c,u,d,p,f,m,g,v,y,x,_,b,w,M,S,E,T,C,A,L=F.faces,P=F.vertices,k=F.normals,R=F.colors,D=0;if(void 0!==F.uvs){for(r=0;r<F.uvs.length;r++)F.uvs[r].length&&D++;for(r=0;r<D;r++)V.faceVertexUvs[r]=[]}o=0,a=P.length;for(;o<a;)(x=new Gt.Vector3).x=P[o++]*e,x.y=P[o++]*e,x.z=P[o++]*e,V.vertices.push(x);o=0,a=L.length;for(;o<a;)if(u=L[o++],d=t(u,0),p=t(u,1),f=t(u,3),m=t(u,4),g=t(u,5),v=t(u,6),y=t(u,7),d){if((b=new Gt.Face3).a=L[o],b.b=L[o+1],b.c=L[o+3],(w=new Gt.Face3).a=L[o+1],w.b=L[o+2],w.c=L[o+3],o+=4,p&&(c=L[o++],b.materialIndex=c,w.materialIndex=c),n=V.faces.length,f)for(r=0;r<D;r++)for(E=F.uvs[r],V.faceVertexUvs[r][n]=[],V.faceVertexUvs[r][n+1]=[],i=0;i<4;i++)l=L[o++],C=E[2*l],A=E[2*l+1],T=new Gt.Vector2(C,A),2!==i&&V.faceVertexUvs[r][n].push(T),0!==i&&V.faceVertexUvs[r][n+1].push(T);if(m&&(h=3*L[o++],b.normal.set(k[h++],k[h++],k[h]),w.normal.copy(b.normal)),g)for(r=0;r<4;r++)h=3*L[o++],S=new Gt.Vector3(k[h++],k[h++],k[h]),2!==r&&b.vertexNormals.push(S),0!==r&&w.vertexNormals.push(S);if(v&&(s=L[o++],M=R[s],b.color.setHex(M),w.color.setHex(M)),y)for(r=0;r<4;r++)s=L[o++],M=R[s],2!==r&&b.vertexColors.push(new Gt.Color(M)),0!==r&&w.vertexColors.push(new Gt.Color(M));V.faces.push(b),V.faces.push(w)}else{if((_=new Gt.Face3).a=L[o++],_.b=L[o++],_.c=L[o++],p&&(c=L[o++],_.materialIndex=c),n=V.faces.length,f)for(r=0;r<D;r++)for(E=F.uvs[r],V.faceVertexUvs[r][n]=[],i=0;i<3;i++)l=L[o++],C=E[2*l],A=E[2*l+1],T=new Gt.Vector2(C,A),V.faceVertexUvs[r][n].push(T);if(m&&(h=3*L[o++],_.normal.set(k[h++],k[h++],k[h])),g)for(r=0;r<3;r++)h=3*L[o++],S=new Gt.Vector3(k[h++],k[h++],k[h]),_.vertexNormals.push(S);if(v&&(s=L[o++],_.color.setHex(R[s])),y)for(r=0;r<3;r++)s=L[o++],_.vertexColors.push(new Gt.Color(R[s]));V.faces.push(_)}}(t),function(){var e=void 0!==F.influencesPerVertex?F.influencesPerVertex:2;if(F.skinWeights)for(var t=0,r=F.skinWeights.length;t<r;t+=e){var i=F.skinWeights[t],n=1<e?F.skinWeights[t+1]:0,o=2<e?F.skinWeights[t+2]:0,a=3<e?F.skinWeights[t+3]:0;V.skinWeights.push(new Gt.Vector4(i,n,o,a))}if(F.skinIndices)for(var t=0,r=F.skinIndices.length;t<r;t+=e){var s=F.skinIndices[t],h=1<e?F.skinIndices[t+1]:0,l=2<e?F.skinIndices[t+2]:0,c=3<e?F.skinIndices[t+3]:0;V.skinIndices.push(new Gt.Vector4(s,h,l,c))}V.bones=F.bones,V.bones&&0<V.bones.length&&(V.skinWeights.length!==V.skinIndices.length||V.skinIndices.length!==V.vertices.length)&&console.warn("When skinning, number of vertices ("+V.vertices.length+"), skinIndices ("+V.skinIndices.length+"), and skinWeights ("+V.skinWeights.length+") should match.")}(),function(e){if(void 0!==F.morphTargets)for(var t=0,r=F.morphTargets.length;t<r;t++){V.morphTargets[t]={},V.morphTargets[t].name=F.morphTargets[t].name,V.morphTargets[t].vertices=[];for(var i=V.morphTargets[t].vertices,n=F.morphTargets[t].vertices,o=0,a=n.length;o<a;o+=3){var s=new Gt.Vector3;s.x=n[o]*e,s.y=n[o+1]*e,s.z=n[o+2]*e,i.push(s)}}if(void 0!==F.morphColors&&0<F.morphColors.length){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var h=V.faces,l=F.morphColors[0].colors,t=0,r=h.length;t<r;t++)h[t].color.fromArray(l,3*t)}}(t),function(){var e=[],t=[];void 0!==F.animation&&t.push(F.animation);void 0!==F.animations&&(F.animations.length?t=t.concat(F.animations):t.push(F.animations));for(var r=0;r<t.length;r++){var i=Gt.AnimationClip.parseAnimation(t[r],V.bones);i&&e.push(i)}if(V.morphTargets){var n=Gt.AnimationClip.CreateClipsFromMorphTargetSequences(V.morphTargets,10);e=e.concat(n)}0<e.length&&(V.animations=e)}(),V.computeFaceNormals(),V.computeBoundingSphere(),void 0===F.materials||0===F.materials.length)return{geometry:V};var r=Gt.Loader.prototype.initMaterials(F.materials,e,this.crossOrigin);return{geometry:V,materials:r}}},Gt.LoadingManager=function(e,t,r){var i=this,n=!1,o=0,a=0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){a++,!1===n&&void 0!==i.onStart&&i.onStart(e,o,a),n=!0},this.itemEnd=function(e){o++,void 0!==i.onProgress&&i.onProgress(e,o,a),o===a&&(n=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)}},Gt.DefaultLoadingManager=new Gt.LoadingManager,Gt.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:Gt.DefaultLoadingManager},Gt.BufferGeometryLoader.prototype={constructor:Gt.BufferGeometryLoader,load:function(e,t,r,i){var n=this,o=new Gt.XHRLoader(n.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new Gt.BufferGeometry,r=e.data.index;if(void 0!==r){var i=new Nt[r.type](r.array);t.setIndex(new Gt.BufferAttribute(i,1))}var n=e.data.attributes;for(var o in n){var a=n[o];i=new Nt[a.type](a.array);t.addAttribute(o,new Gt.BufferAttribute(i,a.itemSize))}var s=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==s)for(var h=0,l=s.length;h!==l;++h){var c=s[h];t.addGroup(c.start,c.count)}var u=e.data.boundingSphere;if(void 0!==u){var d=new Gt.Vector3;void 0!==u.center&&d.fromArray(u.center),t.boundingSphere=new Gt.Sphere(d,u.radius)}return t}},Gt.MaterialLoader=function(e){this.manager=void 0!==e?e:Gt.DefaultLoadingManager,this.textures={}},Gt.MaterialLoader.prototype={constructor:Gt.MaterialLoader,load:function(e,t,r,i){var n=this,o=new Gt.XHRLoader(n.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},setTextures:function(e){this.textures=e},getTexture:function(e){var t=this.textures;return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]},parse:function(e){var t=new Gt[e.type];if(t.uuid=e.uuid,void 0!==e.name&&(t.name=e.name),void 0!==e.color&&t.color.setHex(e.color),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.alphaTest&&(t.alphaTest=e.alphaTest),void 0!==e.depthTest&&(t.depthTest=e.depthTest),void 0!==e.depthWrite&&(t.depthWrite=e.depthWrite),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(t.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(t.map=this.getTexture(e.map)),void 0!==e.alphaMap&&(t.alphaMap=this.getTexture(e.alphaMap),t.transparent=!0),void 0!==e.bumpMap&&(t.bumpMap=this.getTexture(e.bumpMap)),void 0!==e.bumpScale&&(t.bumpScale=e.bumpScale),void 0!==e.normalMap&&(t.normalMap=this.getTexture(e.normalMap)),e.normalScale&&(t.normalScale=new Gt.Vector2(e.normalScale,e.normalScale)),void 0!==e.displacementMap&&(t.displacementMap=this.getTexture(e.displacementMap)),void 0!==e.displacementScale&&(t.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(t.displacementBias=e.displacementBias),void 0!==e.specularMap&&(t.specularMap=this.getTexture(e.specularMap)),void 0!==e.envMap&&(t.envMap=this.getTexture(e.envMap),t.combine=Gt.MultiplyOperation),e.reflectivity&&(t.reflectivity=e.reflectivity),void 0!==e.lightMap&&(t.lightMap=this.getTexture(e.lightMap)),void 0!==e.lightMapIntensity&&(t.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(t.aoMap=this.getTexture(e.aoMap)),void 0!==e.aoMapIntensity&&(t.aoMapIntensity=e.aoMapIntensity),void 0!==e.materials)for(var r=0,i=e.materials.length;r<i;r++)t.materials.push(this.parse(e.materials[r]));return t}},Gt.ObjectLoader=function(e){this.manager=void 0!==e?e:Gt.DefaultLoadingManager,this.texturePath=""},Gt.ObjectLoader.prototype={constructor:Gt.ObjectLoader,load:function(e,t,r,i){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var n=this,o=new Gt.XHRLoader(n.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){n.parse(JSON.parse(e),t)},r,i)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var r=this.parseGeometries(e.geometries),i=this.parseImages(e.images,function(){void 0!==t&&t(a)}),n=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,n),a=this.parseObject(e.object,r,o);return e.animations&&(a.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(a),a},parseGeometries:function(e){var t={};if(void 0!==e)for(var r=new Gt.JSONLoader,i=new Gt.BufferGeometryLoader,n=0,o=e.length;n<o;n++){var a,s=e[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Gt[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"CubeGeometry":a=new Gt.BoxGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleBufferGeometry":a=new Gt.CircleBufferGeometry(s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CircleGeometry":a=new Gt.CircleGeometry(s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":a=new Gt.CylinderGeometry(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":a=new Gt.SphereGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"SphereBufferGeometry":a=new Gt.SphereBufferGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":a=new Gt.DodecahedronGeometry(s.radius,s.detail);break;case"IcosahedronGeometry":a=new Gt.IcosahedronGeometry(s.radius,s.detail);break;case"OctahedronGeometry":a=new Gt.OctahedronGeometry(s.radius,s.detail);break;case"TetrahedronGeometry":a=new Gt.TetrahedronGeometry(s.radius,s.detail);break;case"RingGeometry":a=new Gt.RingGeometry(s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":a=new Gt.TorusGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":a=new Gt.TorusKnotGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"BufferGeometry":a=i.parse(s);break;case"Geometry":a=r.parse(s.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),t[s.uuid]=a}return t},parseMaterials:function(e,t){var r={};if(void 0!==e){var i=new Gt.MaterialLoader;i.setTextures(t);for(var n=0,o=e.length;n<o;n++){var a=i.parse(e[n]);r[a.uuid]=a}}return r},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var i=Gt.AnimationClip.parse(e[r]);t.push(i)}return t},parseImages:function(e,t){var r=this,i={};function n(e){return r.manager.itemStart(e),a.load(e,function(){r.manager.itemEnd(e)})}if(void 0!==e&&0<e.length){var o=new Gt.LoadingManager(t),a=new Gt.ImageLoader(o);a.setCrossOrigin(this.crossOrigin);for(var s=0,h=e.length;s<h;s++){var l=e[s],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.texturePath+l.url;i[l.uuid]=n(c)}}return i},parseTextures:function(e,t){function r(e){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),Gt[e])}var i={};if(void 0!==e)for(var n=0,o=e.length;n<o;n++){var a=e[n];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var s=new Gt.Texture(t[a.image]);s.needsUpdate=!0,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=r(a.mapping)),void 0!==a.offset&&(s.offset=new Gt.Vector2(a.offset[0],a.offset[1])),void 0!==a.repeat&&(s.repeat=new Gt.Vector2(a.repeat[0],a.repeat[1])),void 0!==a.minFilter&&(s.minFilter=r(a.minFilter)),void 0!==a.magFilter&&(s.magFilter=r(a.magFilter)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),Array.isArray(a.wrap)&&(s.wrapS=r(a.wrap[0]),s.wrapT=r(a.wrap[1])),i[a.uuid]=s}return i},parseObject:(nt=new Gt.Matrix4,function(e,t,r){var i;function n(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function o(e){if(void 0!==e)return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}switch(e.type){case"Scene":i=new Gt.Scene;break;case"PerspectiveCamera":i=new Gt.PerspectiveCamera(e.fov,e.aspect,e.near,e.far);break;case"OrthographicCamera":i=new Gt.OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far);break;case"AmbientLight":i=new Gt.AmbientLight(e.color);break;case"DirectionalLight":i=new Gt.DirectionalLight(e.color,e.intensity);break;case"PointLight":i=new Gt.PointLight(e.color,e.intensity,e.distance,e.decay);break;case"SpotLight":i=new Gt.SpotLight(e.color,e.intensity,e.distance,e.angle,e.exponent,e.decay);break;case"HemisphereLight":i=new Gt.HemisphereLight(e.color,e.groundColor,e.intensity);break;case"Mesh":i=new Gt.Mesh(n(e.geometry),o(e.material));break;case"LOD":i=new Gt.LOD;break;case"Line":i=new Gt.Line(n(e.geometry),o(e.material),e.mode);break;case"PointCloud":case"Points":i=new Gt.Points(n(e.geometry),o(e.material));break;case"Sprite":i=new Gt.Sprite(o(e.material));break;case"Group":i=new Gt.Group;break;default:i=new Gt.Object3D}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(nt.fromArray(e.matrix),nt.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.children)for(var a in e.children)i.add(this.parseObject(e.children[a],t,r));if("LOD"===e.type)for(var s=e.levels,h=0;h<s.length;h++){var l=s[h];void 0!==(a=i.getObjectByProperty("uuid",l.object))&&i.addLevel(a,l.distance)}return i})},Gt.TextureLoader=function(e){this.manager=void 0!==e?e:Gt.DefaultLoadingManager},Gt.TextureLoader.prototype={constructor:Gt.TextureLoader,load:function(e,t,r,i){var n=new Gt.Texture,o=new Gt.ImageLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)},r,i),n},setCrossOrigin:function(e){this.crossOrigin=e}},Gt.CubeTextureLoader=function(e){this.manager=void 0!==e?e:Gt.DefaultLoadingManager},Gt.CubeTextureLoader.prototype={constructor:Gt.CubeTextureLoader,load:function(e,r,t,i){var n=new Gt.CubeTexture([]),o=new Gt.ImageLoader;o.setCrossOrigin(this.crossOrigin);var a=0;function s(t){o.load(e[t],function(e){n.images[t]=e,6===++a&&(n.needsUpdate=!0,r&&r(n))},void 0,i)}for(var h=0;h<e.length;++h)s(h);return n},setCrossOrigin:function(e){this.crossOrigin=e}},Gt.DataTextureLoader=Gt.BinaryTextureLoader=function(e){this.manager=void 0!==e?e:Gt.DefaultLoadingManager,this._parser=null},Gt.BinaryTextureLoader.prototype={constructor:Gt.BinaryTextureLoader,load:function(e,r,t,i){var n=this,o=new Gt.DataTexture,a=new Gt.XHRLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setResponseType("arraybuffer"),a.load(e,function(e){var t=n._parser(e);t&&(void 0!==t.image?o.image=t.image:void 0!==t.data&&(o.image.width=t.width,o.image.height=t.height,o.image.data=t.data),o.wrapS=void 0!==t.wrapS?t.wrapS:Gt.ClampToEdgeWrapping,o.wrapT=void 0!==t.wrapT?t.wrapT:Gt.ClampToEdgeWrapping,o.magFilter=void 0!==t.magFilter?t.magFilter:Gt.LinearFilter,o.minFilter=void 0!==t.minFilter?t.minFilter:Gt.LinearMipMapLinearFilter,o.anisotropy=void 0!==t.anisotropy?t.anisotropy:1,void 0!==t.format&&(o.format=t.format),void 0!==t.type&&(o.type=t.type),void 0!==t.mipmaps&&(o.mipmaps=t.mipmaps),1===t.mipmapCount&&(o.minFilter=Gt.LinearFilter),o.needsUpdate=!0,r&&r(o,t))},t,i),o},setCrossOrigin:function(e){this.crossOrigin=e}},Gt.CompressedTextureLoader=function(e){this.manager=void 0!==e?e:Gt.DefaultLoadingManager,this._parser=null},Gt.CompressedTextureLoader.prototype={constructor:Gt.CompressedTextureLoader,load:function(e,o,t,i){var a=this,s=[],h=new Gt.CompressedTexture;h.image=s;var n=new Gt.XHRLoader(this.manager);if(n.setCrossOrigin(this.crossOrigin),n.setResponseType("arraybuffer"),Array.isArray(e))for(var l=0,r=function(r){n.load(e[r],function(e){var t=a._parser(e,!0);s[r]={width:t.width,height:t.height,format:t.format,mipmaps:t.mipmaps},6===(l+=1)&&(1===t.mipmapCount&&(h.minFilter=Gt.LinearFilter),h.format=t.format,h.needsUpdate=!0,o&&o(h))},t,i)},c=0,u=e.length;c<u;++c)r(c);else n.load(e,function(e){var t=a._parser(e,!0);if(t.isCubemap)for(var r=t.mipmaps.length/t.mipmapCount,i=0;i<r;i++){s[i]={mipmaps:[]};for(var n=0;n<t.mipmapCount;n++)s[i].mipmaps.push(t.mipmaps[i*t.mipmapCount+n]),s[i].format=t.format,s[i].width=t.width,s[i].height=t.height}else h.image.width=t.width,h.image.height=t.height,h.mipmaps=t.mipmaps;1===t.mipmapCount&&(h.minFilter=Gt.LinearFilter),h.format=t.format,h.needsUpdate=!0,o&&o(h)},t,i);return h},setCrossOrigin:function(e){this.crossOrigin=e}},Gt.Material=function(){Object.defineProperty(this,"id",{value:Gt.MaterialIdCount++}),this.uuid=Gt.Math.generateUUID(),this.name="",this.type="Material",this.side=Gt.FrontSide,this.opacity=1,this.transparent=!1,this.blending=Gt.NormalBlending,this.blendSrc=Gt.SrcAlphaFactor,this.blendDst=Gt.OneMinusSrcAlphaFactor,this.blendEquation=Gt.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Gt.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},Gt.Material.prototype={constructor:Gt.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){var i=this[t];void 0!==i?i instanceof Gt.Color?i.set(r):i instanceof Gt.Vector3&&r instanceof Gt.Vector3?i.copy(r):this[t]="overdraw"===t?Number(r):r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};return t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),this.color instanceof Gt.Color&&(t.color=this.color.getHex()),this.emissive instanceof Gt.Color&&(t.emissive=this.emissive.getHex()),this.specular instanceof Gt.Color&&(t.specular=this.specular.getHex()),void 0!==this.shininess&&(t.shininess=this.shininess),this.map instanceof Gt.Texture&&(t.map=this.map.toJSON(e).uuid),this.alphaMap instanceof Gt.Texture&&(t.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap instanceof Gt.Texture&&(t.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap instanceof Gt.Texture&&(t.bumpMap=this.bumpMap.toJSON(e).uuid,t.bumpScale=this.bumpScale),this.normalMap instanceof Gt.Texture&&(t.normalMap=this.normalMap.toJSON(e).uuid,t.normalScale=this.normalScale),this.displacementMap instanceof Gt.Texture&&(t.displacementMap=this.displacementMap.toJSON(e).uuid,t.displacementScale=this.displacementScale,t.displacementBias=this.displacementBias),this.specularMap instanceof Gt.Texture&&(t.specularMap=this.specularMap.toJSON(e).uuid),this.envMap instanceof Gt.Texture&&(t.envMap=this.envMap.toJSON(e).uuid,t.reflectivity=this.reflectivity),void 0!==this.size&&(t.size=this.size),void 0!==this.sizeAttenuation&&(t.sizeAttenuation=this.sizeAttenuation),void 0!==this.vertexColors&&this.vertexColors!==Gt.NoColors&&(t.vertexColors=this.vertexColors),void 0!==this.shading&&this.shading!==Gt.SmoothShading&&(t.shading=this.shading),void 0!==this.blending&&this.blending!==Gt.NormalBlending&&(t.blending=this.blending),void 0!==this.side&&this.side!==Gt.FrontSide&&(t.side=this.side),this.opacity<1&&(t.opacity=this.opacity),!0===this.transparent&&(t.transparent=this.transparent),0<this.alphaTest&&(t.alphaTest=this.alphaTest),!0===this.wireframe&&(t.wireframe=this.wireframe),1<this.wireframeLinewidth&&(t.wireframeLinewidth=this.wireframeLinewidth),t},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.side=e.side,this.opacity=e.opacity,this.transparent=e.transparent,this.blending=e.blending,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.alphaTest=e.alphaTest,this.overdraw=e.overdraw,this.visible=e.visible,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})},get wrapAround(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set wrapAround(e){console.warn("THREE."+this.type+": .wrapAround has been removed.")},get wrapRGB(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new Gt.Color}},Gt.EventDispatcher.prototype.apply(Gt.Material.prototype),Gt.MaterialIdCount=0,Gt.LineBasicMaterial=function(e){Gt.Material.call(this),this.type="LineBasicMaterial",this.color=new Gt.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=Gt.NoColors,this.fog=!0,this.setValues(e)},Gt.LineBasicMaterial.prototype=Object.create(Gt.Material.prototype),Gt.LineBasicMaterial.prototype.constructor=Gt.LineBasicMaterial,Gt.LineBasicMaterial.prototype.copy=function(e){return Gt.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.vertexColors=e.vertexColors,this.fog=e.fog,this},Gt.LineDashedMaterial=function(e){Gt.Material.call(this),this.type="LineDashedMaterial",this.color=new Gt.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},Gt.LineDashedMaterial.prototype=Object.create(Gt.Material.prototype),Gt.LineDashedMaterial.prototype.constructor=Gt.LineDashedMaterial,Gt.LineDashedMaterial.prototype.copy=function(e){return Gt.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this.vertexColors=e.vertexColors,this.fog=e.fog,this},Gt.MeshBasicMaterial=function(e){Gt.Material.call(this),this.type="MeshBasicMaterial",this.color=new Gt.Color(16777215),this.map=null,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Gt.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Gt.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Gt.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},Gt.MeshBasicMaterial.prototype=Object.create(Gt.Material.prototype),Gt.MeshBasicMaterial.prototype.constructor=Gt.MeshBasicMaterial,Gt.MeshBasicMaterial.prototype.copy=function(e){return Gt.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Gt.MeshLambertMaterial=function(e){Gt.Material.call(this),this.type="MeshLambertMaterial",this.color=new Gt.Color(16777215),this.emissive=new Gt.Color(0),this.map=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Gt.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Gt.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},Gt.MeshLambertMaterial.prototype=Object.create(Gt.Material.prototype),Gt.MeshLambertMaterial.prototype.constructor=Gt.MeshLambertMaterial,Gt.MeshLambertMaterial.prototype.copy=function(e){return Gt.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.emissive.copy(e.emissive),this.map=e.map,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Gt.MeshPhongMaterial=function(e){Gt.Material.call(this),this.type="MeshPhongMaterial",this.color=new Gt.Color(16777215),this.emissive=new Gt.Color(0),this.specular=new Gt.Color(1118481),this.shininess=30,this.metal=!1,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Gt.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Gt.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Gt.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Gt.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},Gt.MeshPhongMaterial.prototype=Object.create(Gt.Material.prototype),Gt.MeshPhongMaterial.prototype.constructor=Gt.MeshPhongMaterial,Gt.MeshPhongMaterial.prototype.copy=function(e){return Gt.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.emissive.copy(e.emissive),this.specular.copy(e.specular),this.shininess=e.shininess,this.metal=e.metal,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissiveMap=e.emissiveMap,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Gt.MeshDepthMaterial=function(e){Gt.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},Gt.MeshDepthMaterial.prototype=Object.create(Gt.Material.prototype),Gt.MeshDepthMaterial.prototype.constructor=Gt.MeshDepthMaterial,Gt.MeshDepthMaterial.prototype.copy=function(e){return Gt.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Gt.MeshNormalMaterial=function(e){Gt.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},Gt.MeshNormalMaterial.prototype=Object.create(Gt.Material.prototype),Gt.MeshNormalMaterial.prototype.constructor=Gt.MeshNormalMaterial,Gt.MeshNormalMaterial.prototype.copy=function(e){return Gt.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Gt.MultiMaterial=function(e){this.uuid=Gt.Math.generateUUID(),this.type="MultiMaterial",this.materials=e instanceof Array?e:[],this.visible=!0},Gt.MultiMaterial.prototype={constructor:Gt.MultiMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},t=0,r=this.materials.length;t<r;t++)e.materials.push(this.materials[t].toJSON());return e.visible=this.visible,e},clone:function(){for(var e=new this.constructor,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e.visible=this.visible,e}},Gt.MeshFaceMaterial=Gt.MultiMaterial,Gt.PointsMaterial=function(e){Gt.Material.call(this),this.type="PointsMaterial",this.color=new Gt.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=Gt.NoColors,this.fog=!0,this.setValues(e)},Gt.PointsMaterial.prototype=Object.create(Gt.Material.prototype),Gt.PointsMaterial.prototype.constructor=Gt.PointsMaterial,Gt.PointsMaterial.prototype.copy=function(e){return Gt.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.vertexColors=e.vertexColors,this.fog=e.fog,this},Gt.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Gt.PointsMaterial(e)},Gt.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Gt.PointsMaterial(e)},Gt.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Gt.PointsMaterial(e)},Gt.ShaderMaterial=function(e){Gt.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=Gt.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=Gt.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.derivatives=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},(this.index0AttributeName=void 0)!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))},Gt.ShaderMaterial.prototype=Object.create(Gt.Material.prototype),Gt.ShaderMaterial.prototype.constructor=Gt.ShaderMaterial,Gt.ShaderMaterial.prototype.copy=function(e){return Gt.Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Gt.UniformsUtils.clone(e.uniforms),this.attributes=e.attributes,this.defines=e.defines,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.derivatives=e.derivatives,this},Gt.ShaderMaterial.prototype.toJSON=function(e){var t=Gt.Material.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.attributes=this.attributes,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},Gt.RawShaderMaterial=function(e){Gt.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},Gt.RawShaderMaterial.prototype=Object.create(Gt.ShaderMaterial.prototype),Gt.RawShaderMaterial.prototype.constructor=Gt.RawShaderMaterial,Gt.SpriteMaterial=function(e){Gt.Material.call(this),this.type="SpriteMaterial",this.color=new Gt.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},Gt.SpriteMaterial.prototype=Object.create(Gt.Material.prototype),Gt.SpriteMaterial.prototype.constructor=Gt.SpriteMaterial,Gt.SpriteMaterial.prototype.copy=function(e){return Gt.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.fog=e.fog,this},Gt.Texture=function(e,t,r,i,n,o,a,s,h){Object.defineProperty(this,"id",{value:Gt.TextureIdCount++}),this.uuid=Gt.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==e?e:Gt.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Gt.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:Gt.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:Gt.ClampToEdgeWrapping,this.magFilter=void 0!==n?n:Gt.LinearFilter,this.minFilter=void 0!==o?o:Gt.LinearMipMapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==a?a:Gt.RGBAFormat,this.type=void 0!==s?s:Gt.UnsignedByteType,this.offset=new Gt.Vector2(0,0),this.repeat=new Gt.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.version=0,this.onUpdate=null},Gt.Texture.DEFAULT_IMAGE=void 0,Gt.Texture.DEFAULT_MAPPING=Gt.UVMapping,Gt.Texture.prototype={constructor:Gt.Texture,set needsUpdate(e){!0===e&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this},toJSON:function(e){if(void 0!==e.textures[this.uuid])return e.textures[this.uuid];var t,r,i={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=Gt.Math.generateUUID()),void 0===e.images[n.uuid]&&(e.images[n.uuid]={uuid:n.uuid,url:(t=n,void 0!==t.toDataURL?r=t:((r=document.createElement("canvas")).width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0,t.width,t.height)),2048<r.width||2048<r.height?r.toDataURL("image/jpeg",.6):r.toDataURL("image/png"))}),i.image=n.uuid}return e.textures[this.uuid]=i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===Gt.UVMapping){if(e.multiply(this.repeat),e.add(this.offset),e.x<0||1<e.x)switch(this.wrapS){case Gt.RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case Gt.ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case Gt.MirroredRepeatWrapping:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case Gt.RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case Gt.ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case Gt.MirroredRepeatWrapping:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}},Gt.EventDispatcher.prototype.apply(Gt.Texture.prototype),Gt.TextureIdCount=0,Gt.CanvasTexture=function(e,t,r,i,n,o,a,s,h){Gt.Texture.call(this,e,t,r,i,n,o,a,s,h),this.needsUpdate=!0},Gt.CanvasTexture.prototype=Object.create(Gt.Texture.prototype),Gt.CanvasTexture.prototype.constructor=Gt.CanvasTexture,Gt.CubeTexture=function(e,t,r,i,n,o,a,s,h){t=void 0!==t?t:Gt.CubeReflectionMapping,Gt.Texture.call(this,e,t,r,i,n,o,a,s,h),this.images=e,this.flipY=!1},Gt.CubeTexture.prototype=Object.create(Gt.Texture.prototype),Gt.CubeTexture.prototype.constructor=Gt.CubeTexture,Gt.CubeTexture.prototype.copy=function(e){return Gt.Texture.prototype.copy.call(this,e),this.images=e.images,this},Gt.CompressedTexture=function(e,t,r,i,n,o,a,s,h,l,c){Gt.Texture.call(this,null,o,a,s,h,l,i,n,c),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},Gt.CompressedTexture.prototype=Object.create(Gt.Texture.prototype),Gt.CompressedTexture.prototype.constructor=Gt.CompressedTexture,Gt.DataTexture=function(e,t,r,i,n,o,a,s,h,l,c){Gt.Texture.call(this,null,o,a,s,h,l,i,n,c),this.image={data:e,width:t,height:r},this.magFilter=void 0!==h?h:Gt.NearestFilter,this.minFilter=void 0!==l?l:Gt.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},Gt.DataTexture.prototype=Object.create(Gt.Texture.prototype),Gt.DataTexture.prototype.constructor=Gt.DataTexture,Gt.VideoTexture=function(t,e,r,i,n,o,a,s,h){Gt.Texture.call(this,t,e,r,i,n,o,a,s,h),this.generateMipmaps=!1;var l=this;!function e(){requestAnimationFrame(e),t.readyState===t.HAVE_ENOUGH_DATA&&(l.needsUpdate=!0)}()},Gt.VideoTexture.prototype=Object.create(Gt.Texture.prototype),Gt.VideoTexture.prototype.constructor=Gt.VideoTexture,Gt.Group=function(){Gt.Object3D.call(this),this.type="Group"},Gt.Group.prototype=Object.create(Gt.Object3D.prototype),Gt.Group.prototype.constructor=Gt.Group,Gt.Points=function(e,t){Gt.Object3D.call(this),this.type="Points",this.geometry=void 0!==e?e:new Gt.Geometry,this.material=void 0!==t?t:new Gt.PointsMaterial({color:16777215*Math.random()})},Gt.Points.prototype=Object.create(Gt.Object3D.prototype),Gt.Points.prototype.constructor=Gt.Points,Gt.Points.prototype.raycast=(ot=new Gt.Matrix4,at=new Gt.Ray,function(o,a){var s=this,e=s.geometry,t=o.params.Points.threshold;if(ot.getInverse(this.matrixWorld),at.copy(o.ray).applyMatrix4(ot),null===e.boundingBox||!1!==at.isIntersectionBox(e.boundingBox)){var r=t/((this.scale.x+this.scale.y+this.scale.z)/3),h=r*r,i=new Gt.Vector3;if(e instanceof Gt.BufferGeometry){var n=e.index,l=e.attributes.position.array;if(null!==n)for(var c=n.array,u=0,d=c.length;u<d;u++){var p=c[u];i.fromArray(l,3*p),g(i,p)}else{u=0;for(var f=l.length/3;u<f;u++)i.fromArray(l,3*u),g(i,u)}}else{var m=e.vertices;for(u=0,f=m.length;u<f;u++)g(m[u],u)}}function g(e,t){var r=at.distanceSqToPoint(e);if(r<h){var i=at.closestPointToPoint(e);i.applyMatrix4(s.matrixWorld);var n=o.ray.origin.distanceTo(i);if(n<o.near||n>o.far)return;a.push({distance:n,distanceToRay:Math.sqrt(r),point:i.clone(),index:t,face:null,object:s})}}}),Gt.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},Gt.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Gt.Points(e,t)},Gt.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Gt.Points(e,t)},Gt.Line=function(e,t,r){if(1===r)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new Gt.LineSegments(e,t);Gt.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new Gt.Geometry,this.material=void 0!==t?t:new Gt.LineBasicMaterial({color:16777215*Math.random()})},Gt.Line.prototype=Object.create(Gt.Object3D.prototype),Gt.Line.prototype.constructor=Gt.Line,Gt.Line.prototype.raycast=(st=new Gt.Matrix4,ht=new Gt.Ray,lt=new Gt.Sphere,function(e,t){var r=e.linePrecision,i=r*r,n=this.geometry;if(null===n.boundingSphere&&n.computeBoundingSphere(),lt.copy(n.boundingSphere),lt.applyMatrix4(this.matrixWorld),!1!==e.ray.isIntersectionSphere(lt)){st.getInverse(this.matrixWorld),ht.copy(e.ray).applyMatrix4(st);var o=new Gt.Vector3,a=new Gt.Vector3,s=new Gt.Vector3,h=new Gt.Vector3,l=this instanceof Gt.LineSegments?2:1;if(n instanceof Gt.BufferGeometry){var c=n.index,u=n.attributes;if(null!==c)for(var d=c.array,p=u.position.array,f=0,m=d.length-1;f<m;f+=l){var g=d[f],v=d[f+1];o.fromArray(p,3*g),a.fromArray(p,3*v),i<ht.distanceSqToSegment(o,a,h,s)||(h.applyMatrix4(this.matrixWorld),(_=e.ray.origin.distanceTo(h))<e.near||_>e.far||t.push({distance:_,point:s.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else for(f=0,m=(p=u.position.array).length/3-1;f<m;f+=l)o.fromArray(p,3*f),a.fromArray(p,3*f+3),i<ht.distanceSqToSegment(o,a,h,s)||(h.applyMatrix4(this.matrixWorld),(_=e.ray.origin.distanceTo(h))<e.near||_>e.far||t.push({distance:_,point:s.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}else if(n instanceof Gt.Geometry){var y=n.vertices,x=y.length;for(f=0;f<x-1;f+=l){var _;i<ht.distanceSqToSegment(y[f],y[f+1],h,s)||(h.applyMatrix4(this.matrixWorld),(_=e.ray.origin.distanceTo(h))<e.near||_>e.far||t.push({distance:_,point:s.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}))}}}}),Gt.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},Gt.LineStrip=0,Gt.LinePieces=1,Gt.LineSegments=function(e,t){Gt.Line.call(this,e,t),this.type="LineSegments"},Gt.LineSegments.prototype=Object.create(Gt.Line.prototype),Gt.LineSegments.prototype.constructor=Gt.LineSegments,Gt.Mesh=function(e,t){Gt.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Gt.Geometry,this.material=void 0!==t?t:new Gt.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},Gt.Mesh.prototype=Object.create(Gt.Object3D.prototype),Gt.Mesh.prototype.constructor=Gt.Mesh,Gt.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},Gt.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},Gt.Mesh.prototype.raycast=function(){var V=new Gt.Matrix4,U=new Gt.Ray,B=new Gt.Sphere,O=new Gt.Vector3,N=new Gt.Vector3,G=new Gt.Vector3,I=new Gt.Vector3,z=new Gt.Vector3,H=new Gt.Vector3,j=new Gt.Vector2,W=new Gt.Vector2,X=new Gt.Vector2,s=new Gt.Vector3,q=new Gt.Vector3,l=new Gt.Vector3;function Y(e,t,r,i,n,o,a){return Gt.Triangle.barycoordFromPoint(e,t,r,i,s),n.multiplyScalar(s.x),o.multiplyScalar(s.y),a.multiplyScalar(s.z),n.add(o).add(a),n.clone()}function K(e,t,r,i,n,o,a){var s=e.material;if(null===(s.side===Gt.BackSide?r.intersectTriangle(o,n,i,!0,a):r.intersectTriangle(i,n,o,s.side!==Gt.DoubleSide,a)))return null;l.copy(a),l.applyMatrix4(e.matrixWorld);var h=t.ray.origin.distanceTo(l);return h<t.near||h>t.far?null:{distance:h,point:l.clone(),object:e}}function Q(e,t,r,i,n,o,a,s){O.fromArray(i,3*o),N.fromArray(i,3*a),G.fromArray(i,3*s);var h=K(e,t,r,O,N,G,q);return h&&(n&&(j.fromArray(n,2*o),W.fromArray(n,2*a),X.fromArray(n,2*s),h.uv=Y(q,O,N,G,j,W,X)),h.face=new Gt.Face3(o,a,s,Gt.Triangle.normal(O,N,G)),h.faceIndex=o),h}return function(e,t){var r=this.geometry,i=this.material;if(void 0!==i){null===r.boundingSphere&&r.computeBoundingSphere();var n,o,a=this.matrixWorld;if(B.copy(r.boundingSphere),B.applyMatrix4(a),!1!==e.ray.isIntersectionSphere(B))if(V.getInverse(a),U.copy(e.ray).applyMatrix4(V),null===r.boundingBox||!1!==U.isIntersectionBox(r.boundingBox))if(r instanceof Gt.BufferGeometry){var s,h,l,c=r.index,u=r.attributes,d=u.position.array;if(void 0!==u.uv&&(n=u.uv.array),null!==c)for(var p=c.array,f=0,m=p.length;f<m;f+=3)s=p[f],h=p[f+1],l=p[f+2],(o=Q(this,e,U,d,n,s,h,l))&&(o.faceIndex=Math.floor(f/3),t.push(o));else for(f=0,m=d.length;f<m;f+=9)(o=Q(this,e,U,d,n,s=f/3,h=s+1,l=s+2))&&(o.index=s,t.push(o))}else if(r instanceof Gt.Geometry){var g,v,y,x=i instanceof Gt.MeshFaceMaterial,_=!0===x?i.materials:null,b=r.vertices,w=r.faces,M=r.faceVertexUvs[0];0<M.length&&(n=M);for(var S=0,E=w.length;S<E;S++){var T=w[S],C=!0===x?_[T.materialIndex]:i;if(void 0!==C){if(g=b[T.a],v=b[T.b],y=b[T.c],!0===C.morphTargets){var A=r.morphTargets,L=this.morphTargetInfluences;O.set(0,0,0),N.set(0,0,0),G.set(0,0,0);for(var P=0,k=A.length;P<k;P++){var R=L[P];if(0!==R){var D=A[P].vertices;O.addScaledVector(I.subVectors(D[T.a],g),R),N.addScaledVector(z.subVectors(D[T.b],v),R),G.addScaledVector(H.subVectors(D[T.c],y),R)}}O.add(g),N.add(v),G.add(y),g=O,v=N,y=G}if(o=K(this,e,U,g,v,y,q)){if(n){var F=n[S];j.copy(F[0]),W.copy(F[1]),X.copy(F[2]),o.uv=Y(q,g,v,y,j,W,X)}o.face=T,o.faceIndex=S,t.push(o)}}}}}}}(),Gt.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},Gt.Bone=function(e){Gt.Object3D.call(this),this.type="Bone",this.skin=e},Gt.Bone.prototype=Object.create(Gt.Object3D.prototype),Gt.Bone.prototype.constructor=Gt.Bone,Gt.Bone.prototype.copy=function(e){return Gt.Object3D.prototype.copy.call(this,e),this.skin=e.skin,this},Gt.Skeleton=function(e,t,r){if(this.useVertexTexture=void 0===r||r,this.identityMatrix=new Gt.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture){var i=Math.sqrt(4*this.bones.length);i=Gt.Math.nextPowerOfTwo(Math.ceil(i)),i=Math.max(i,4),this.boneTextureWidth=i,this.boneTextureHeight=i,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new Gt.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,Gt.RGBAFormat,Gt.FloatType)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var n=0,o=this.bones.length;n<o;n++)this.boneInverses.push(new Gt.Matrix4)}},Gt.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new Gt.Matrix4;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},Gt.Skeleton.prototype.pose=function(){for(var e,t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},Gt.Skeleton.prototype.update=(ct=new Gt.Matrix4,function(){for(var e=0,t=this.bones.length;e<t;e++){var r=this.bones[e]?this.bones[e].matrixWorld:this.identityMatrix;ct.multiplyMatrices(r,this.boneInverses[e]),ct.flattenToArrayOffset(this.boneMatrices,16*e)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}),Gt.Skeleton.prototype.clone=function(){return new Gt.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)},Gt.SkinnedMesh=function(e,t,r){Gt.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Gt.Matrix4,this.bindMatrixInverse=new Gt.Matrix4;var i=[];if(this.geometry&&void 0!==this.geometry.bones){for(var n,o,a=0,s=this.geometry.bones.length;a<s;++a)o=this.geometry.bones[a],n=new Gt.Bone(this),i.push(n),n.name=o.name,n.position.fromArray(o.pos),n.quaternion.fromArray(o.rotq),void 0!==o.scl&&n.scale.fromArray(o.scl);for(a=0,s=this.geometry.bones.length;a<s;++a)-1!==(o=this.geometry.bones[a]).parent&&null!==o.parent?i[o.parent].add(i[a]):this.add(i[a])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new Gt.Skeleton(i,void 0,r),this.matrixWorld)},Gt.SkinnedMesh.prototype=Object.create(Gt.Mesh.prototype),Gt.SkinnedMesh.prototype.constructor=Gt.SkinnedMesh,Gt.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},Gt.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},Gt.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof Gt.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();r!==1/0?t.multiplyScalar(r):t.set(1)}},Gt.SkinnedMesh.prototype.updateMatrixWorld=function(e){Gt.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},Gt.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)},Gt.LOD=function(){Gt.Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}})},Gt.LOD.prototype=Object.create(Gt.Object3D.prototype),Gt.LOD.prototype.constructor=Gt.LOD,Gt.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,i=0;i<r.length&&!(t<r[i].distance);i++);r.splice(i,0,{distance:t,object:e}),this.add(e)},Gt.LOD.prototype.getObjectForDistance=function(e){for(var t=this.levels,r=1,i=t.length;r<i&&!(e<t[r].distance);r++);return t[r-1].object},Gt.LOD.prototype.raycast=(ut=new Gt.Vector3,function(e,t){ut.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(ut);this.getObjectForDistance(r).raycast(e,t)}),Gt.LOD.prototype.update=(dt=new Gt.Vector3,pt=new Gt.Vector3,function(e){var t=this.levels;if(1<t.length){dt.setFromMatrixPosition(e.matrixWorld),pt.setFromMatrixPosition(this.matrixWorld);var r=dt.distanceTo(pt);t[0].object.visible=!0;for(var i=1,n=t.length;i<n&&r>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(;i<n;i++)t[i].object.visible=!1}}),Gt.LOD.prototype.copy=function(e){Gt.Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,i=t.length;r<i;r++){var n=t[r];this.addLevel(n.object.clone(),n.distance)}return this},Gt.LOD.prototype.toJSON=function(e){var t=Gt.Object3D.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,i=0,n=r.length;i<n;i++){var o=r[i];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t},Gt.Sprite=(ft=new Uint16Array([0,1,2,0,2,3]),mt=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),gt=new Float32Array([0,0,1,0,1,1,0,1]),(vt=new Gt.BufferGeometry).setIndex(new Gt.BufferAttribute(ft,1)),vt.addAttribute("position",new Gt.BufferAttribute(mt,3)),vt.addAttribute("uv",new Gt.BufferAttribute(gt,2)),function(e){Gt.Object3D.call(this),this.type="Sprite",this.geometry=vt,this.material=void 0!==e?e:new Gt.SpriteMaterial}),Gt.Sprite.prototype=Object.create(Gt.Object3D.prototype),Gt.Sprite.prototype.constructor=Gt.Sprite,Gt.Sprite.prototype.raycast=(yt=new Gt.Vector3,function(e,t){yt.setFromMatrixPosition(this.matrixWorld);var r=e.ray.distanceSqToPoint(yt);this.scale.x*this.scale.y<r||t.push({distance:Math.sqrt(r),point:this.position,face:null,object:this})}),Gt.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)},Gt.Particle=Gt.Sprite,Gt.LensFlare=function(e,t,r,i,n){Gt.Object3D.call(this),this.lensFlares=[],this.positionScreen=new Gt.Vector3,(this.customUpdateCallback=void 0)!==e&&this.add(e,t,r,i,n)},Gt.LensFlare.prototype=Object.create(Gt.Object3D.prototype),Gt.LensFlare.prototype.constructor=Gt.LensFlare,Gt.LensFlare.prototype.add=function(e,t,r,i,n,o){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===o&&(o=1),void 0===n&&(n=new Gt.Color(16777215)),void 0===i&&(i=Gt.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:n,blending:i})},Gt.LensFlare.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,i=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;e<r;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+i*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},Gt.LensFlare.prototype.copy=function(e){Gt.Object3D.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,r=e.lensFlares.length;t<r;t++)this.lensFlares.push(e.lensFlares[t]);return this},Gt.Scene=function(){Gt.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},Gt.Scene.prototype=Object.create(Gt.Object3D.prototype),Gt.Scene.prototype.constructor=Gt.Scene,Gt.Scene.prototype.copy=function(e){return Gt.Object3D.prototype.copy.call(this,e),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},Gt.Fog=function(e,t,r){this.name="",this.color=new Gt.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},Gt.Fog.prototype.clone=function(){return new Gt.Fog(this.color.getHex(),this.near,this.far)},Gt.FogExp2=function(e,t){this.name="",this.color=new Gt.Color(e),this.density=void 0!==t?t:25e-5},Gt.FogExp2.prototype.clone=function(){return new Gt.FogExp2(this.color.getHex(),this.density)},Gt.ShaderChunk={},Gt.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",Gt.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",Gt.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",Gt.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\n\ttotalAmbientLight *= ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n#endif\n",Gt.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif",Gt.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n",Gt.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n",Gt.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",Gt.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif",Gt.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",Gt.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif",Gt.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\tvColor.xyz = color.xyz;\n\n#endif",Gt.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\n\tif ( decayExponent > 0.0 ) {\n\n\t  return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n}\n\nvec3 F_Schlick( in vec3 specularColor, in float dotLH ) {\n\n\n\tfloat fresnel = exp2( ( -5.55437 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* in float dotNL, in float dotNV */ ) {\n\n\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( in float shininess, in float dotNH ) {\n\n\n\treturn ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_BlinnPhong( in vec3 specularColor, in float shininess, in vec3 normal, in vec3 lightDir, in vec3 viewDir ) {\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( lightDir, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * G * D;\n\n}\n\nvec3 inputToLinear( in vec3 a ) {\n\n\t#ifdef GAMMA_INPUT\n\n\t\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n\n\t#else\n\n\t\treturn a;\n\n\t#endif\n\n}\n\nvec3 linearToOutput( in vec3 a ) {\n\n\t#ifdef GAMMA_OUTPUT\n\n\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n\n\t#else\n\n\t\treturn a;\n\n\t#endif\n\n}\n",Gt.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",Gt.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n\n#endif\n",Gt.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",Gt.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = inputToLinear( emissiveColor.rgb );\n\n\ttotalEmissiveLight *= emissiveColor.rgb;\n\n#endif\n",Gt.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",Gt.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",Gt.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n",Gt.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n",Gt.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n",Gt.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",Gt.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif",Gt.ShaderChunk.hemilight_fragment="#if MAX_HEMI_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lightDir = hemisphereLightDirection[ i ];\n\n\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 lightColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalAmbientLight += lightColor;\n\n\t}\n\n#endif\n\n",Gt.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\ttotalAmbientLight += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n#endif\n",Gt.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif",Gt.ShaderChunk.lights_lambert_pars_vertex="#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n",Gt.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\nvec3 normal = normalize( transformedNormal );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = pointLightColor[ i ];\n\n\t\tvec3 lVector = pointLightPosition[ i ] - mvPosition.xyz;\n\t\tvec3 lightDir = normalize( lVector );\n\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\n\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\tvLightFront += lightColor * attenuation * saturate( dotProduct );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = spotLightColor[ i ];\n\n\t\tvec3 lightPosition = spotLightPosition[ i ];\n\t\tvec3 lVector = lightPosition - mvPosition.xyz;\n\t\tvec3 lightDir = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tattenuation *= spotEffect;\n\n\n\t\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\t\tvLightFront += lightColor * attenuation * saturate( dotProduct );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = directionalLightColor[ i ];\n\n\t\tvec3 lightDir = directionalLightDirection[ i ];\n\n\n\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\tvLightFront += lightColor * saturate( dotProduct );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += lightColor * saturate( - dotProduct );\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lightDir = hemisphereLightDirection[ i ];\n\n\n\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tfloat hemiDiffuseWeightBack = - 0.5 * dotProduct + 0.5;\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n",Gt.ShaderChunk.lights_phong_fragment="vec3 viewDir = normalize( vViewPosition );\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = pointLightColor[ i ];\n\n\t\tvec3 lightPosition = pointLightPosition[ i ];\n\t\tvec3 lVector = lightPosition + vViewPosition.xyz;\n\t\tvec3 lightDir = normalize( lVector );\n\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\n\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\n\n\t\ttotalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n\n\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n\t\ttotalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = spotLightColor[ i ];\n\n\t\tvec3 lightPosition = spotLightPosition[ i ];\n\t\tvec3 lVector = lightPosition + vViewPosition.xyz;\n\t\tvec3 lightDir = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tattenuation *= spotEffect;\n\n\n\t\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\n\n\t\t\ttotalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n\n\t\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n\t\t\ttotalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = directionalLightColor[ i ];\n\n\t\tvec3 lightDir = directionalLightDirection[ i ];\n\n\n\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\n\n\t\ttotalDiffuseLight += lightColor * cosineTerm;\n\n\n\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n\t\ttotalSpecularLight += brdf * specularStrength * lightColor * cosineTerm;\n\n\t}\n\n#endif\n",Gt.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n",Gt.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\n#endif\n",Gt.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif\n",Gt.ShaderChunk.linear_to_gamma_fragment="\n\toutgoingLight = linearToOutput( outgoingLight );\n",Gt.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",Gt.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif\n",Gt.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif",Gt.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif",Gt.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif\n",Gt.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif",Gt.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",Gt.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n",Gt.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n",Gt.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif",Gt.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",Gt.ShaderChunk.normal_phong_fragment="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n",Gt.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",Gt.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",Gt.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\tfor ( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tfloat texelSizeY =  1.0 / shadowMapSize[ i ].y;\n\n\t\tfloat shadow = 0.0;\n\n#if defined( POINT_LIGHT_SHADOWS )\n\n\t\tbool isPointLight = shadowDarkness[ i ] < 0.0;\n\n\t\tif ( isPointLight ) {\n\n\t\t\tfloat realShadowDarkness = abs( shadowDarkness[ i ] );\n\n\t\t\tvec3 lightToPosition = vShadowCoord[ i ].xyz;\n\n\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tfloat dp = length( lightToPosition );\n\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D, texelSizeY ) ), shadowBias[ i ], shadow );\n\n\n\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tconst float Dr = 1.25;\n\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tconst float Dr = 2.25;\n\t#endif\n\n\t\t\tfloat os = Dr *  2.0 * texelSizeY;\n\n\t\t\tconst vec3 Gsd = vec3( - 1, 0, 1 );\n\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zyz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xyz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zyx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xyx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\n\t\t\tshadow *= realShadowDarkness * ( 1.0 / 21.0 );\n\n\t#else \n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tfloat dp = length( lightToPosition );\n\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D, texelSizeY ) ), shadowBias[ i ], shadow );\n\n\t\t\tshadow *= realShadowDarkness;\n\n\t#endif\n\n\t\t} else {\n\n#endif \n\t\t\tfloat texelSizeX =  1.0 / shadowMapSize[ i ].x;\n\n\t\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\n\t\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t\tbool frustumTest = all( frustumTestVec );\n\n\t\t\tif ( frustumTest ) {\n\n\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\n\t\t\t\t/*\n\t\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\t\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\t\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\t\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\t\tshadow += 1.0;\n\t\t\t\t\t}\n\t\t\t\t\tshadow /= 9.0;\n\t\t\t\t*/\n\n\t\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t\tconst float ShadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = texelSizeX;\n\t\t\t\tfloat yPixelOffset = texelSizeY;\n\n\t\t\t\tfloat dx0 = - 1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = - 1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfloat fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tshadow *= shadowDarkness[ i ];\n\n\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\n\t\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t\tfloat xPixelOffset = texelSizeX;\n\t\t\t\tfloat yPixelOffset = texelSizeY;\n\n\t\t\t\tfloat dx0 = - 1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = - 1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[ 0 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[ 0 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[ 0 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[ 1 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[ 1 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[ 1 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[ 2 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[ 2 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[ 2 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[ 0 ] = vec3( lessThan( depthKernel[ 0 ], shadowZ ) );\n\t\t\t\tshadowKernel[ 0 ] *= vec3( 0.25 );\n\n\t\t\t\tshadowKernel[ 1 ] = vec3( lessThan( depthKernel[ 1 ], shadowZ ) );\n\t\t\t\tshadowKernel[ 1 ] *= vec3( 0.25 );\n\n\t\t\t\tshadowKernel[ 2 ] = vec3( lessThan( depthKernel[ 2 ], shadowZ ) );\n\t\t\t\tshadowKernel[ 2 ] *= vec3( 0.25 );\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[ i ].xy );\n\n\t\t\t\tshadowKernel[ 0 ] = mix( shadowKernel[ 1 ], shadowKernel[ 0 ], fractionalCoord.x );\n\t\t\t\tshadowKernel[ 1 ] = mix( shadowKernel[ 2 ], shadowKernel[ 1 ], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[ 0 ][ 1 ], shadowKernel[ 0 ][ 0 ], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[ 0 ][ 2 ], shadowKernel[ 0 ][ 1 ], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[ 1 ][ 1 ], shadowKernel[ 1 ][ 0 ], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[ 1 ][ 2 ], shadowKernel[ 1 ][ 1 ], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) ) * shadowDarkness[ i ];\n\n\t#else \n\t\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\tshadow = shadowDarkness[ i ];\n\n\t#endif\n\n\t\t\t}\n\n#ifdef SHADOWMAP_DEBUG\n\n\t\t\tif ( inFrustum ) {\n\n\t\t\t\tif ( i == 0 ) {\n\n\t\t\t\t\toutgoingLight *= vec3( 1.0, 0.5, 0.0 );\n\n\t\t\t\t} else if ( i == 1 ) {\n\n\t\t\t\t\toutgoingLight *= vec3( 0.0, 1.0, 0.8 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\toutgoingLight *= vec3( 0.0, 0.5, 1.0 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n#endif\n\n#if defined( POINT_LIGHT_SHADOWS )\n\n\t\t}\n\n#endif\n\n\t\tshadowMask = shadowMask * vec3( 1.0 - shadow );\n\n\t}\n\n#endif\n",Gt.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n\t#if defined(POINT_LIGHT_SHADOWS)\n\n\n\t\tvoid adjustShadowValue1K( const float testDepth, const vec4 textureData, const float bias, inout float shadowValue ) {\n\n\t\t\tconst vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\t\tif ( testDepth >= dot( textureData, bitSh ) * 1000.0 + bias )\n\t\t\t\tshadowValue += 1.0;\n\n\t\t}\n\n\n\t\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\n\t\t\tvec3 absV = abs( v );\n\n\n\t\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\t\tabsV *= scaleToCube;\n\n\n\t\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\n\n\t\t\tvec2 planar = v.xy;\n\n\t\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\t\tif ( absV.z >= almostOne ) {\n\n\t\t\t\tif ( v.z > 0.0 )\n\t\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\t\tfloat signX = sign( v.x );\n\t\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\t\tfloat signY = sign( v.y );\n\t\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t\t}\n\n\n\t\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t\t}\n\n\t#endif\n\n#endif\n",Gt.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n#endif",Gt.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor ( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif",Gt.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",Gt.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",Gt.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n",Gt.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n",Gt.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif",Gt.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif",Gt.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif",Gt.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n#endif",Gt.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = uv2;\n\n#endif",Gt.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n\tvarying vec2 vUv;\n\n#endif",Gt.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n",Gt.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",Gt.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n\t#endif\n\n#endif\n",Gt.UniformsUtils={merge:function(e){for(var t={},r=0;r<e.length;r++){var i=this.clone(e[r]);for(var n in i)t[n]=i[n]}return t},clone:function(e){var t={};for(var r in e)for(var i in t[r]={},e[r]){var n=e[r][i];n instanceof Gt.Color||n instanceof Gt.Vector2||n instanceof Gt.Vector3||n instanceof Gt.Vector4||n instanceof Gt.Matrix3||n instanceof Gt.Matrix4||n instanceof Gt.Texture?t[r][i]=n.clone():Array.isArray(n)?t[r][i]=n.slice():t[r][i]=n}return t}},Gt.UniformsLib={common:{diffuse:{type:"c",value:new Gt.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new Gt.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new Gt.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Gt.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},points:{psColor:{type:"c",value:new Gt.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new Gt.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Gt.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},Gt.ShaderLib={basic:{uniforms:Gt.UniformsUtils.merge([Gt.UniformsLib.common,Gt.UniformsLib.aomap,Gt.UniformsLib.fog,Gt.UniformsLib.shadowmap]),vertexShader:[Gt.ShaderChunk.common,Gt.ShaderChunk.uv_pars_vertex,Gt.ShaderChunk.uv2_pars_vertex,Gt.ShaderChunk.envmap_pars_vertex,Gt.ShaderChunk.color_pars_vertex,Gt.ShaderChunk.morphtarget_pars_vertex,Gt.ShaderChunk.skinning_pars_vertex,Gt.ShaderChunk.shadowmap_pars_vertex,Gt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Gt.ShaderChunk.uv_vertex,Gt.ShaderChunk.uv2_vertex,Gt.ShaderChunk.color_vertex,Gt.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",Gt.ShaderChunk.beginnormal_vertex,Gt.ShaderChunk.morphnormal_vertex,Gt.ShaderChunk.skinnormal_vertex,Gt.ShaderChunk.defaultnormal_vertex,"\t#endif",Gt.ShaderChunk.begin_vertex,Gt.ShaderChunk.morphtarget_vertex,Gt.ShaderChunk.skinning_vertex,Gt.ShaderChunk.project_vertex,Gt.ShaderChunk.logdepthbuf_vertex,Gt.ShaderChunk.worldpos_vertex,Gt.ShaderChunk.envmap_vertex,Gt.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",Gt.ShaderChunk.common,Gt.ShaderChunk.color_pars_fragment,Gt.ShaderChunk.uv_pars_fragment,Gt.ShaderChunk.uv2_pars_fragment,Gt.ShaderChunk.map_pars_fragment,Gt.ShaderChunk.alphamap_pars_fragment,Gt.ShaderChunk.aomap_pars_fragment,Gt.ShaderChunk.envmap_pars_fragment,Gt.ShaderChunk.fog_pars_fragment,Gt.ShaderChunk.shadowmap_pars_fragment,Gt.ShaderChunk.specularmap_pars_fragment,Gt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );","\tvec3 totalAmbientLight = vec3( 1.0 );","\tvec3 shadowMask = vec3( 1.0 );",Gt.ShaderChunk.logdepthbuf_fragment,Gt.ShaderChunk.map_fragment,Gt.ShaderChunk.color_fragment,Gt.ShaderChunk.alphamap_fragment,Gt.ShaderChunk.alphatest_fragment,Gt.ShaderChunk.specularmap_fragment,Gt.ShaderChunk.aomap_fragment,Gt.ShaderChunk.shadowmap_fragment,"\toutgoingLight = diffuseColor.rgb * totalAmbientLight * shadowMask;",Gt.ShaderChunk.envmap_fragment,Gt.ShaderChunk.linear_to_gamma_fragment,Gt.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:Gt.UniformsUtils.merge([Gt.UniformsLib.common,Gt.UniformsLib.fog,Gt.UniformsLib.lights,Gt.UniformsLib.shadowmap,{emissive:{type:"c",value:new Gt.Color(0)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",Gt.ShaderChunk.common,Gt.ShaderChunk.uv_pars_vertex,Gt.ShaderChunk.uv2_pars_vertex,Gt.ShaderChunk.envmap_pars_vertex,Gt.ShaderChunk.lights_lambert_pars_vertex,Gt.ShaderChunk.color_pars_vertex,Gt.ShaderChunk.morphtarget_pars_vertex,Gt.ShaderChunk.skinning_pars_vertex,Gt.ShaderChunk.shadowmap_pars_vertex,Gt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Gt.ShaderChunk.uv_vertex,Gt.ShaderChunk.uv2_vertex,Gt.ShaderChunk.color_vertex,Gt.ShaderChunk.beginnormal_vertex,Gt.ShaderChunk.morphnormal_vertex,Gt.ShaderChunk.skinbase_vertex,Gt.ShaderChunk.skinnormal_vertex,Gt.ShaderChunk.defaultnormal_vertex,Gt.ShaderChunk.begin_vertex,Gt.ShaderChunk.morphtarget_vertex,Gt.ShaderChunk.skinning_vertex,Gt.ShaderChunk.project_vertex,Gt.ShaderChunk.logdepthbuf_vertex,Gt.ShaderChunk.worldpos_vertex,Gt.ShaderChunk.envmap_vertex,Gt.ShaderChunk.lights_lambert_vertex,Gt.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","uniform vec3 ambientLightColor;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",Gt.ShaderChunk.common,Gt.ShaderChunk.color_pars_fragment,Gt.ShaderChunk.uv_pars_fragment,Gt.ShaderChunk.uv2_pars_fragment,Gt.ShaderChunk.map_pars_fragment,Gt.ShaderChunk.alphamap_pars_fragment,Gt.ShaderChunk.envmap_pars_fragment,Gt.ShaderChunk.fog_pars_fragment,Gt.ShaderChunk.shadowmap_pars_fragment,Gt.ShaderChunk.specularmap_pars_fragment,Gt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );","\tvec3 totalAmbientLight = ambientLightColor;","\tvec3 shadowMask = vec3( 1.0 );",Gt.ShaderChunk.logdepthbuf_fragment,Gt.ShaderChunk.map_fragment,Gt.ShaderChunk.color_fragment,Gt.ShaderChunk.alphamap_fragment,Gt.ShaderChunk.alphatest_fragment,Gt.ShaderChunk.specularmap_fragment,Gt.ShaderChunk.shadowmap_fragment,"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\toutgoingLight += diffuseColor.rgb * ( vLightFront * shadowMask + totalAmbientLight ) + emissive;","\t\telse","\t\t\toutgoingLight += diffuseColor.rgb * ( vLightBack * shadowMask + totalAmbientLight ) + emissive;","\t#else","\t\toutgoingLight += diffuseColor.rgb * ( vLightFront * shadowMask + totalAmbientLight ) + emissive;","\t#endif",Gt.ShaderChunk.envmap_fragment,Gt.ShaderChunk.linear_to_gamma_fragment,Gt.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:Gt.UniformsUtils.merge([Gt.UniformsLib.common,Gt.UniformsLib.aomap,Gt.UniformsLib.lightmap,Gt.UniformsLib.emissivemap,Gt.UniformsLib.bumpmap,Gt.UniformsLib.normalmap,Gt.UniformsLib.displacementmap,Gt.UniformsLib.fog,Gt.UniformsLib.lights,Gt.UniformsLib.shadowmap,{emissive:{type:"c",value:new Gt.Color(0)},specular:{type:"c",value:new Gt.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif",Gt.ShaderChunk.common,Gt.ShaderChunk.uv_pars_vertex,Gt.ShaderChunk.uv2_pars_vertex,Gt.ShaderChunk.displacementmap_pars_vertex,Gt.ShaderChunk.envmap_pars_vertex,Gt.ShaderChunk.lights_phong_pars_vertex,Gt.ShaderChunk.color_pars_vertex,Gt.ShaderChunk.morphtarget_pars_vertex,Gt.ShaderChunk.skinning_pars_vertex,Gt.ShaderChunk.shadowmap_pars_vertex,Gt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Gt.ShaderChunk.uv_vertex,Gt.ShaderChunk.uv2_vertex,Gt.ShaderChunk.color_vertex,Gt.ShaderChunk.beginnormal_vertex,Gt.ShaderChunk.morphnormal_vertex,Gt.ShaderChunk.skinbase_vertex,Gt.ShaderChunk.skinnormal_vertex,Gt.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",Gt.ShaderChunk.begin_vertex,Gt.ShaderChunk.displacementmap_vertex,Gt.ShaderChunk.morphtarget_vertex,Gt.ShaderChunk.skinning_vertex,Gt.ShaderChunk.project_vertex,Gt.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = - mvPosition.xyz;",Gt.ShaderChunk.worldpos_vertex,Gt.ShaderChunk.envmap_vertex,Gt.ShaderChunk.lights_phong_vertex,Gt.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",Gt.ShaderChunk.common,Gt.ShaderChunk.color_pars_fragment,Gt.ShaderChunk.uv_pars_fragment,Gt.ShaderChunk.uv2_pars_fragment,Gt.ShaderChunk.map_pars_fragment,Gt.ShaderChunk.alphamap_pars_fragment,Gt.ShaderChunk.aomap_pars_fragment,Gt.ShaderChunk.lightmap_pars_fragment,Gt.ShaderChunk.emissivemap_pars_fragment,Gt.ShaderChunk.envmap_pars_fragment,Gt.ShaderChunk.fog_pars_fragment,Gt.ShaderChunk.lights_phong_pars_fragment,Gt.ShaderChunk.shadowmap_pars_fragment,Gt.ShaderChunk.bumpmap_pars_fragment,Gt.ShaderChunk.normalmap_pars_fragment,Gt.ShaderChunk.specularmap_pars_fragment,Gt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );","\tvec3 totalAmbientLight = ambientLightColor;","\tvec3 totalEmissiveLight = emissive;","\tvec3 shadowMask = vec3( 1.0 );",Gt.ShaderChunk.logdepthbuf_fragment,Gt.ShaderChunk.map_fragment,Gt.ShaderChunk.color_fragment,Gt.ShaderChunk.alphamap_fragment,Gt.ShaderChunk.alphatest_fragment,Gt.ShaderChunk.specularmap_fragment,Gt.ShaderChunk.normal_phong_fragment,Gt.ShaderChunk.lightmap_fragment,Gt.ShaderChunk.hemilight_fragment,Gt.ShaderChunk.aomap_fragment,Gt.ShaderChunk.emissivemap_fragment,Gt.ShaderChunk.lights_phong_fragment,Gt.ShaderChunk.shadowmap_fragment,"totalDiffuseLight *= shadowMask;","totalSpecularLight *= shadowMask;","#ifdef METAL","\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) * specular + totalSpecularLight + totalEmissiveLight;","#else","\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) + totalSpecularLight + totalEmissiveLight;","#endif",Gt.ShaderChunk.envmap_fragment,Gt.ShaderChunk.linear_to_gamma_fragment,Gt.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},points:{uniforms:Gt.UniformsUtils.merge([Gt.UniformsLib.points,Gt.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",Gt.ShaderChunk.common,Gt.ShaderChunk.color_pars_vertex,Gt.ShaderChunk.shadowmap_pars_vertex,Gt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Gt.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",Gt.ShaderChunk.logdepthbuf_vertex,Gt.ShaderChunk.worldpos_vertex,Gt.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",Gt.ShaderChunk.common,Gt.ShaderChunk.color_pars_fragment,Gt.ShaderChunk.map_particle_pars_fragment,Gt.ShaderChunk.fog_pars_fragment,Gt.ShaderChunk.shadowmap_pars_fragment,Gt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( psColor, opacity );","\tvec3 shadowMask = vec3( 1.0 );",Gt.ShaderChunk.logdepthbuf_fragment,Gt.ShaderChunk.map_particle_fragment,Gt.ShaderChunk.color_fragment,Gt.ShaderChunk.alphatest_fragment,Gt.ShaderChunk.shadowmap_fragment,"\toutgoingLight = diffuseColor.rgb * shadowMask;",Gt.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:Gt.UniformsUtils.merge([Gt.UniformsLib.common,Gt.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",Gt.ShaderChunk.common,Gt.ShaderChunk.color_pars_vertex,Gt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Gt.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",Gt.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",Gt.ShaderChunk.common,Gt.ShaderChunk.color_pars_fragment,Gt.ShaderChunk.fog_pars_fragment,Gt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",Gt.ShaderChunk.logdepthbuf_fragment,Gt.ShaderChunk.color_fragment,"\toutgoingLight = diffuseColor.rgb;",Gt.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[Gt.ShaderChunk.common,Gt.ShaderChunk.morphtarget_pars_vertex,Gt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Gt.ShaderChunk.begin_vertex,Gt.ShaderChunk.morphtarget_vertex,Gt.ShaderChunk.project_vertex,Gt.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",Gt.ShaderChunk.common,Gt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",Gt.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",Gt.ShaderChunk.common,Gt.ShaderChunk.morphtarget_pars_vertex,Gt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvNormal = normalize( normalMatrix * normal );",Gt.ShaderChunk.begin_vertex,Gt.ShaderChunk.morphtarget_vertex,Gt.ShaderChunk.project_vertex,Gt.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",Gt.ShaderChunk.common,Gt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",Gt.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",Gt.ShaderChunk.common,Gt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",Gt.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",Gt.ShaderChunk.common,Gt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",Gt.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",Gt.ShaderChunk.common,Gt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",Gt.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",Gt.ShaderChunk.common,Gt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",Gt.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[Gt.ShaderChunk.common,Gt.ShaderChunk.morphtarget_pars_vertex,Gt.ShaderChunk.skinning_pars_vertex,Gt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Gt.ShaderChunk.skinbase_vertex,Gt.ShaderChunk.begin_vertex,Gt.ShaderChunk.morphtarget_vertex,Gt.ShaderChunk.skinning_vertex,Gt.ShaderChunk.project_vertex,Gt.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[Gt.ShaderChunk.common,Gt.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",Gt.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new Gt.Vector3(0,0,0)}},vertexShader:["varying vec4 vWorldPosition;",Gt.ShaderChunk.common,Gt.ShaderChunk.morphtarget_pars_vertex,Gt.ShaderChunk.skinning_pars_vertex,"void main() {",Gt.ShaderChunk.skinbase_vertex,Gt.ShaderChunk.begin_vertex,Gt.ShaderChunk.morphtarget_vertex,Gt.ShaderChunk.skinning_vertex,Gt.ShaderChunk.project_vertex,Gt.ShaderChunk.worldpos_vertex,"vWorldPosition = worldPosition;","}"].join("\n"),fragmentShader:["uniform vec3 lightPos;","varying vec4 vWorldPosition;",Gt.ShaderChunk.common,"vec4 pack1K ( float depth ) {","   depth /= 1000.0;","   const vec4 bitSh = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bitMsk = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = fract( depth * bitSh );","\tres -= res.xxyz * bitMsk;","\treturn res; ","}","float unpack1K ( vec4 color ) {","\tconst vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","\treturn dot( color, bitSh ) * 1000.0;","}","void main () {","\tgl_FragColor = pack1K( length( vWorldPosition.xyz - lightPos.xyz ) );","}"].join("\n")}},Gt.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",Gt.REVISION);var b=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),t=void 0!==e.context?e.context:null,i=b.width,n=b.height,L=1,r=void 0!==e.alpha&&e.alpha,o=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,h=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=new Gt.Color(0),u=0,d=[],p=[],f=-1,m=[],g=-1,P=new Float32Array(8),v=[],y=[];this.domElement=b,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var k,w=this,M=null,x=null,S=-1,R="",E=null,T=0,_=0,C=0,A=b.width,D=b.height,F=0,V=0,U=new Gt.Frustum,B=new Gt.Matrix4,H=new Gt.Vector3,j=new Gt.Vector3,O=!0,W={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},N={geometries:0,textures:0},G={calls:0,vertices:0,faces:0,points:0};this.info={render:G,memory:N,programs:null};try{var I={alpha:r,depth:o,stencil:a,antialias:s,premultipliedAlpha:h,preserveDrawingBuffer:l};if(null===(k=t||b.getContext("webgl",I)||b.getContext("experimental-webgl",I)))throw null!==b.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";b.addEventListener("webglcontextlost",ae,!1)}catch(e){console.error("THREE.WebGLRenderer: "+e)}var z=new Gt.WebGLExtensions(k);z.get("OES_texture_float"),z.get("OES_texture_float_linear"),z.get("OES_texture_half_float"),z.get("OES_texture_half_float_linear"),z.get("OES_standard_derivatives"),z.get("ANGLE_instanced_arrays"),z.get("OES_element_index_uint")&&(Gt.BufferGeometry.MaxIndex=4294967296);var X=new Gt.WebGLCapabilities(k,z,e),q=new Gt.WebGLState(k,z,ke),Y=new Gt.WebGLProperties,K=new Gt.WebGLObjects(k,Y,this.info),Q=new Gt.WebGLPrograms(this,X);this.info.programs=Q.programs;var Z=new Gt.WebGLBufferRenderer(k,z,G),J=new Gt.WebGLIndexedBufferRenderer(k,z,G);function $(e,t,r,i){!0===h&&(e*=i,t*=i,r*=i),k.clearColor(e,t,r,i)}function ee(){q.init(),k.viewport(_,C,A,D),$(c.r,c.g,c.b,u)}function te(){E=M=null,S=-1,O=!(R=""),q.reset()}ee(),this.context=k,this.capabilities=X,this.extensions=z,this.state=q;var re=new Gt.WebGLShadowMap(this,d,K);this.shadowMap=re;var ie,ne=new Gt.SpritePlugin(this,v),oe=new Gt.LensFlarePlugin(this,y);function ae(e){e.preventDefault(),te(),ee(),Y.clear()}function se(e){var t=e.target;t.removeEventListener("dispose",se),function(e){var t=Y.get(e);if(e.image&&t.__image__webglTextureCube)k.deleteTexture(t.__image__webglTextureCube);else{if(void 0===t.__webglInit)return;k.deleteTexture(t.__webglTexture)}Y.delete(e)}(t),N.textures--}function he(e){var t=e.target;t.removeEventListener("dispose",he),function(e){var t=Y.get(e),r=Y.get(e.texture);if(!e||void 0===r.__webglTexture)return;if(k.deleteTexture(r.__webglTexture),e instanceof Gt.WebGLRenderTargetCube)for(var i=0;i<6;i++)k.deleteFramebuffer(t.__webglFramebuffer[i]),k.deleteRenderbuffer(t.__webglRenderbuffer[i]);else k.deleteFramebuffer(t.__webglFramebuffer),k.deleteRenderbuffer(t.__webglRenderbuffer);Y.delete(e.texture),Y.delete(e)}(t),N.textures--}function le(e){var t,r=e.target;r.removeEventListener("dispose",le),ce(t=r),Y.delete(t)}function ce(e){var t=Y.get(e).program;(e.program=void 0)!==t&&Q.releaseProgram(t)}function ue(e,t){return t[0]-e[0]}function de(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function pe(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function fe(e,t,r,i,n){var o,a;r.transparent?(o=m,a=++g):(o=p,a=++f);var s=o[a];void 0!==s?(s.id=e.id,s.object=e,s.geometry=t,s.material=r,s.z=H.z,s.group=n):(s={id:e.id,object:e,geometry:t,material:r,z:H.z,group:n},o.push(s))}function me(e,t,r,i,n){for(var o=0,a=e.length;o<a;o++){var s=e[o],h=s.object,l=s.geometry,c=void 0===n?s.material:n,u=s.group;if(h.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,h.matrixWorld),h.normalMatrix.getNormalMatrix(h.modelViewMatrix),h instanceof Gt.ImmediateRenderObject){ge(c);var d=ve(t,r,i,c,h);R="",h.render(function(e){w.renderBufferImmediate(e,d,c)})}else w.renderBufferDirect(t,r,i,l,c,h,u)}}function ge(e){var t;(t=e).side!==Gt.DoubleSide?q.enable(k.CULL_FACE):q.disable(k.CULL_FACE),q.setFlipSided(t.side===Gt.BackSide),!0===e.transparent?q.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):q.setBlending(Gt.NoBlending),q.setDepthFunc(e.depthFunc),q.setDepthTest(e.depthTest),q.setDepthWrite(e.depthWrite),q.setColorWrite(e.colorWrite),q.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function ve(e,t,r,i,n){T=0;var o=Y.get(i);!i.needsUpdate&&o.program||(!function(e,t,r,i){var n=Y.get(e),o=Q.getParameters(e,t,r,i),a=Q.getProgramCode(e,o),s=n.program,h=!0;if(void 0===s)e.addEventListener("dispose",le);else if(s.code!==a)ce(e);else{if(void 0!==o.shaderID)return;h=!1}if(h){if(o.shaderID){var l=Gt.ShaderLib[o.shaderID];n.__webglShader={name:e.type,uniforms:Gt.UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else n.__webglShader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.__webglShader=n.__webglShader,s=Q.acquireProgram(e,o,a),n.program=s,e.program=s}var c=s.getAttributes();if(e.morphTargets)for(var u=e.numSupportedMorphTargets=0;u<w.maxMorphTargets;u++)0<=c["morphTarget"+u]&&e.numSupportedMorphTargets++;if(e.morphNormals)for(u=e.numSupportedMorphNormals=0;u<w.maxMorphNormals;u++)0<=c["morphNormal"+u]&&e.numSupportedMorphNormals++;n.uniformsList=[];var d=n.program.getUniforms();for(var p in n.__webglShader.uniforms){var f=d[p];f&&n.uniformsList.push([n.__webglShader.uniforms[p],f])}}(i,t,r,n),i.needsUpdate=!1);var a,s,h,l,c,u,d,p,f=!1,m=!1,g=!1,v=o.program,y=v.getUniforms(),x=o.__webglShader.uniforms;if(v.id!==M&&(k.useProgram(v.program),M=v.id,g=m=f=!0),i.id!==S&&(-1===S&&(g=!0),S=i.id,m=!0),(f||e!==E)&&(k.uniformMatrix4fv(y.projectionMatrix,!1,e.projectionMatrix.elements),X.logarithmicDepthBuffer&&k.uniform1f(y.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==E&&(E=e),(i instanceof Gt.ShaderMaterial||i instanceof Gt.MeshPhongMaterial||i.envMap)&&void 0!==y.cameraPosition&&(H.setFromMatrixPosition(e.matrixWorld),k.uniform3f(y.cameraPosition,H.x,H.y,H.z)),(i instanceof Gt.MeshPhongMaterial||i instanceof Gt.MeshLambertMaterial||i instanceof Gt.MeshBasicMaterial||i instanceof Gt.ShaderMaterial||i.skinning)&&void 0!==y.viewMatrix&&k.uniformMatrix4fv(y.viewMatrix,!1,e.matrixWorldInverse.elements)),i.skinning)if(n.bindMatrix&&void 0!==y.bindMatrix&&k.uniformMatrix4fv(y.bindMatrix,!1,n.bindMatrix.elements),n.bindMatrixInverse&&void 0!==y.bindMatrixInverse&&k.uniformMatrix4fv(y.bindMatrixInverse,!1,n.bindMatrixInverse.elements),X.floatVertexTextures&&n.skeleton&&n.skeleton.useVertexTexture){if(void 0!==y.boneTexture){var _=_e();k.uniform1i(y.boneTexture,_),w.setTexture(n.skeleton.boneTexture,_)}void 0!==y.boneTextureWidth&&k.uniform1i(y.boneTextureWidth,n.skeleton.boneTextureWidth),void 0!==y.boneTextureHeight&&k.uniform1i(y.boneTextureHeight,n.skeleton.boneTextureHeight)}else n.skeleton&&n.skeleton.boneMatrices&&void 0!==y.boneGlobalMatrices&&k.uniformMatrix4fv(y.boneGlobalMatrices,!1,n.skeleton.boneMatrices);return m&&(r&&i.fog&&(u=r,(c=x).fogColor.value=u.color,u instanceof Gt.Fog?(c.fogNear.value=u.near,c.fogFar.value=u.far):u instanceof Gt.FogExp2&&(c.fogDensity.value=u.density)),(i instanceof Gt.MeshPhongMaterial||i instanceof Gt.MeshLambertMaterial||i.lights)&&(O&&(g=!0,function(e,t){var r,i,n,o,a,s,h,l,c=0,u=0,d=0,p=W,f=t.matrixWorldInverse,m=p.directional.colors,g=p.directional.positions,v=p.point.colors,y=p.point.positions,x=p.point.distances,_=p.point.decays,b=p.spot.colors,w=p.spot.positions,M=p.spot.distances,S=p.spot.directions,E=p.spot.anglesCos,T=p.spot.exponents,C=p.spot.decays,A=p.hemi.skyColors,L=p.hemi.groundColors,P=p.hemi.positions,k=0,R=0,D=0,F=0,V=0,U=0,B=0,O=0,N=0,G=0,I=0,z=0;for(r=0,i=e.length;r<i;r++)if(n=e[r],o=n.color,h=n.intensity,l=n.distance,n instanceof Gt.AmbientLight){if(!n.visible)continue;c+=o.r,u+=o.g,d+=o.b}else if(n instanceof Gt.DirectionalLight){if(V+=1,!n.visible)continue;j.setFromMatrixPosition(n.matrixWorld),H.setFromMatrixPosition(n.target.matrixWorld),j.sub(H),j.transformDirection(f),g[(N=3*k)+0]=j.x,g[N+1]=j.y,g[N+2]=j.z,be(m,N,o,h),k+=1}else if(n instanceof Gt.PointLight){if(U+=1,!n.visible)continue;be(v,G=3*R,o,h),H.setFromMatrixPosition(n.matrixWorld),H.applyMatrix4(f),y[G+0]=H.x,y[G+1]=H.y,y[G+2]=H.z,x[R]=l,_[R]=0===n.distance?0:n.decay,R+=1}else if(n instanceof Gt.SpotLight){if(B+=1,!n.visible)continue;be(b,I=3*D,o,h),j.setFromMatrixPosition(n.matrixWorld),H.copy(j).applyMatrix4(f),w[I+0]=H.x,w[I+1]=H.y,w[I+2]=H.z,M[D]=l,H.setFromMatrixPosition(n.target.matrixWorld),j.sub(H),j.transformDirection(f),S[I+0]=j.x,S[I+1]=j.y,S[I+2]=j.z,E[D]=Math.cos(n.angle),T[D]=n.exponent,C[D]=0===n.distance?0:n.decay,D+=1}else if(n instanceof Gt.HemisphereLight){if(O+=1,!n.visible)continue;j.setFromMatrixPosition(n.matrixWorld),j.transformDirection(f),P[(z=3*F)+0]=j.x,P[z+1]=j.y,P[z+2]=j.z,a=n.color,s=n.groundColor,be(A,z,a,h),be(L,z,s,h),F+=1}for(r=3*k,i=Math.max(m.length,3*V);r<i;r++)m[r]=0;for(r=3*R,i=Math.max(v.length,3*U);r<i;r++)v[r]=0;for(r=3*D,i=Math.max(b.length,3*B);r<i;r++)b[r]=0;for(r=3*F,i=Math.max(A.length,3*O);r<i;r++)A[r]=0;for(r=3*F,i=Math.max(L.length,3*O);r<i;r++)L[r]=0;p.directional.length=k,p.point.length=R,p.spot.length=D,p.hemi.length=F,p.ambient[0]=c,p.ambient[1]=u,p.ambient[2]=d}(t,e),O=!1),g?(l=W,(h=x).ambientLightColor.value=l.ambient,h.directionalLightColor.value=l.directional.colors,h.directionalLightDirection.value=l.directional.positions,h.pointLightColor.value=l.point.colors,h.pointLightPosition.value=l.point.positions,h.pointLightDistance.value=l.point.distances,h.pointLightDecay.value=l.point.decays,h.spotLightColor.value=l.spot.colors,h.spotLightPosition.value=l.spot.positions,h.spotLightDistance.value=l.spot.distances,h.spotLightDirection.value=l.spot.directions,h.spotLightAngleCos.value=l.spot.anglesCos,h.spotLightExponent.value=l.spot.exponents,h.spotLightDecay.value=l.spot.decays,h.hemisphereLightSkyColor.value=l.hemi.skyColors,h.hemisphereLightGroundColor.value=l.hemi.groundColors,h.hemisphereLightDirection.value=l.hemi.positions,xe(x,!0)):xe(x,!1)),(i instanceof Gt.MeshBasicMaterial||i instanceof Gt.MeshLambertMaterial||i instanceof Gt.MeshPhongMaterial)&&function(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,t.emissive&&(e.emissive.value=t.emissive);e.map.value=t.map,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var r;t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap);if(void 0!==r){r instanceof Gt.WebGLRenderTarget&&(r=r.texture);var i=r.offset,n=r.repeat;e.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof Gt.WebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}(x,i),i instanceof Gt.LineBasicMaterial?ye(x,i):i instanceof Gt.LineDashedMaterial?(ye(x,i),s=i,(a=x).dashSize.value=s.dashSize,a.totalSize.value=s.dashSize+s.gapSize,a.scale.value=s.scale):i instanceof Gt.PointsMaterial?function(e,t){if(e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=b.height/2,e.map.value=t.map,null!==t.map){var r=t.map.offset,i=t.map.repeat;e.offsetRepeat.value.set(r.x,r.y,i.x,i.y)}}(x,i):i instanceof Gt.MeshPhongMaterial?function(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,i):i instanceof Gt.MeshDepthMaterial?(x.mNear.value=e.near,x.mFar.value=e.far,x.opacity.value=i.opacity):i instanceof Gt.MeshNormalMaterial&&(x.opacity.value=i.opacity),n.receiveShadow&&!i._shadowPass&&function(e,t,r){if(e.shadowMatrix)for(var i=0,n=0,o=t.length;n<o;n++){var a=t[n];if(!0===a.castShadow&&(a instanceof Gt.PointLight||a instanceof Gt.SpotLight||a instanceof Gt.DirectionalLight)){var s=a.shadow;a instanceof Gt.PointLight?(H.setFromMatrixPosition(a.matrixWorld).negate(),s.matrix.identity().setPosition(H),e.shadowDarkness.value[i]=-s.darkness):e.shadowDarkness.value[i]=s.darkness,e.shadowMatrix.value[i]=s.matrix,e.shadowMap.value[i]=s.map,e.shadowMapSize.value[i]=s.mapSize,e.shadowBias.value[i]=s.bias,i++}}}(x,t),function(e){for(var t,r,i=0,n=e.length;i<n;i++){var o=e[i][0];if(!1!==o.needsUpdate){var a=o.type,s=o.value,h=e[i][1];switch(a){case"1i":k.uniform1i(h,s);break;case"1f":k.uniform1f(h,s);break;case"2f":k.uniform2f(h,s[0],s[1]);break;case"3f":k.uniform3f(h,s[0],s[1],s[2]);break;case"4f":k.uniform4f(h,s[0],s[1],s[2],s[3]);break;case"1iv":k.uniform1iv(h,s);break;case"3iv":k.uniform3iv(h,s);break;case"1fv":k.uniform1fv(h,s);break;case"2fv":k.uniform2fv(h,s);break;case"3fv":k.uniform3fv(h,s);break;case"4fv":k.uniform4fv(h,s);break;case"Matrix3fv":k.uniformMatrix3fv(h,!1,s);break;case"Matrix4fv":k.uniformMatrix4fv(h,!1,s);break;case"i":k.uniform1i(h,s);break;case"f":k.uniform1f(h,s);break;case"v2":k.uniform2f(h,s.x,s.y);break;case"v3":k.uniform3f(h,s.x,s.y,s.z);break;case"v4":k.uniform4f(h,s.x,s.y,s.z,s.w);break;case"c":k.uniform3f(h,s.r,s.g,s.b);break;case"iv1":k.uniform1iv(h,s);break;case"iv":k.uniform3iv(h,s);break;case"fv1":k.uniform1fv(h,s);break;case"fv":k.uniform3fv(h,s);break;case"v2v":void 0===o._array&&(o._array=new Float32Array(2*s.length));for(var l=0,c=0,u=s.length;l<u;l++,c+=2)o._array[c+0]=s[l].x,o._array[c+1]=s[l].y;k.uniform2fv(h,o._array);break;case"v3v":void 0===o._array&&(o._array=new Float32Array(3*s.length));for(var l=0,d=0,u=s.length;l<u;l++,d+=3)o._array[d+0]=s[l].x,o._array[d+1]=s[l].y,o._array[d+2]=s[l].z;k.uniform3fv(h,o._array);break;case"v4v":void 0===o._array&&(o._array=new Float32Array(4*s.length));for(var l=0,p=0,u=s.length;l<u;l++,p+=4)o._array[p+0]=s[l].x,o._array[p+1]=s[l].y,o._array[p+2]=s[l].z,o._array[p+3]=s[l].w;k.uniform4fv(h,o._array);break;case"m3":k.uniformMatrix3fv(h,!1,s.elements);break;case"m3v":void 0===o._array&&(o._array=new Float32Array(9*s.length));for(var l=0,u=s.length;l<u;l++)s[l].flattenToArrayOffset(o._array,9*l);k.uniformMatrix3fv(h,!1,o._array);break;case"m4":k.uniformMatrix4fv(h,!1,s.elements);break;case"m4v":void 0===o._array&&(o._array=new Float32Array(16*s.length));for(var l=0,u=s.length;l<u;l++)s[l].flattenToArrayOffset(o._array,16*l);k.uniformMatrix4fv(h,!1,o._array);break;case"t":if(t=s,r=_e(),k.uniform1i(h,r),!t)continue;t instanceof Gt.CubeTexture||Array.isArray(t.image)&&6===t.image.length?Te(t,r):t instanceof Gt.WebGLRenderTargetCube?Ce(t.texture,r):t instanceof Gt.WebGLRenderTarget?w.setTexture(t.texture,r):w.setTexture(t,r);break;case"tv":void 0===o._array&&(o._array=[]);for(var l=0,u=o.value.length;l<u;l++)o._array[l]=_e();k.uniform1iv(h,o._array);for(var l=0,u=o.value.length;l<u;l++)t=o.value[l],r=o._array[l],t&&(t instanceof Gt.CubeTexture||t.image instanceof Array&&6===t.image.length?Te(t,r):t instanceof Gt.WebGLRenderTarget?w.setTexture(t.texture,r):t instanceof Gt.WebGLRenderTargetCube?Ce(t.texture,r):w.setTexture(t,r));break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+a)}}}}(o.uniformsList)),d=y,p=n,k.uniformMatrix4fv(d.modelViewMatrix,!1,p.modelViewMatrix.elements),d.normalMatrix&&k.uniformMatrix3fv(d.normalMatrix,!1,p.normalMatrix.elements),void 0!==y.modelMatrix&&k.uniformMatrix4fv(y.modelMatrix,!1,n.matrixWorld.elements),v}function ye(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function xe(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.pointLightDecay.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.spotLightDecay.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function _e(){var e=T;return e>=X.maxTextures&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+X.maxTextures),T+=1,e}function be(e,t,r,i){e[t+0]=r.r*i,e[t+1]=r.g*i,e[t+2]=r.b*i}function we(e,t,r){var i;if(r?(k.texParameteri(e,k.TEXTURE_WRAP_S,ke(t.wrapS)),k.texParameteri(e,k.TEXTURE_WRAP_T,ke(t.wrapT)),k.texParameteri(e,k.TEXTURE_MAG_FILTER,ke(t.magFilter)),k.texParameteri(e,k.TEXTURE_MIN_FILTER,ke(t.minFilter))):(k.texParameteri(e,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(e,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),t.wrapS===Gt.ClampToEdgeWrapping&&t.wrapT===Gt.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",t),k.texParameteri(e,k.TEXTURE_MAG_FILTER,Pe(t.magFilter)),k.texParameteri(e,k.TEXTURE_MIN_FILTER,Pe(t.minFilter)),t.minFilter!==Gt.NearestFilter&&t.minFilter!==Gt.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",t)),i=z.get("EXT_texture_filter_anisotropic")){if(t.type===Gt.FloatType&&null===z.get("OES_texture_float_linear"))return;if(t.type===Gt.HalfFloatType&&null===z.get("OES_texture_half_float_linear"))return;(1<t.anisotropy||Y.get(t).__currentAnisotropy)&&(k.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,w.getMaxAnisotropy())),Y.get(t).__currentAnisotropy=t.anisotropy)}}function Me(e,t,r){var i;void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",se),e.__webglTexture=k.createTexture(),N.textures++),q.activeTexture(k.TEXTURE0+r),q.bindTexture(k.TEXTURE_2D,e.__webglTexture),k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,t.flipY),k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),k.pixelStorei(k.UNPACK_ALIGNMENT,t.unpackAlignment),t.image=Se(t.image,X.maxTextureSize),((i=t).wrapS!==Gt.ClampToEdgeWrapping||i.wrapT!==Gt.ClampToEdgeWrapping||i.minFilter!==Gt.NearestFilter&&i.minFilter!==Gt.LinearFilter)&&!1===Ee(t.image)&&(t.image=function(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var t=document.createElement("canvas");t.width=Gt.Math.nearestPowerOfTwo(e.width),t.height=Gt.Math.nearestPowerOfTwo(e.height);var r=t.getContext("2d");return r.drawImage(e,0,0,t.width,t.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e),t}return e}(t.image));var n=t.image,o=Ee(n),a=ke(t.format),s=ke(t.type);we(k.TEXTURE_2D,t,o);var h,l=t.mipmaps;if(t instanceof Gt.DataTexture)if(0<l.length&&o){for(var c=0,u=l.length;c<u;c++)h=l[c],q.texImage2D(k.TEXTURE_2D,c,a,h.width,h.height,0,a,s,h.data);t.generateMipmaps=!1}else q.texImage2D(k.TEXTURE_2D,0,a,n.width,n.height,0,a,s,n.data);else if(t instanceof Gt.CompressedTexture)for(c=0,u=l.length;c<u;c++)h=l[c],t.format!==Gt.RGBAFormat&&t.format!==Gt.RGBFormat?-1<q.getCompressedTextureFormats().indexOf(a)?q.compressedTexImage2D(k.TEXTURE_2D,c,a,h.width,h.height,0,h.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):q.texImage2D(k.TEXTURE_2D,c,a,h.width,h.height,0,a,s,h.data);else if(0<l.length&&o){for(c=0,u=l.length;c<u;c++)h=l[c],q.texImage2D(k.TEXTURE_2D,c,a,a,s,h);t.generateMipmaps=!1}else q.texImage2D(k.TEXTURE_2D,0,a,a,s,t.image);t.generateMipmaps&&o&&k.generateMipmap(k.TEXTURE_2D),e.__version=t.version,t.onUpdate&&t.onUpdate(t)}function Se(e,t){if(e.width>t||e.height>t){var r=t/Math.max(e.width,e.height),i=document.createElement("canvas");return i.width=Math.floor(e.width*r),i.height=Math.floor(e.height*r),i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height,e),i}return e}function Ee(e){return Gt.Math.isPowerOfTwo(e.width)&&Gt.Math.isPowerOfTwo(e.height)}function Te(e,t){var r=Y.get(e);if(6===e.image.length)if(0<e.version&&r.__version!==e.version){r.__image__webglTextureCube||(e.addEventListener("dispose",se),r.__image__webglTextureCube=k.createTexture(),N.textures++),q.activeTexture(k.TEXTURE0+t),q.bindTexture(k.TEXTURE_CUBE_MAP,r.__image__webglTextureCube),k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var i=e instanceof Gt.CompressedTexture,n=e.image[0]instanceof Gt.DataTexture,o=[],a=0;a<6;a++)!w.autoScaleCubemaps||i||n?o[a]=n?e.image[a].image:e.image[a]:o[a]=Se(e.image[a],X.maxCubemapSize);var s=Ee(o[0]),h=ke(e.format),l=ke(e.type);we(k.TEXTURE_CUBE_MAP,e,s);for(a=0;a<6;a++)if(i)for(var c,u=o[a].mipmaps,d=0,p=u.length;d<p;d++)c=u[d],e.format!==Gt.RGBAFormat&&e.format!==Gt.RGBFormat?-1<q.getCompressedTextureFormats().indexOf(h)?q.compressedTexImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+a,d,h,c.width,c.height,0,c.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):q.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+a,d,h,c.width,c.height,0,h,l,c.data);else n?q.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,h,o[a].width,o[a].height,0,h,l,o[a].data):q.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,h,h,l,o[a]);e.generateMipmaps&&s&&k.generateMipmap(k.TEXTURE_CUBE_MAP),r.__version=e.version,e.onUpdate&&e.onUpdate(e)}else q.activeTexture(k.TEXTURE0+t),q.bindTexture(k.TEXTURE_CUBE_MAP,r.__image__webglTextureCube)}function Ce(e,t){q.activeTexture(k.TEXTURE0+t),q.bindTexture(k.TEXTURE_CUBE_MAP,Y.get(e).__webglTexture)}function Ae(e,t,r){k.bindFramebuffer(k.FRAMEBUFFER,e),k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,r,Y.get(t.texture).__webglTexture,0)}function Le(e,t){k.bindRenderbuffer(k.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(k.renderbufferStorage(k.RENDERBUFFER,k.DEPTH_COMPONENT16,t.width,t.height),k.framebufferRenderbuffer(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,k.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(k.renderbufferStorage(k.RENDERBUFFER,k.DEPTH_STENCIL,t.width,t.height),k.framebufferRenderbuffer(k.FRAMEBUFFER,k.DEPTH_STENCIL_ATTACHMENT,k.RENDERBUFFER,e)):k.renderbufferStorage(k.RENDERBUFFER,k.RGBA4,t.width,t.height)}function Pe(e){return e===Gt.NearestFilter||e===Gt.NearestMipMapNearestFilter||e===Gt.NearestMipMapLinearFilter?k.NEAREST:k.LINEAR}function ke(e){var t;if(e===Gt.RepeatWrapping)return k.REPEAT;if(e===Gt.ClampToEdgeWrapping)return k.CLAMP_TO_EDGE;if(e===Gt.MirroredRepeatWrapping)return k.MIRRORED_REPEAT;if(e===Gt.NearestFilter)return k.NEAREST;if(e===Gt.NearestMipMapNearestFilter)return k.NEAREST_MIPMAP_NEAREST;if(e===Gt.NearestMipMapLinearFilter)return k.NEAREST_MIPMAP_LINEAR;if(e===Gt.LinearFilter)return k.LINEAR;if(e===Gt.LinearMipMapNearestFilter)return k.LINEAR_MIPMAP_NEAREST;if(e===Gt.LinearMipMapLinearFilter)return k.LINEAR_MIPMAP_LINEAR;if(e===Gt.UnsignedByteType)return k.UNSIGNED_BYTE;if(e===Gt.UnsignedShort4444Type)return k.UNSIGNED_SHORT_4_4_4_4;if(e===Gt.UnsignedShort5551Type)return k.UNSIGNED_SHORT_5_5_5_1;if(e===Gt.UnsignedShort565Type)return k.UNSIGNED_SHORT_5_6_5;if(e===Gt.ByteType)return k.BYTE;if(e===Gt.ShortType)return k.SHORT;if(e===Gt.UnsignedShortType)return k.UNSIGNED_SHORT;if(e===Gt.IntType)return k.INT;if(e===Gt.UnsignedIntType)return k.UNSIGNED_INT;if(e===Gt.FloatType)return k.FLOAT;if(null!==(t=z.get("OES_texture_half_float"))&&e===Gt.HalfFloatType)return t.HALF_FLOAT_OES;if(e===Gt.AlphaFormat)return k.ALPHA;if(e===Gt.RGBFormat)return k.RGB;if(e===Gt.RGBAFormat)return k.RGBA;if(e===Gt.LuminanceFormat)return k.LUMINANCE;if(e===Gt.LuminanceAlphaFormat)return k.LUMINANCE_ALPHA;if(e===Gt.AddEquation)return k.FUNC_ADD;if(e===Gt.SubtractEquation)return k.FUNC_SUBTRACT;if(e===Gt.ReverseSubtractEquation)return k.FUNC_REVERSE_SUBTRACT;if(e===Gt.ZeroFactor)return k.ZERO;if(e===Gt.OneFactor)return k.ONE;if(e===Gt.SrcColorFactor)return k.SRC_COLOR;if(e===Gt.OneMinusSrcColorFactor)return k.ONE_MINUS_SRC_COLOR;if(e===Gt.SrcAlphaFactor)return k.SRC_ALPHA;if(e===Gt.OneMinusSrcAlphaFactor)return k.ONE_MINUS_SRC_ALPHA;if(e===Gt.DstAlphaFactor)return k.DST_ALPHA;if(e===Gt.OneMinusDstAlphaFactor)return k.ONE_MINUS_DST_ALPHA;if(e===Gt.DstColorFactor)return k.DST_COLOR;if(e===Gt.OneMinusDstColorFactor)return k.ONE_MINUS_DST_COLOR;if(e===Gt.SrcAlphaSaturateFactor)return k.SRC_ALPHA_SATURATE;if(null!==(t=z.get("WEBGL_compressed_texture_s3tc"))){if(e===Gt.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Gt.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Gt.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Gt.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=z.get("WEBGL_compressed_texture_pvrtc"))){if(e===Gt.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Gt.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Gt.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Gt.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=z.get("EXT_blend_minmax"))){if(e===Gt.MinEquation)return t.MIN_EXT;if(e===Gt.MaxEquation)return t.MAX_EXT}return 0}this.getContext=function(){return k},this.getContextAttributes=function(){return k.getContextAttributes()},this.forceContextLoss=function(){z.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){if(void 0!==ie)return ie;var e=z.get("EXT_texture_filter_anisotropic");return ie=null!==e?k.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},this.getPrecision=function(){return X.precision},this.getPixelRatio=function(){return L},this.setPixelRatio=function(e){void 0!==e&&(L=e)},this.getSize=function(){return{width:i,height:n}},this.setSize=function(e,t,r){i=e,n=t,b.width=e*L,b.height=t*L,!1!==r&&(b.style.width=e+"px",b.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,i){_=e*L,C=t*L,A=r*L,D=i*L,k.viewport(_,C,A,D)},this.getViewport=function(e){e.x=_/L,e.y=C/L,e.z=A/L,e.w=D/L},this.setScissor=function(e,t,r,i){k.scissor(e*L,t*L,r*L,i*L)},this.enableScissorTest=function(e){q.setScissorTest(e)},this.getClearColor=function(){return c},this.setClearColor=function(e,t){c.set(e),u=void 0!==t?t:1,$(c.r,c.g,c.b,u)},this.getClearAlpha=function(){return u},this.setClearAlpha=function(e){u=e,$(c.r,c.g,c.b,u)},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=k.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=k.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=k.STENCIL_BUFFER_BIT),k.clear(i)},this.clearColor=function(){k.clear(k.COLOR_BUFFER_BIT)},this.clearDepth=function(){k.clear(k.DEPTH_BUFFER_BIT)},this.clearStencil=function(){k.clear(k.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,r,i){this.setRenderTarget(e),this.clear(t,r,i)},this.resetGLState=te,this.dispose=function(){b.removeEventListener("webglcontextlost",ae,!1)},this.renderBufferImmediate=function(e,t,r){q.initAttributes();var i=Y.get(e);e.hasPositions&&!i.position&&(i.position=k.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=k.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=k.createBuffer()),e.hasColors&&!i.color&&(i.color=k.createBuffer());var n=t.getAttributes();if(e.hasPositions&&(k.bindBuffer(k.ARRAY_BUFFER,i.position),k.bufferData(k.ARRAY_BUFFER,e.positionArray,k.DYNAMIC_DRAW),q.enableAttribute(n.position),k.vertexAttribPointer(n.position,3,k.FLOAT,!1,0,0)),e.hasNormals){if(k.bindBuffer(k.ARRAY_BUFFER,i.normal),"MeshPhongMaterial"!==r.type&&r.shading===Gt.FlatShading)for(var o=0,a=3*e.count;o<a;o+=9){var s=e.normalArray,h=(s[o+0]+s[o+3]+s[o+6])/3,l=(s[o+1]+s[o+4]+s[o+7])/3,c=(s[o+2]+s[o+5]+s[o+8])/3;s[o+0]=h,s[o+1]=l,s[o+2]=c,s[o+3]=h,s[o+4]=l,s[o+5]=c,s[o+6]=h,s[o+7]=l,s[o+8]=c}k.bufferData(k.ARRAY_BUFFER,e.normalArray,k.DYNAMIC_DRAW),q.enableAttribute(n.normal),k.vertexAttribPointer(n.normal,3,k.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(k.bindBuffer(k.ARRAY_BUFFER,i.uv),k.bufferData(k.ARRAY_BUFFER,e.uvArray,k.DYNAMIC_DRAW),q.enableAttribute(n.uv),k.vertexAttribPointer(n.uv,2,k.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==Gt.NoColors&&(k.bindBuffer(k.ARRAY_BUFFER,i.color),k.bufferData(k.ARRAY_BUFFER,e.colorArray,k.DYNAMIC_DRAW),q.enableAttribute(n.color),k.vertexAttribPointer(n.color,3,k.FLOAT,!1,0,0)),q.disableUnusedAttributes(),k.drawArrays(k.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,i,n,o,a){ge(n);var s=ve(e,t,r,n,o),h=!1,l=i.id+"_"+s.id+"_"+n.wireframe;l!==R&&(R=l,h=!0);var c=o.morphTargetInfluences;if(void 0!==c){for(var u=[],d=0,p=c.length;d<p;d++){var f=c[d];u.push([f,d])}u.sort(ue),8<u.length&&(u.length=8);var m=i.morphAttributes;for(d=0,p=u.length;d<p;d++){f=u[d];if(P[d]=f[0],0!==f[0]){var g=f[1];!0===n.morphTargets&&m.position&&i.addAttribute("morphTarget"+d,m.position[g]),!0===n.morphNormals&&m.normal&&i.addAttribute("morphNormal"+d,m.normal[g])}else!0===n.morphTargets&&i.removeAttribute("morphTarget"+d),!0===n.morphNormals&&i.removeAttribute("morphNormal"+d)}var v=s.getUniforms();null!==v.morphTargetInfluences&&k.uniform1fv(v.morphTargetInfluences,P),h=!0}g=i.index;var y,x=i.attributes.position;!0===n.wireframe&&(g=K.getWireframeAttribute(i)),null!==g?(y=J).setIndex(g):y=Z,h&&(!function(e,t,r,i){var n;if(r instanceof Gt.InstancedBufferGeometry&&null===(n=z.get("ANGLE_instanced_arrays")))return console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===i&&(i=0);q.initAttributes();var o=r.attributes,a=t.getAttributes(),s=e.defaultAttributeValues;for(var h in a){var l=a[h];if(0<=l){var c=o[h];if(void 0!==c){var u=c.itemSize,d=K.getAttributeBuffer(c);if(c instanceof Gt.InterleavedBufferAttribute){var p=c.data,f=p.stride,m=c.offset;p instanceof Gt.InstancedInterleavedBuffer?(q.enableAttributeAndDivisor(l,p.meshPerAttribute,n),void 0===r.maxInstancedCount&&(r.maxInstancedCount=p.meshPerAttribute*p.count)):q.enableAttribute(l),k.bindBuffer(k.ARRAY_BUFFER,d),k.vertexAttribPointer(l,u,k.FLOAT,!1,f*p.array.BYTES_PER_ELEMENT,(i*f+m)*p.array.BYTES_PER_ELEMENT)}else c instanceof Gt.InstancedBufferAttribute?(q.enableAttributeAndDivisor(l,c.meshPerAttribute,n),void 0===r.maxInstancedCount&&(r.maxInstancedCount=c.meshPerAttribute*c.count)):q.enableAttribute(l),k.bindBuffer(k.ARRAY_BUFFER,d),k.vertexAttribPointer(l,u,k.FLOAT,!1,0,i*u*4)}else if(void 0!==s){var g=s[h];if(void 0!==g)switch(g.length){case 2:k.vertexAttrib2fv(l,g);break;case 3:k.vertexAttrib3fv(l,g);break;case 4:k.vertexAttrib4fv(l,g);break;default:k.vertexAttrib1fv(l,g)}}}}q.disableUnusedAttributes()}(n,s,i),null!==g&&k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,K.getAttributeBuffer(g)));var _=1/0;null!==g?_=g.count:void 0!==x&&(_=x.count);var b=i.drawRange.start,w=i.drawRange.count,M=null!==a?a.start:0,S=null!==a?a.count:1/0,E=Math.max(0,b,M),T=Math.min(0+_,b+w,M+S)-1,C=Math.max(0,T-E+1);if(o instanceof Gt.Mesh)!0===n.wireframe?(q.setLineWidth(n.wireframeLinewidth*L),y.setMode(k.LINES)):y.setMode(k.TRIANGLES),i instanceof Gt.InstancedBufferGeometry&&0<i.maxInstancedCount?y.renderInstances(i):y.render(E,C);else if(o instanceof Gt.Line){var A=n.linewidth;void 0===A&&(A=1),q.setLineWidth(A*L),o instanceof Gt.LineSegments?y.setMode(k.LINES):y.setMode(k.LINE_STRIP),y.render(E,C)}else o instanceof Gt.Points&&(y.setMode(k.POINTS),y.render(E,C))},this.render=function(e,t,r,i){if(t instanceof Gt.Camera!=!1){var n,o,a,s=e.fog;if(R="",S=-1,(O=!(E=null))===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromMatrix(B),d.length=0,g=f=-1,v.length=0,y.length=0,function e(t,r){if(!1===t.visible)return;if(0!=(t.channels.mask&r.channels.mask))if(t instanceof Gt.Light)d.push(t);else if(t instanceof Gt.Sprite)v.push(t);else if(t instanceof Gt.LensFlare)y.push(t);else if(t instanceof Gt.ImmediateRenderObject)!0===w.sortObjects&&(H.setFromMatrixPosition(t.matrixWorld),H.applyProjection(B)),fe(t,null,t.material,H.z,null);else if((t instanceof Gt.Mesh||t instanceof Gt.Line||t instanceof Gt.Points)&&(t instanceof Gt.SkinnedMesh&&t.skeleton.update(),!1===t.frustumCulled||!0===U.intersectsObject(t))){var i=t.material;if(!0===i.visible){!0===w.sortObjects&&(H.setFromMatrixPosition(t.matrixWorld),H.applyProjection(B));var n=K.update(t);if(i instanceof Gt.MeshFaceMaterial)for(var o=n.groups,a=i.materials,s=0,h=o.length;s<h;s++){var l=o[s],c=a[l.materialIndex];!0===c.visible&&fe(t,n,c,H.z,l)}else fe(t,n,i,H.z,null)}}var u=t.children;for(var s=0,h=u.length;s<h;s++)e(u[s],r)}(e,t),p.length=f+1,m.length=g+1,!0===w.sortObjects&&(p.sort(de),m.sort(pe)),re.render(e),G.calls=0,G.vertices=0,G.faces=0,G.points=0,this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),e.overrideMaterial){var h=e.overrideMaterial;me(p,t,d,s,h),me(m,t,d,s,h)}else q.setBlending(Gt.NoBlending),me(p,t,d,s),me(m,t,d,s);if(ne.render(e,t),oe.render(e,t,F,V),r){var l=r.texture,c=Ee(r);l.generateMipmaps&&c&&l.minFilter!==Gt.NearestFilter&&l.minFilter!==Gt.LinearFilter&&(o=(n=r)instanceof Gt.WebGLRenderTargetCube?k.TEXTURE_CUBE_MAP:k.TEXTURE_2D,a=Y.get(n.texture).__webglTexture,q.bindTexture(o,a),k.generateMipmap(o),q.bindTexture(o,null))}q.setDepthTest(!0),q.setDepthWrite(!0),q.setColorWrite(!0)}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFaceCulling=function(e,t){e===Gt.CullFaceNone?q.disable(k.CULL_FACE):(t===Gt.FrontFaceDirectionCW?k.frontFace(k.CW):k.frontFace(k.CCW),e===Gt.CullFaceBack?k.cullFace(k.BACK):e===Gt.CullFaceFront?k.cullFace(k.FRONT):k.cullFace(k.FRONT_AND_BACK),q.enable(k.CULL_FACE))},this.setTexture=function(e,t){var r=Y.get(e);if(0<e.version&&r.__version!==e.version){var i=e.image;return void 0===i?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e):!1===i.complete?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e):void Me(r,e,t)}q.activeTexture(k.TEXTURE0+t),q.bindTexture(k.TEXTURE_2D,r.__webglTexture)},this.setRenderTarget=function(e){var t,r,i,n,o,a=e instanceof Gt.WebGLRenderTargetCube;if(e&&void 0===Y.get(e).__webglFramebuffer){var s=Y.get(e),h=Y.get(e.texture);void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",he),h.__webglTexture=k.createTexture(),N.textures++;var l=Ee(e),c=ke(e.texture.format),u=ke(e.texture.type);if(a){s.__webglFramebuffer=[],s.__webglRenderbuffer=[],q.bindTexture(k.TEXTURE_CUBE_MAP,h.__webglTexture),we(k.TEXTURE_CUBE_MAP,e.texture,l);for(var d=0;d<6;d++)s.__webglFramebuffer[d]=k.createFramebuffer(),s.__webglRenderbuffer[d]=k.createRenderbuffer(),q.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,c,e.width,e.height,0,c,u,null),Ae(s.__webglFramebuffer[d],e,k.TEXTURE_CUBE_MAP_POSITIVE_X+d),Le(s.__webglRenderbuffer[d],e);e.texture.generateMipmaps&&l&&k.generateMipmap(k.TEXTURE_CUBE_MAP)}else s.__webglFramebuffer=k.createFramebuffer(),e.shareDepthFrom?s.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:s.__webglRenderbuffer=k.createRenderbuffer(),q.bindTexture(k.TEXTURE_2D,h.__webglTexture),we(k.TEXTURE_2D,e.texture,l),q.texImage2D(k.TEXTURE_2D,0,c,e.width,e.height,0,c,u,null),Ae(s.__webglFramebuffer,e,k.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?k.framebufferRenderbuffer(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,k.RENDERBUFFER,s.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&k.framebufferRenderbuffer(k.FRAMEBUFFER,k.DEPTH_STENCIL_ATTACHMENT,k.RENDERBUFFER,s.__webglRenderbuffer):Le(s.__webglRenderbuffer,e),e.texture.generateMipmaps&&l&&k.generateMipmap(k.TEXTURE_2D);a?q.bindTexture(k.TEXTURE_CUBE_MAP,null):q.bindTexture(k.TEXTURE_2D,null),k.bindRenderbuffer(k.RENDERBUFFER,null),k.bindFramebuffer(k.FRAMEBUFFER,null)}if(e){s=Y.get(e);t=a?s.__webglFramebuffer[e.activeCubeFace]:s.__webglFramebuffer,r=e.width,i=e.height,o=n=0}else t=null,r=A,i=D,n=_,o=C;if(t!==x&&(k.bindFramebuffer(k.FRAMEBUFFER,t),k.viewport(n,o,r,i),x=t),a){h=Y.get(e.texture);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,h.__webglTexture,0)}F=r,V=i},this.readRenderTargetPixels=function(e,t,r,i,n,o){if(e instanceof Gt.WebGLRenderTarget!=!1){var a=Y.get(e).__webglFramebuffer;if(a){var s=!1;a!==x&&(k.bindFramebuffer(k.FRAMEBUFFER,a),s=!0);try{var h=e.texture;if(h.format!==Gt.RGBAFormat&&ke(h.format)!==k.getParameter(k.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h.type===Gt.UnsignedByteType||ke(h.type)===k.getParameter(k.IMPLEMENTATION_COLOR_READ_TYPE)||h.type===Gt.FloatType&&z.get("WEBGL_color_buffer_float")||h.type===Gt.HalfFloatType&&z.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");k.checkFramebufferStatus(k.FRAMEBUFFER)===k.FRAMEBUFFER_COMPLETE?k.readPixels(t,r,i,n,ke(h.format),ke(h.type),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&k.bindFramebuffer(k.FRAMEBUFFER,x)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),z.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),z.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),z.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),z.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),z.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),z.get("EXT_blend_minmax")},this.supportsVertexTextures=function(){return X.vertexTextures},this.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),z.get("ANGLE_instanced_arrays")},this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Object.defineProperties(this,{shadowMapEnabled:{get:function(){return re.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),re.enabled=e}},shadowMapType:{get:function(){return re.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),re.type=e}},shadowMapCullFace:{get:function(){return re.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),re.cullFace=e}},shadowMapDebug:{get:function(){return re.debug},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapDebug is now .shadowMap.debug."),re.debug=e}}})},Gt.WebGLRenderTarget=function(e,t,r){this.uuid=Gt.Math.generateUUID(),this.width=e,this.height=t,void 0===(r=r||{}).minFilter&&(r.minFilter=Gt.LinearFilter),this.texture=new Gt.Texture(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy),this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.shareDepthFrom=void 0!==r.shareDepthFrom?r.shareDepthFrom:null},Gt.WebGLRenderTarget.prototype={constructor:Gt.WebGLRenderTarget,get wrapS(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set wrapS(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e},get wrapT(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set wrapT(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e},get magFilter(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set magFilter(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e},get minFilter(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set minFilter(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e},get anisotropy(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set anisotropy(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e},get offset(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set offset(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e},get repeat(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set repeat(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e},get format(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set format(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e},get type(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set type(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e},get generateMipmaps(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set generateMipmaps(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e},setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose())},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.shareDepthFrom=e.shareDepthFrom,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},Gt.EventDispatcher.prototype.apply(Gt.WebGLRenderTarget.prototype),Gt.WebGLRenderTargetCube=function(e,t,r){Gt.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},Gt.WebGLRenderTargetCube.prototype=Object.create(Gt.WebGLRenderTarget.prototype),Gt.WebGLRenderTargetCube.prototype.constructor=Gt.WebGLRenderTargetCube,Gt.WebGLBufferRenderer=function(r,i,n){var o;this.setMode=function(e){o=e},this.render=function(e,t){r.drawArrays(o,e,t),n.calls++,n.vertices+=t,o===r.TRIANGLES&&(n.faces+=t/3)},this.renderInstances=function(e){var t=i.get("ANGLE_instanced_arrays");if(null!==t){var r=e.attributes.position;r instanceof Gt.InterleavedBufferAttribute?t.drawArraysInstancedANGLE(o,0,r.data.count,e.maxInstancedCount):t.drawArraysInstancedANGLE(o,0,r.count,e.maxInstancedCount)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}},Gt.WebGLIndexedBufferRenderer=function(r,i,n){var o,a,s;this.setMode=function(e){o=e},this.setIndex=function(e){e.array instanceof Uint32Array&&i.get("OES_element_index_uint")?(a=r.UNSIGNED_INT,s=4):(a=r.UNSIGNED_SHORT,s=2)},this.render=function(e,t){r.drawElements(o,t,a,e*s),n.calls++,n.vertices+=t,o===r.TRIANGLES&&(n.faces+=t/3)},this.renderInstances=function(e){var t=i.get("ANGLE_instanced_arrays");if(null!==t){var r=e.index;t.drawElementsInstancedANGLE(o,r.array.length,a,0,e.maxInstancedCount)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}},Gt.WebGLExtensions=function(r){var i={};this.get=function(e){if(void 0!==i[e])return i[e];var t;switch(e){case"EXT_texture_filter_anisotropic":t=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=r.getExtension(e)}return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),i[e]=t}},Gt.WebGLCapabilities=function(t,e,r){function i(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision&&0<t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision&&0<t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision?"mediump":"lowp"}this.getMaxPrecision=i,this.precision=void 0!==r.precision?r.precision:"highp",this.logarithmicDepthBuffer=void 0!==r.logarithmicDepthBuffer&&r.logarithmicDepthBuffer,this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxCubemapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=t.getParameter(t.MAX_VARYING_VECTORS),this.maxFragmentUniforms=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=0<this.maxVertexTextures,this.floatFragmentTextures=!!e.get("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var n=i(this.precision);n!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",n,"instead."),this.precision=n),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!e.get("EXT_frag_depth"))},Gt.WebGLGeometries=function(n,o,i){var a={};function s(e){var t=e.target;!function(e){for(var t in e)h(e[t])}(a[t.id].attributes),t.removeEventListener("dispose",s),delete a[t.id];var r=o.get(t);r.wireframe&&h(r.wireframe),i.memory.geometries--}function h(e){var t,r,i=(t=e)instanceof Gt.InterleavedBufferAttribute?o.get(t.data).__webglBuffer:o.get(t).__webglBuffer;void 0!==i&&(n.deleteBuffer(i),(r=e)instanceof Gt.InterleavedBufferAttribute?o.delete(r.data):o.delete(r))}this.get=function(e){var t,r=e.geometry;return void 0!==a[r.id]?a[r.id]:(r.addEventListener("dispose",s),r instanceof Gt.BufferGeometry?t=r:r instanceof Gt.Geometry&&(void 0===r._bufferGeometry&&(r._bufferGeometry=(new Gt.BufferGeometry).setFromObject(e)),t=r._bufferGeometry),a[r.id]=t,i.memory.geometries++,t)}},Gt.WebGLObjects=function(m,g,e){var l=new Gt.WebGLGeometries(m,g,e);function v(e,t){var r=e instanceof Gt.InterleavedBufferAttribute?e.data:e,i=g.get(r);void 0===i.__webglBuffer?function(e,t,r){e.__webglBuffer=m.createBuffer(),m.bindBuffer(r,e.__webglBuffer);var i=t.dynamic?m.DYNAMIC_DRAW:m.STATIC_DRAW;m.bufferData(r,t.array,i),e.version=t.version}(i,r,t):i.version!==r.version&&function(e,t,r){m.bindBuffer(r,e.__webglBuffer),!1===t.dynamic||-1===t.updateRange.count?m.bufferSubData(r,0,t.array):0===t.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(m.bufferSubData(r,t.updateRange.offset*t.array.BYTES_PER_ELEMENT,t.array.subarray(t.updateRange.offset,t.updateRange.offset+t.updateRange.count)),t.updateRange.count=0);e.version=t.version}(i,r,t)}function y(e,t,r){if(r<t){var i=t;t=r,r=i}var n=e[t];return void 0===n?(e[t]=[r],!0):-1===n.indexOf(r)&&(n.push(r),!0)}this.getAttributeBuffer=function(e){return e instanceof Gt.InterleavedBufferAttribute?g.get(e.data).__webglBuffer:g.get(e).__webglBuffer},this.getWireframeAttribute=function(e){var t=g.get(e);if(void 0!==t.wireframe)return t.wireframe;var r,i=[],n=e.index,o=e.attributes,a=o.position;if(null!==n)for(var s={},h=0,l=(r=n.array).length;h<l;h+=3){var c=r[h+0],u=r[h+1],d=r[h+2];y(s,c,u)&&i.push(c,u),y(s,u,d)&&i.push(u,d),y(s,d,c)&&i.push(d,c)}else for(h=0,l=(r=o.position.array).length/3-1;h<l;h+=3)c=h+0,u=h+1,d=h+2,i.push(c,u,u,d,d,c);var p=65535<a.count?Uint32Array:Uint16Array,f=new Gt.BufferAttribute(new p(i),1);return v(f,m.ELEMENT_ARRAY_BUFFER),t.wireframe=f},this.update=function(e){var t=l.get(e);e.geometry instanceof Gt.Geometry&&t.updateFromObject(e);var r=t.index,i=t.attributes;for(var n in null!==r&&v(r,m.ELEMENT_ARRAY_BUFFER),i)v(i[n],m.ARRAY_BUFFER);var o=t.morphAttributes;for(var n in o)for(var a=o[n],s=0,h=a.length;s<h;s++)v(a[s],m.ARRAY_BUFFER);return t}},Gt.WebGLProgram=function(){var A=0;function L(e){return""!==e}return function(e,t,r,i){var n=e.context,o=r.defines,a=r.__webglShader.vertexShader,s=r.__webglShader.fragmentShader,h="SHADOWMAP_TYPE_BASIC";i.shadowMapType===Gt.PCFShadowMap?h="SHADOWMAP_TYPE_PCF":i.shadowMapType===Gt.PCFSoftShadowMap&&(h="SHADOWMAP_TYPE_PCF_SOFT");var l="ENVMAP_TYPE_CUBE",c="ENVMAP_MODE_REFLECTION",u="ENVMAP_BLENDING_MULTIPLY";if(i.envMap){switch(r.envMap.mapping){case Gt.CubeReflectionMapping:case Gt.CubeRefractionMapping:l="ENVMAP_TYPE_CUBE";break;case Gt.EquirectangularReflectionMapping:case Gt.EquirectangularRefractionMapping:l="ENVMAP_TYPE_EQUIREC";break;case Gt.SphericalReflectionMapping:l="ENVMAP_TYPE_SPHERE"}switch(r.envMap.mapping){case Gt.CubeRefractionMapping:case Gt.EquirectangularRefractionMapping:c="ENVMAP_MODE_REFRACTION"}switch(r.combine){case Gt.MultiplyOperation:u="ENVMAP_BLENDING_MULTIPLY";break;case Gt.MixOperation:u="ENVMAP_BLENDING_MIX";break;case Gt.AddOperation:u="ENVMAP_BLENDING_ADD"}}var d,p,f=0<e.gammaFactor?e.gammaFactor:1,m=function(e){var t=[];for(var r in e){var i=e[r];!1!==i&&t.push("#define "+r+" "+i)}return t.join("\n")}(o),g=n.createProgram();r instanceof Gt.RawShaderMaterial?p=d="":(d=["precision "+i.precision+" float;","precision "+i.precision+" int;","#define SHADER_NAME "+r.__webglShader.name,m,i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",e.gammaInput?"#define GAMMA_INPUT":"",e.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+f,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexColors?"#define USE_COLOR":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",0<i.pointLightShadows?"#define POINT_LIGHT_SHADOWS":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&e.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(L).join("\n"),p=[i.bumpMap||i.normalMap||i.flatShading||r.derivatives?"#extension GL_OES_standard_derivatives : enable":"",i.logarithmicDepthBuffer&&e.extensions.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"","precision "+i.precision+" float;","precision "+i.precision+" int;","#define SHADER_NAME "+r.__webglShader.name,m,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",e.gammaInput?"#define GAMMA_INPUT":"",e.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+l:"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexColors?"#define USE_COLOR":"",i.flatShading?"#define FLAT_SHADED":"",i.metal?"#define METAL":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",0<i.pointLightShadows?"#define POINT_LIGHT_SHADOWS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&e.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","\n"].filter(L).join("\n"));var v=d+a,y=p+s,x=Gt.WebGLShader(n,n.VERTEX_SHADER,v),_=Gt.WebGLShader(n,n.FRAGMENT_SHADER,y);n.attachShader(g,x),n.attachShader(g,_),void 0!==r.index0AttributeName?n.bindAttribLocation(g,0,r.index0AttributeName):!0===i.morphTargets&&n.bindAttribLocation(g,0,"position"),n.linkProgram(g);var b,w,M=n.getProgramInfoLog(g),S=n.getShaderInfoLog(x),E=n.getShaderInfoLog(_),T=!0,C=!0;return!1===n.getProgramParameter(g,n.LINK_STATUS)?(T=!1,console.error("THREE.WebGLProgram: shader error: ",n.getError(),"gl.VALIDATE_STATUS",n.getProgramParameter(g,n.VALIDATE_STATUS),"gl.getProgramInfoLog",M,S,E)):""!==M?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",M):""!==S&&""!==E||(C=!1),C&&(this.diagnostics={runnable:T,material:r,programLog:M,vertexShader:{log:S,prefix:d},fragmentShader:{log:E,prefix:p}}),n.deleteShader(x),n.deleteShader(_),this.getUniforms=function(){return void 0===b&&(b=function(e,t,r){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),o=0;o<n;o++){var a=e.getActiveUniform(t,o).name,s=e.getUniformLocation(t,a),h=a.lastIndexOf("[0]");-1!==h&&h===a.length-3&&(i[a.substr(0,h)]=s),i[a]=s}return i}(n,g)),b},this.getAttributes=function(){return void 0===w&&(w=function(e,t,r){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<n;o++){var a=e.getActiveAttrib(t,o).name;i[a]=e.getAttribLocation(t,a)}return i}(n,g)),w},this.destroy=function(){n.deleteProgram(g),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=A++,this.code=t,this.usedTimes=1,this.program=g,this.vertexShader=x,this.fragmentShader=_,this}}(),Gt.WebGLPrograms=function(l,c){var s=[],u={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},a=["precision","supportsVertexTextures","map","envMap","envMapMode","lightMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","specularMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","maxDirLights","maxPointLights","maxSpotLights","maxHemiLights","maxShadows","shadowMapEnabled","pointLightShadows","shadowMapType","shadowMapDebug","alphaTest","metal","doubleSided","flipSided"];this.getParameters=function(e,t,r,i){var n=u[e.type],o=function(e){for(var t=0,r=0,i=0,n=0,o=0,a=e.length;o<a;o++){var s=e[o];!1!==s.visible&&(s instanceof Gt.DirectionalLight&&t++,s instanceof Gt.PointLight&&r++,s instanceof Gt.SpotLight&&i++,s instanceof Gt.HemisphereLight&&n++)}return{directional:t,point:r,spot:i,hemi:n}}(t),a=function(e){for(var t=0,r=0,i=0,n=e.length;i<n;i++){var o=e[i];o.castShadow&&((o instanceof Gt.SpotLight||o instanceof Gt.DirectionalLight)&&t++,o instanceof Gt.PointLight&&(t++,r++))}return{maxShadows:t,pointLightShadows:r}}(t),s=function(e){if(c.floatVertexTextures&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var t=c.maxVertexUniforms,r=Math.floor((t-20)/4);return void 0!==e&&e instanceof Gt.SkinnedMesh&&(r=Math.min(e.skeleton.bones.length,r))<e.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)"),r}(i),h=l.getPrecision();return null!==e.precision&&(h=c.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLRenderer.initMaterial:",e.precision,"not supported, using",h,"instead."),{shaderID:n,precision:h,supportsVertexTextures:c.vertexTextures,map:!!e.map,envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,displacementMap:!!e.displacementMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:r,useFog:e.fog,fogExp:r instanceof Gt.FogExp2,flatShading:e.shading===Gt.FlatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:c.logarithmicDepthBuffer,skinning:e.skinning,maxBones:s,useVertexTexture:c.floatVertexTextures&&i&&i.skeleton&&i.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:l.maxMorphTargets,maxMorphNormals:l.maxMorphNormals,maxDirLights:o.directional,maxPointLights:o.point,maxSpotLights:o.spot,maxHemiLights:o.hemi,maxShadows:a.maxShadows,pointLightShadows:a.pointLightShadows,shadowMapEnabled:l.shadowMap.enabled&&i.receiveShadow&&0<a.maxShadows,shadowMapType:l.shadowMap.type,shadowMapDebug:l.shadowMap.debug,alphaTest:e.alphaTest,metal:e.metal,doubleSided:e.side===Gt.DoubleSide,flipSided:e.side===Gt.BackSide}},this.getProgramCode=function(e,t){var r=[];if(t.shaderID?r.push(t.shaderID):(r.push(e.fragmentShader),r.push(e.vertexShader)),void 0!==e.defines)for(var i in e.defines)r.push(i),r.push(e.defines[i]);for(var n=0;n<a.length;n++){var o=a[n];r.push(o),r.push(t[o])}return r.join()},this.acquireProgram=function(e,t,r){for(var i,n=0,o=s.length;n<o;n++){var a=s[n];if(a.code===r){++(i=a).usedTimes;break}}return void 0===i&&(i=new Gt.WebGLProgram(l,r,e,t),s.push(i)),i},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},this.programs=s},Gt.WebGLProperties=function(){var i={};this.get=function(e){var t=e.uuid,r=i[t];return void 0===r&&(r={},i[t]=r),r},this.delete=function(e){delete i[e.uuid]},this.clear=function(){i={}}},Gt.WebGLShader=function(e,t,r){var i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),!1===e.getShaderParameter(i,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(i)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(i),function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(r)),i},Gt.WebGLShadowMap=function(k,R,D){for(var F=k.context,V=k.state,U=new Gt.Frustum,B=new Gt.Matrix4,O=(new Gt.Vector3,new Gt.Vector3,new Gt.Vector3),N=new Gt.Vector3,G=[],u=1,d=2,e=1+(u|d),p=new Array(e),f=new Array(e),I=[new Gt.Vector3(1,0,0),new Gt.Vector3(-1,0,0),new Gt.Vector3(0,0,1),new Gt.Vector3(0,0,-1),new Gt.Vector3(0,1,0),new Gt.Vector3(0,-1,0)],z=[new Gt.Vector3(0,1,0),new Gt.Vector3(0,1,0),new Gt.Vector3(0,1,0),new Gt.Vector3(0,1,0),new Gt.Vector3(0,0,1),new Gt.Vector3(0,0,-1)],H=[new Gt.Vector4,new Gt.Vector4,new Gt.Vector4,new Gt.Vector4,new Gt.Vector4,new Gt.Vector4],j=new Gt.Vector4,t=Gt.ShaderLib.depthRGBA,r=Gt.UniformsUtils.clone(t.uniforms),i=Gt.ShaderLib.distanceRGBA,n=Gt.UniformsUtils.clone(i.uniforms),o=0;o!==e;++o){var a=0!=(o&u),s=0!=(o&d),h=new Gt.ShaderMaterial({uniforms:r,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,morphTargets:a,skinning:s});h._shadowPass=!0,p[o]=h;var l=new Gt.ShaderMaterial({uniforms:n,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,morphTargets:a,skinning:s});l._shadowPass=!0,f[o]=l}var W=this;function X(e,t,r,i){var n=e.geometry,o=null,a=p,s=e.customDepthMaterial;if(r&&(a=f,s=e.customDistanceMaterial),s)o=s;else{var h=void 0!==n.morphTargets&&0<n.morphTargets.length&&t.morphTargets,l=e instanceof Gt.SkinnedMesh&&t.skinning,c=0;h&&(c|=u),l&&(c|=d),o=a[c]}return o.visible=t.visible,o.wireframe=t.wireframe,o.wireframeLinewidth=t.wireframeLinewidth,r&&void 0!==o.uniforms.lightPos&&o.uniforms.lightPos.value.copy(i),o}function q(e,t){if(!1!==e.visible){if(e instanceof Gt.Mesh||e instanceof Gt.Line||e instanceof Gt.Points)if(e.castShadow&&(!1===e.frustumCulled||!0===U.intersectsObject(e)))!0===e.material.visible&&(e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),G.push(e));for(var r=e.children,i=0,n=r.length;i<n;i++)q(r[i],t)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Gt.PCFShadowMap,this.cullFace=Gt.CullFaceFront,this.render=function(e){var t,r;if(!1!==W.enabled&&(!1!==W.autoUpdate||!1!==W.needsUpdate)){F.clearColor(1,1,1,1),V.disable(F.BLEND),V.enable(F.CULL_FACE),F.frontFace(F.CCW),F.cullFace(W.cullFace===Gt.CullFaceFront?F.FRONT:F.BACK),V.setDepthTest(!0),k.getViewport(j);for(var i=0,n=R.length;i<n;i++){var o=R[i];if(!0===o.castShadow){var a=o.shadow,s=a.camera,h=a.mapSize;if(o instanceof Gt.PointLight){t=6,r=!0;var l=h.x/4,c=h.y/2;H[0].set(2*l,c,l,c),H[1].set(0,c,l,c),H[2].set(3*l,c,l,c),H[3].set(l,c,l,c),H[4].set(3*l,0,l,c),H[5].set(l,0,l,c)}else r=!(t=1);if(null===a.map){var u=Gt.LinearFilter;W.type===Gt.PCFSoftShadowMap&&(u=Gt.NearestFilter);var d={minFilter:u,magFilter:u,format:Gt.RGBAFormat};a.map=new Gt.WebGLRenderTarget(h.x,h.y,d),a.matrix=new Gt.Matrix4,o instanceof Gt.SpotLight&&(s.aspect=h.x/h.y),s.updateProjectionMatrix()}var p=a.map,f=a.matrix;N.setFromMatrixPosition(o.matrixWorld),s.position.copy(N),k.setRenderTarget(p),k.clear();for(var m=0;m<t;m++){if(r){O.copy(s.position),O.add(I[m]),s.up.copy(z[m]),s.lookAt(O);var g=H[m];k.setViewport(g.x,g.y,g.z,g.w)}else O.setFromMatrixPosition(o.target.matrixWorld),s.lookAt(O);s.updateMatrixWorld(),s.matrixWorldInverse.getInverse(s.matrixWorld),f.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),f.multiply(s.projectionMatrix),f.multiply(s.matrixWorldInverse),B.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),U.setFromMatrix(B),G.length=0,q(e,s);for(var v=0,y=G.length;v<y;v++){var x=G[v],_=D.update(x),b=x.material;if(b instanceof Gt.MeshFaceMaterial)for(var w=_.groups,M=b.materials,S=0,E=w.length;S<E;S++){var T=w[S],C=M[T.materialIndex];if(!0===C.visible){var A=X(x,C,r,N);k.renderBufferDirect(s,R,null,_,A,x,T)}}else{A=X(x,b,r,N);k.renderBufferDirect(s,R,null,_,A,x,null)}}}k.resetGLState()}}k.setViewport(j.x,j.y,j.z,j.w);var L=k.getClearColor(),P=k.getClearAlpha();k.setClearColor(L,P),V.enable(F.BLEND),W.cullFace===Gt.CullFaceFront&&F.cullFace(F.BACK),k.resetGLState(),W.needsUpdate=!1}}},Gt.WebGLState=function(s,r,h){var i=this,n=new Uint8Array(16),o=new Uint8Array(16),a=new Uint8Array(16),t={},l=null,c=null,u=null,d=null,p=null,f=null,m=null,g=null,v=null,y=null,x=null,_=null,b=null,w=null,M=null,S=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),E=void 0,T={};this.init=function(){s.clearColor(0,0,0,1),s.clearDepth(1),s.clearStencil(0),this.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL),s.frontFace(s.CCW),s.cullFace(s.BACK),this.enable(s.CULL_FACE),this.enable(s.BLEND),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA)},this.initAttributes=function(){for(var e=0,t=n.length;e<t;e++)n[e]=0},this.enableAttribute=function(e){(n[e]=1,0===o[e]&&(s.enableVertexAttribArray(e),o[e]=1),0!==a[e])&&(r.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(e,0),a[e]=0)},this.enableAttributeAndDivisor=function(e,t,r){n[e]=1,0===o[e]&&(s.enableVertexAttribArray(e),o[e]=1),a[e]!==t&&(r.vertexAttribDivisorANGLE(e,t),a[e]=t)},this.disableUnusedAttributes=function(){for(var e=0,t=o.length;e<t;e++)o[e]!==n[e]&&(s.disableVertexAttribArray(e),o[e]=0)},this.enable=function(e){!0!==t[e]&&(s.enable(e),t[e]=!0)},this.disable=function(e){!1!==t[e]&&(s.disable(e),t[e]=!1)},this.getCompressedTextureFormats=function(){if(null===l&&(l=[],r.get("WEBGL_compressed_texture_pvrtc")||r.get("WEBGL_compressed_texture_s3tc")))for(var e=s.getParameter(s.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)l.push(e[t]);return l},this.setBlending=function(e,t,r,i,n,o,a){e!==c&&(e===Gt.NoBlending?this.disable(s.BLEND):e===Gt.AdditiveBlending?(this.enable(s.BLEND),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.SRC_ALPHA,s.ONE)):e===Gt.SubtractiveBlending?(this.enable(s.BLEND),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ZERO,s.ONE_MINUS_SRC_COLOR)):e===Gt.MultiplyBlending?(this.enable(s.BLEND),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ZERO,s.SRC_COLOR)):e===Gt.CustomBlending?this.enable(s.BLEND):(this.enable(s.BLEND),s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD),s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA)),c=e),e===Gt.CustomBlending?(n=n||t,o=o||r,a=a||i,t===u&&n===f||(s.blendEquationSeparate(h(t),h(n)),u=t,f=n),r===d&&i===p&&o===m&&a===g||(s.blendFuncSeparate(h(r),h(i),h(o),h(a)),d=r,p=i,m=o,g=a)):g=m=f=p=d=u=null},this.setDepthFunc=function(e){if(v!==e){if(e)switch(e){case Gt.NeverDepth:s.depthFunc(s.NEVER);break;case Gt.AlwaysDepth:s.depthFunc(s.ALWAYS);break;case Gt.LessDepth:s.depthFunc(s.LESS);break;case Gt.LessEqualDepth:s.depthFunc(s.LEQUAL);break;case Gt.EqualDepth:s.depthFunc(s.EQUAL);break;case Gt.GreaterEqualDepth:s.depthFunc(s.GEQUAL);break;case Gt.GreaterDepth:s.depthFunc(s.GREATER);break;case Gt.NotEqualDepth:s.depthFunc(s.NOTEQUAL);break;default:s.depthFunc(s.LEQUAL)}else s.depthFunc(s.LEQUAL);v=e}},this.setDepthTest=function(e){e?this.enable(s.DEPTH_TEST):this.disable(s.DEPTH_TEST)},this.setDepthWrite=function(e){y!==e&&(s.depthMask(e),y=e)},this.setColorWrite=function(e){x!==e&&(s.colorMask(e,e,e,e),x=e)},this.setFlipSided=function(e){_!==e&&(e?s.frontFace(s.CW):s.frontFace(s.CCW),_=e)},this.setLineWidth=function(e){e!==b&&(s.lineWidth(e),b=e)},this.setPolygonOffset=function(e,t,r){e?this.enable(s.POLYGON_OFFSET_FILL):this.disable(s.POLYGON_OFFSET_FILL),!e||w===t&&M===r||(s.polygonOffset(t,r),w=t,M=r)},this.setScissorTest=function(e){e?this.enable(s.SCISSOR_TEST):this.disable(s.SCISSOR_TEST)},this.activeTexture=function(e){void 0===e&&(e=s.TEXTURE0+S-1),E!==e&&(s.activeTexture(e),E=e)},this.bindTexture=function(e,t){void 0===E&&i.activeTexture();var r=T[E];void 0===r&&(r={type:void 0,texture:void 0},T[E]=r),r.type===e&&r.texture===t||(s.bindTexture(e,t),r.type=e,r.texture=t)},this.compressedTexImage2D=function(){try{s.compressedTexImage2D.apply(s,arguments)}catch(e){console.error(e)}},this.texImage2D=function(){try{s.texImage2D.apply(s,arguments)}catch(e){console.error(e)}},this.reset=function(){for(var e=0;e<o.length;e++)1===o[e]&&(s.disableVertexAttribArray(e),o[e]=0);t={},_=x=y=c=l=null}},Gt.LensFlarePlugin=function(y,x){var _,b,w,M,S,E,T,C,A=y.context,L=y.state;function P(){var e,t,r,i,n,o,a=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),s=new Uint16Array([0,1,2,0,2,3]);_=A.createBuffer(),b=A.createBuffer(),A.bindBuffer(A.ARRAY_BUFFER,_),A.bufferData(A.ARRAY_BUFFER,a,A.STATIC_DRAW),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,b),A.bufferData(A.ELEMENT_ARRAY_BUFFER,s,A.STATIC_DRAW),T=A.createTexture(),C=A.createTexture(),L.bindTexture(A.TEXTURE_2D,T),A.texImage2D(A.TEXTURE_2D,0,A.RGB,16,16,0,A.RGB,A.UNSIGNED_BYTE,null),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),L.bindTexture(A.TEXTURE_2D,C),A.texImage2D(A.TEXTURE_2D,0,A.RGBA,16,16,0,A.RGBA,A.UNSIGNED_BYTE,null),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),e=(E=0<A.getParameter(A.MAX_VERTEX_TEXTURE_IMAGE_UNITS))?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},t=e,r=A.createProgram(),i=A.createShader(A.FRAGMENT_SHADER),n=A.createShader(A.VERTEX_SHADER),o="precision "+y.getPrecision()+" float;\n",A.shaderSource(i,o+t.fragmentShader),A.shaderSource(n,o+t.vertexShader),A.compileShader(i),A.compileShader(n),A.attachShader(r,i),A.attachShader(r,n),A.linkProgram(r),w=r,M={vertex:A.getAttribLocation(w,"position"),uv:A.getAttribLocation(w,"uv")},S={renderType:A.getUniformLocation(w,"renderType"),map:A.getUniformLocation(w,"map"),occlusionMap:A.getUniformLocation(w,"occlusionMap"),opacity:A.getUniformLocation(w,"opacity"),color:A.getUniformLocation(w,"color"),scale:A.getUniformLocation(w,"scale"),rotation:A.getUniformLocation(w,"rotation"),screenPosition:A.getUniformLocation(w,"screenPosition")}}this.render=function(e,t,r,i){if(0!==x.length){var n=new Gt.Vector3,o=i/r,a=.5*r,s=.5*i,h=16/i,l=new Gt.Vector2(h*o,h),c=new Gt.Vector3(1,1,0),u=new Gt.Vector2(1,1);void 0===w&&P(),A.useProgram(w),L.initAttributes(),L.enableAttribute(M.vertex),L.enableAttribute(M.uv),L.disableUnusedAttributes(),A.uniform1i(S.occlusionMap,0),A.uniform1i(S.map,1),A.bindBuffer(A.ARRAY_BUFFER,_),A.vertexAttribPointer(M.vertex,2,A.FLOAT,!1,16,0),A.vertexAttribPointer(M.uv,2,A.FLOAT,!1,16,8),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,b),L.disable(A.CULL_FACE),A.depthMask(!1);for(var d=0,p=x.length;d<p;d++){h=16/i,l.set(h*o,h);var f=x[d];if(n.set(f.matrixWorld.elements[12],f.matrixWorld.elements[13],f.matrixWorld.elements[14]),n.applyMatrix4(t.matrixWorldInverse),n.applyProjection(t.projectionMatrix),c.copy(n),u.x=c.x*a+a,u.y=c.y*s+s,E||0<u.x&&u.x<r&&0<u.y&&u.y<i){L.activeTexture(A.TEXTURE0),L.bindTexture(A.TEXTURE_2D,null),L.activeTexture(A.TEXTURE1),L.bindTexture(A.TEXTURE_2D,T),A.copyTexImage2D(A.TEXTURE_2D,0,A.RGB,u.x-8,u.y-8,16,16,0),A.uniform1i(S.renderType,0),A.uniform2f(S.scale,l.x,l.y),A.uniform3f(S.screenPosition,c.x,c.y,c.z),L.disable(A.BLEND),L.enable(A.DEPTH_TEST),A.drawElements(A.TRIANGLES,6,A.UNSIGNED_SHORT,0),L.activeTexture(A.TEXTURE0),L.bindTexture(A.TEXTURE_2D,C),A.copyTexImage2D(A.TEXTURE_2D,0,A.RGBA,u.x-8,u.y-8,16,16,0),A.uniform1i(S.renderType,1),L.disable(A.DEPTH_TEST),L.activeTexture(A.TEXTURE1),L.bindTexture(A.TEXTURE_2D,T),A.drawElements(A.TRIANGLES,6,A.UNSIGNED_SHORT,0),f.positionScreen.copy(c),f.customUpdateCallback?f.customUpdateCallback(f):f.updateLensFlares(),A.uniform1i(S.renderType,2),L.enable(A.BLEND);for(var m=0,g=f.lensFlares.length;m<g;m++){var v=f.lensFlares[m];.001<v.opacity&&.001<v.scale&&(c.x=v.x,c.y=v.y,c.z=v.z,h=v.size*v.scale/i,l.x=h*o,l.y=h,A.uniform3f(S.screenPosition,c.x,c.y,c.z),A.uniform2f(S.scale,l.x,l.y),A.uniform1f(S.rotation,v.rotation),A.uniform1f(S.opacity,v.opacity),A.uniform3f(S.color,v.color.r,v.color.g,v.color.b),L.setBlending(v.blending,v.blendEquation,v.blendSrc,v.blendDst),y.setTexture(v.texture,1),A.drawElements(A.TRIANGLES,6,A.UNSIGNED_SHORT,0))}}}L.enable(A.CULL_FACE),L.enable(A.DEPTH_TEST),A.depthMask(!0),y.resetGLState()}}},Gt.SpritePlugin=function(u,d){var p,f,m,g,v,y,x=u.context,_=u.state,b=new Gt.Vector3,w=new Gt.Quaternion,M=new Gt.Vector3;function S(){var e,t,r,i=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),n=new Uint16Array([0,1,2,0,2,3]);p=x.createBuffer(),f=x.createBuffer(),x.bindBuffer(x.ARRAY_BUFFER,p),x.bufferData(x.ARRAY_BUFFER,i,x.STATIC_DRAW),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,f),x.bufferData(x.ELEMENT_ARRAY_BUFFER,n,x.STATIC_DRAW),e=x.createProgram(),t=x.createShader(x.VERTEX_SHADER),r=x.createShader(x.FRAGMENT_SHADER),x.shaderSource(t,["precision "+u.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),x.shaderSource(r,["precision "+u.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),x.compileShader(t),x.compileShader(r),x.attachShader(e,t),x.attachShader(e,r),x.linkProgram(e),m=e,g={position:x.getAttribLocation(m,"position"),uv:x.getAttribLocation(m,"uv")},v={uvOffset:x.getUniformLocation(m,"uvOffset"),uvScale:x.getUniformLocation(m,"uvScale"),rotation:x.getUniformLocation(m,"rotation"),scale:x.getUniformLocation(m,"scale"),color:x.getUniformLocation(m,"color"),map:x.getUniformLocation(m,"map"),opacity:x.getUniformLocation(m,"opacity"),modelViewMatrix:x.getUniformLocation(m,"modelViewMatrix"),projectionMatrix:x.getUniformLocation(m,"projectionMatrix"),fogType:x.getUniformLocation(m,"fogType"),fogDensity:x.getUniformLocation(m,"fogDensity"),fogNear:x.getUniformLocation(m,"fogNear"),fogFar:x.getUniformLocation(m,"fogFar"),fogColor:x.getUniformLocation(m,"fogColor"),alphaTest:x.getUniformLocation(m,"alphaTest")};var o=document.createElement("canvas");o.width=8,o.height=8;var a=o.getContext("2d");a.fillStyle="white",a.fillRect(0,0,8,8),(y=new Gt.Texture(o)).needsUpdate=!0}function E(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}this.render=function(e,t){if(0!==d.length){void 0===m&&S(),x.useProgram(m),_.initAttributes(),_.enableAttribute(g.position),_.enableAttribute(g.uv),_.disableUnusedAttributes(),_.disable(x.CULL_FACE),_.enable(x.BLEND),x.bindBuffer(x.ARRAY_BUFFER,p),x.vertexAttribPointer(g.position,2,x.FLOAT,!1,16,0),x.vertexAttribPointer(g.uv,2,x.FLOAT,!1,16,8),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,f),x.uniformMatrix4fv(v.projectionMatrix,!1,t.projectionMatrix.elements),_.activeTexture(x.TEXTURE0),x.uniform1i(v.map,0);var r=0,i=0,n=e.fog;n?(x.uniform3f(v.fogColor,n.color.r,n.color.g,n.color.b),n instanceof Gt.Fog?(x.uniform1f(v.fogNear,n.near),x.uniform1f(v.fogFar,n.far),x.uniform1i(v.fogType,1),i=r=1):n instanceof Gt.FogExp2&&(x.uniform1f(v.fogDensity,n.density),x.uniform1i(v.fogType,2),i=r=2)):(x.uniform1i(v.fogType,0),i=r=0);for(var o=0,a=d.length;o<a;o++){(h=d[o]).modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,h.matrixWorld),h.z=-h.modelViewMatrix.elements[14]}d.sort(E);var s=[];for(o=0,a=d.length;o<a;o++){var h,l=(h=d[o]).material;x.uniform1f(v.alphaTest,l.alphaTest),x.uniformMatrix4fv(v.modelViewMatrix,!1,h.modelViewMatrix.elements),h.matrixWorld.decompose(b,w,M),s[0]=M.x,s[1]=M.y;var c=0;e.fog&&l.fog&&(c=i),r!==c&&(x.uniform1i(v.fogType,c),r=c),null!==l.map?(x.uniform2f(v.uvOffset,l.map.offset.x,l.map.offset.y),x.uniform2f(v.uvScale,l.map.repeat.x,l.map.repeat.y)):(x.uniform2f(v.uvOffset,0,0),x.uniform2f(v.uvScale,1,1)),x.uniform1f(v.opacity,l.opacity),x.uniform3f(v.color,l.color.r,l.color.g,l.color.b),x.uniform1f(v.rotation,l.rotation),x.uniform2fv(v.scale,s),_.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst),_.setDepthTest(l.depthTest),_.setDepthWrite(l.depthWrite),l.map&&l.map.image&&l.map.image.width?u.setTexture(l.map,0):u.setTexture(y,0),x.drawElements(x.TRIANGLES,6,x.UNSIGNED_SHORT,0)}_.enable(x.CULL_FACE),u.resetGLState()}}},Gt.CurveUtils={tangentQuadraticBezier:function(e,t,r,i){return 2*(1-e)*(r-t)+2*e*(i-r)},tangentCubicBezier:function(e,t,r,i,n){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*n},tangentSpline:function(e,t,r,i,n){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,r,i,n){var o=.5*(r-e),a=.5*(i-t),s=n*n;return(2*t-2*r+o+a)*(n*s)+(-3*t+3*r-2*o-a)*s+o*n+t}},Gt.GeometryUtils={merge:function(e,t,r){var i;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t instanceof Gt.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},Gt.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,r,i){console.warn("THREE.ImageUtils.loadTexture is being deprecated. Use THREE.TextureLoader() instead.");var n=new Gt.TextureLoader;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,r,void 0,i);return t&&(o.mapping=t),o},loadTextureCube:function(e,t,r,i){console.warn("THREE.ImageUtils.loadTextureCube is being deprecated. Use THREE.CubeTextureLoader() instead.");var n=new Gt.CubeTextureLoader;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,r,void 0,i);return t&&(o.mapping=t),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}},Gt.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new Gt.Group,i=0,n=t.length;i<n;i++)r.add(new Gt.Mesh(e,t[i]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var i=new Gt.Matrix4;i.getInverse(r.matrixWorld),e.applyMatrix(i),t.remove(e),r.add(e)}},Gt.ShapeUtils={area:function(e){for(var t=e.length,r=0,i=t-1,n=0;n<t;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*r},triangulate:function(){function g(e,t,r,i,n,o){var a,s,h,l,c,u,d,p,f,m,g,v,y,x,_,b,w;if(s=e[o[t]].x,h=e[o[t]].y,l=e[o[r]].x,c=e[o[r]].y,u=e[o[i]].x,d=e[o[i]].y,Number.EPSILON>(l-s)*(d-h)-(c-h)*(u-s))return!1;for(m=u-l,g=d-c,v=s-u,y=h-d,x=l-s,_=c-h,a=0;a<n;a++)if(p=e[o[a]].x,f=e[o[a]].y,!(p===s&&f===h||p===l&&f===c||p===u&&f===d)&&(b=x*(f-h)-_*(p-s),w=v*(f-d)-y*(p-u),m*(f-c)-g*(p-l)>=-Number.EPSILON&&w>=-Number.EPSILON&&b>=-Number.EPSILON))return!1;return!0}return function(e,t){var r=e.length;if(r<3)return null;var i,n,o,a=[],s=[],h=[];if(0<Gt.ShapeUtils.area(e))for(n=0;n<r;n++)s[n]=n;else for(n=0;n<r;n++)s[n]=r-1-n;var l=r,c=2*l;for(n=l-1;2<l;){if(c--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),t?h:a;if(l<=(i=n)&&(i=0),l<=(n=i+1)&&(n=0),l<=(o=n+1)&&(o=0),g(e,i,n,o,l,s)){var u,d,p,f,m;for(u=s[i],d=s[n],p=s[o],a.push([e[u],e[d],e[p]]),h.push([s[i],s[n],s[o]]),m=(f=n)+1;m<l;f++,m++)s[f]=s[m];c=2*--l}}return t?h:a}}(),triangulateShape:function(e,t){function E(e,t,r){return e.x!==t.x?e.x<t.x?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:e.y<t.y?e.y<=r.y&&r.y<=t.y:t.y<=r.y&&r.y<=e.y}function S(e,t,r,i,n){var o=t.x-e.x,a=t.y-e.y,s=i.x-r.x,h=i.y-r.y,l=e.x-r.x,c=e.y-r.y,u=a*s-o*h,d=a*l-o*c;if(Math.abs(u)>Number.EPSILON){var p;if(0<u){if(d<0||u<d)return[];if((p=h*l-s*c)<0||u<p)return[]}else{if(0<d||d<u)return[];if(0<(p=h*l-s*c)||p<u)return[]}if(0===p)return!n||0!==d&&d!==u?[e]:[];if(p===u)return!n||0!==d&&d!==u?[t]:[];if(0===d)return[r];if(d===u)return[i];var f=p/u;return[{x:e.x+f*o,y:e.y+f*a}]}if(0!==d||h*l!=s*c)return[];var m,g,v,y,x,_,b,w,M=0===o&&0===a,S=0===s&&0===h;return M&&S?e.x!==r.x||e.y!==r.y?[]:[e]:M?E(r,i,e)?[e]:[]:S?E(e,t,r)?[r]:[]:(0!==o?(e.x<t.x?(v=(m=e).x,y=(g=t).x):(v=(m=t).x,y=(g=e).x),r.x<i.x?(b=(x=r).x,w=(_=i).x):(b=(x=i).x,w=(_=r).x)):(e.y<t.y?(v=(m=e).y,y=(g=t).y):(v=(m=t).y,y=(g=e).y),r.y<i.y?(b=(x=r).y,w=(_=i).y):(b=(x=i).y,w=(_=r).y)),v<=b?y<b?[]:y===b?n?[]:[x]:y<=w?[x,g]:[x,_]:w<v?[]:v===w?n?[]:[m]:y<=w?[m,g]:[m,_])}function T(e,t,r,i){var n=t.x-e.x,o=t.y-e.y,a=r.x-e.x,s=r.y-e.y,h=i.x-e.x,l=i.y-e.y,c=n*s-o*a,u=n*l-o*h;if(Math.abs(c)>Number.EPSILON){var d=h*s-l*a;return 0<c?0<=u&&0<=d:0<=u||0<=d}return 0<u}for(var r,i,n,o,a,s,h={},l=e.concat(),c=0,u=t.length;c<u;c++)Array.prototype.push.apply(l,t[c]);for(r=0,i=l.length;r<i;r++)void 0!==h[a=l[r].x+":"+l[r].y]&&console.warn("THREE.Shape: Duplicate point",a),h[a]=r;var d=function(e,a){var l,c=e.concat();function t(e,t){var r=c.length-1,i=e-1;i<0&&(i=r);var n=e+1;r<n&&(n=0);var o=T(c[e],c[i],c[n],l[t]);if(!o)return!1;var a=l.length-1,s=t-1;s<0&&(s=a);var h=t+1;return a<h&&(h=0),!!(o=T(l[t],l[s],l[h],c[e]))}function r(e,t){var r,i;for(r=0;r<c.length;r++)if(i=r+1,i%=c.length,0<S(e,t,c[r],c[i],!0).length)return!0;return!1}var s=[];function i(e,t){var r,i,n,o;for(r=0;r<s.length;r++)for(i=a[s[r]],n=0;n<i.length;n++)if(o=n+1,o%=i.length,0<S(e,t,i[n],i[o],!0).length)return!0;return!1}for(var n,o,h,u,d,p,f,m,g,v,y=[],x=0,_=a.length;x<_;x++)s.push(x);for(var b=0,w=2*s.length;0<s.length;){if(--w<0){console.log("Infinite Loop! Holes left:"+s.length+", Probably Hole outside Shape!");break}for(o=b;o<c.length;o++){for(h=c[o],n=-1,x=0;x<s.length;x++)if(d=s[x],void 0===y[p=h.x+":"+h.y+":"+d]){l=a[d];for(var M=0;M<l.length;M++)if(u=l[M],t(o,M)&&!r(h,u)&&!i(h,u)){n=M,s.splice(x,1),f=c.slice(0,o+1),m=c.slice(o),g=l.slice(n),v=l.slice(0,n+1),c=f.concat(g).concat(v).concat(m),b=o;break}if(0<=n)break;y[p]=!0}if(0<=n)break}}return c}(e,t),p=Gt.ShapeUtils.triangulate(d,!1);for(r=0,i=p.length;r<i;r++)for(o=p[r],n=0;n<3;n++)void 0!==(s=h[a=o[n].x+":"+o[n].y])&&(o[n]=s);return p.concat()},isClockWise:function(e){return Gt.ShapeUtils.area(e)<0},b2:function(e,t,r,i){return(a=1-e)*a*t+2*(1-(o=e))*o*r+(n=e)*n*i;var n,o,a},b3:function(e,t,r,i,n){return(l=1-e)*l*l*t+3*(h=1-(s=e))*h*s*r+3*(1-(a=e))*a*a*i+(o=e)*o*o*n;var o,a,s,h,l}},Gt.Audio=function(e){Gt.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1},Gt.Audio.prototype=Object.create(Gt.Object3D.prototype),Gt.Audio.prototype.constructor=Gt.Audio,Gt.Audio.prototype.load=function(e){var t=this,r=new XMLHttpRequest;return r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e,t.autoplay&&t.play()})},r.send(),this},Gt.Audio.prototype.play=function(){if(!0!==this.isPlaying){var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.start(0,this.startTime),e.playbackRate.value=this.playbackRate,this.isPlaying=!0,this.source=e,this.connect()}else console.warn("THREE.Audio: Audio is already playing.")},Gt.Audio.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},Gt.Audio.prototype.stop=function(){this.source.stop(),this.startTime=0},Gt.Audio.prototype.connect=function(){void 0!==this.filter?(this.source.connect(this.filter),this.filter.connect(this.panner)):this.source.connect(this.panner)},Gt.Audio.prototype.disconnect=function(){void 0!==this.filter?(this.source.disconnect(this.filter),this.filter.disconnect(this.panner)):this.source.disconnect(this.panner)},Gt.Audio.prototype.setFilter=function(e){!0===this.isPlaying?(this.disconnect(),this.filter=e,this.connect()):this.filter=e},Gt.Audio.prototype.getFilter=function(){return this.filter},Gt.Audio.prototype.setPlaybackRate=function(e){this.playbackRate=e,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate)},Gt.Audio.prototype.getPlaybackRate=function(){return this.playbackRate},Gt.Audio.prototype.onEnded=function(){this.isPlaying=!1},Gt.Audio.prototype.setLoop=function(e){this.source.loop=e},Gt.Audio.prototype.getLoop=function(){return this.source.loop},Gt.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},Gt.Audio.prototype.getRefDistance=function(){return this.panner.refDistance},Gt.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},Gt.Audio.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor},Gt.Audio.prototype.setVolume=function(e){this.gain.gain.value=e},Gt.Audio.prototype.getVolume=function(){return this.gain.gain.value},Gt.Audio.prototype.updateMatrixWorld=(xt=new Gt.Vector3,function(e){Gt.Object3D.prototype.updateMatrixWorld.call(this,e),xt.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(xt.x,xt.y,xt.z)}),Gt.AudioListener=function(){Gt.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},Gt.AudioListener.prototype=Object.create(Gt.Object3D.prototype),Gt.AudioListener.prototype.constructor=Gt.AudioListener,Gt.AudioListener.prototype.updateMatrixWorld=(_t=new Gt.Vector3,bt=new Gt.Quaternion,wt=new Gt.Vector3,Mt=new Gt.Vector3,function(e){Gt.Object3D.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,r=this.up;this.matrixWorld.decompose(_t,bt,wt),Mt.set(0,0,-1).applyQuaternion(bt),t.setPosition(_t.x,_t.y,_t.z),t.setOrientation(Mt.x,Mt.y,Mt.z,r.x,r.y,r.z)}),Gt.Curve=function(){},Gt.Curve.prototype={constructor:Gt.Curve,getPoint:function(e){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},getPointAt:function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},getPoints:function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPoint(t/e));return r},getSpacedPoints:function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPointAt(t/e));return r},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],n=this.getPoint(0),o=0;for(i.push(0),r=1;r<=e;r++)o+=(t=this.getPoint(r/e)).distanceTo(n),i.push(o),n=t;return this.cacheArcLengths=i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,i=this.getLengths(),n=0,o=i.length;r=t||e*i[o-1];for(var a,s=0,h=o-1;s<=h;)if((a=i[n=Math.floor(s+(h-s)/2)]-r)<0)s=n+1;else{if(!(0<a)){h=n;break}h=n-1}if(i[n=h]===r)return n/(o-1);var l=i[n];return(n+(r-l)/(i[n+1]-l))/(o-1)},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),1<r&&(r=1);var i=this.getPoint(t);return this.getPoint(r).clone().sub(i).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)}},Gt.Curve.Utils=Gt.CurveUtils,Gt.Curve.create=function(e,t){return e.prototype=Object.create(Gt.Curve.prototype),(e.prototype.constructor=e).prototype.getPoint=t,e},Gt.CurvePath=function(){this.curves=[],this.autoClose=!1},Gt.CurvePath.prototype=Object.create(Gt.Curve.prototype),Gt.CurvePath.prototype.constructor=Gt.CurvePath,Gt.CurvePath.prototype.add=function(e){this.curves.push(e)},Gt.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Gt.LineCurve(t,e))},Gt.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=t){var n=r[i]-t,o=this.curves[i],a=1-n/o.getLength();return o.getPointAt(a)}i++}return null},Gt.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},Gt.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e},Gt.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},Gt.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},Gt.CurvePath.prototype.createGeometry=function(e){for(var t=new Gt.Geometry,r=0,i=e.length;r<i;r++){var n=e[r];t.vertices.push(new Gt.Vector3(n.x,n.y,n.z||0))}return t},Gt.Path=function(e){Gt.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},Gt.Path.prototype=Object.create(Gt.CurvePath.prototype),Gt.Path.prototype.constructor=Gt.Path,Gt.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},Gt.Path.prototype.moveTo=function(e,t){this.actions.push({action:"moveTo",args:[e,t]})},Gt.Path.prototype.lineTo=function(e,t){var r=this.actions[this.actions.length-1].args,i=r[r.length-2],n=r[r.length-1],o=new Gt.LineCurve(new Gt.Vector2(i,n),new Gt.Vector2(e,t));this.curves.push(o),this.actions.push({action:"lineTo",args:[e,t]})},Gt.Path.prototype.quadraticCurveTo=function(e,t,r,i){var n=this.actions[this.actions.length-1].args,o=n[n.length-2],a=n[n.length-1],s=new Gt.QuadraticBezierCurve(new Gt.Vector2(o,a),new Gt.Vector2(e,t),new Gt.Vector2(r,i));this.curves.push(s),this.actions.push({action:"quadraticCurveTo",args:[e,t,r,i]})},Gt.Path.prototype.bezierCurveTo=function(e,t,r,i,n,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],h=a[a.length-1],l=new Gt.CubicBezierCurve(new Gt.Vector2(s,h),new Gt.Vector2(e,t),new Gt.Vector2(r,i),new Gt.Vector2(n,o));this.curves.push(l),this.actions.push({action:"bezierCurveTo",args:[e,t,r,i,n,o]})},Gt.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],n=r[r.length-1],o=[new Gt.Vector2(i,n)];Array.prototype.push.apply(o,e);var a=new Gt.SplineCurve(o);this.curves.push(a),this.actions.push({action:"splineThru",args:t})},Gt.Path.prototype.arc=function(e,t,r,i,n,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],h=a[a.length-1];this.absarc(e+s,t+h,r,i,n,o)},Gt.Path.prototype.absarc=function(e,t,r,i,n,o){this.absellipse(e,t,r,r,i,n,o)},Gt.Path.prototype.ellipse=function(e,t,r,i,n,o,a,s){var h=this.actions[this.actions.length-1].args,l=h[h.length-2],c=h[h.length-1];this.absellipse(e+l,t+c,r,i,n,o,a,s)},Gt.Path.prototype.absellipse=function(e,t,r,i,n,o,a,s){var h=[e,t,r,i,n,o,a,s||0],l=new Gt.EllipseCurve(e,t,r,i,n,o,a,s);this.curves.push(l);var c=l.getPoint(1);h.push(c.x),h.push(c.y),this.actions.push({action:"ellipse",args:h})},Gt.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var r=[],i=0;i<e;i++)r.push(this.getPoint(i/e));return r},Gt.Path.prototype.getPoints=function(e,t){e=e||12;for(var r,i,n,o,a,s,h,l,c,u,d,p=Gt.ShapeUtils.b2,f=Gt.ShapeUtils.b3,m=[],g=0,v=this.actions.length;g<v;g++){var y=this.actions[g],x=y.action,_=y.args;switch(x){case"moveTo":case"lineTo":m.push(new Gt.Vector2(_[0],_[1]));break;case"quadraticCurveTo":r=_[2],i=_[3],a=_[0],s=_[1],0<m.length?(h=(c=m[m.length-1]).x,l=c.y):(h=(c=this.actions[g-1].args)[c.length-2],l=c[c.length-1]);for(var b=1;b<=e;b++){u=p(D=b/e,h,a,r),d=p(D,l,s,i),m.push(new Gt.Vector2(u,d))}break;case"bezierCurveTo":r=_[4],i=_[5],a=_[0],s=_[1],n=_[2],o=_[3],0<m.length?(h=(c=m[m.length-1]).x,l=c.y):(h=(c=this.actions[g-1].args)[c.length-2],l=c[c.length-1]);for(b=1;b<=e;b++){u=f(D=b/e,h,a,n,r),d=f(D,l,s,o,i),m.push(new Gt.Vector2(u,d))}break;case"splineThru":c=this.actions[g-1].args;var w=[new Gt.Vector2(c[c.length-2],c[c.length-1])],M=e*_[0].length;w=w.concat(_[0]);var S=new Gt.SplineCurve(w);for(b=1;b<=M;b++)m.push(S.getPointAt(b/M));break;case"arc":var E=_[0],T=_[1],C=_[2],A=_[3],L=_[4],P=!!_[5],k=L-A,R=2*e;for(b=1;b<=R;b++){var D=b/R;P||(D=1-D),F=A+D*k,u=E+C*Math.cos(F),d=T+C*Math.sin(F),m.push(new Gt.Vector2(u,d))}break;case"ellipse":E=_[0],T=_[1];var F,V,U,B=_[2],O=_[3],N=(A=_[4],L=_[5],P=!!_[6],_[7]);k=L-A,R=2*e;0!==N&&(V=Math.cos(N),U=Math.sin(N));for(b=1;b<=R;b++){D=b/R;if(P||(D=1-D),F=A+D*k,u=E+B*Math.cos(F),d=T+O*Math.sin(F),0!==N){var G=u;u=(G-E)*V-(d-T)*U+E,d=(G-E)*U+(d-T)*V+T}m.push(new Gt.Vector2(u,d))}}}var I=m[m.length-1];return Math.abs(I.x-m[0].x)<Number.EPSILON&&Math.abs(I.y-m[0].y)<Number.EPSILON&&m.splice(m.length-1,1),t&&m.push(m[0]),m},Gt.Path.prototype.toShapes=function(e,t){function r(e){for(var t=[],r=0,i=e.length;r<i;r++){var n=e[r],o=new Gt.Shape;o.actions=n.actions,o.curves=n.curves,t.push(o)}return t}function i(e,t){for(var r=t.length,i=!1,n=r-1,o=0;o<r;n=o++){var a=t[n],s=t[o],h=s.x-a.x,l=s.y-a.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(a=t[o],h=-h,s=t[n],l=-l),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var c=l*(e.x-a.x)-h*(e.y-a.y);if(0===c)return!0;if(c<0)continue;i=!i}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return i}var n=Gt.ShapeUtils.isClockWise,o=function(e){for(var t=[],r=new Gt.Path,i=0,n=e.length;i<n;i++){var o=e[i],a=o.args,s=o.action;"moveTo"===s&&0!==r.actions.length&&(t.push(r),r=new Gt.Path),r[s].apply(r,a)}return 0!==r.actions.length&&t.push(r),t}(this.actions);if(0===o.length)return[];if(!0===t)return r(o);var a,s,h,l=[];if(1===o.length)return s=o[0],(h=new Gt.Shape).actions=s.actions,h.curves=s.curves,l.push(h),l;var c=!n(o[0].getPoints());c=e?!c:c;var u,d,p=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var v=0,y=o.length;v<y;v++)a=n(u=(s=o[v]).getPoints()),(a=e?!a:a)?(!c&&f[g]&&g++,f[g]={s:new Gt.Shape,p:u},f[g].s.actions=s.actions,f[g].s.curves=s.curves,c&&g++,m[g]=[]):m[g].push({h:s,p:u[0]});if(!f[0])return r(o);if(1<f.length){for(var x=!1,_=[],b=0,w=f.length;b<w;b++)p[b]=[];for(b=0,w=f.length;b<w;b++)for(var M=m[b],S=0;S<M.length;S++){for(var E=M[S],T=!0,C=0;C<f.length;C++)i(E.p,f[C].p)&&(b!==C&&_.push({froms:b,tos:C,hole:S}),T?(T=!1,p[C].push(E)):x=!0);T&&p[b].push(E)}0<_.length&&(x||(m=p))}v=0;for(var A=f.length;v<A;v++){h=f[v].s,l.push(h);for(var L=0,P=(d=m[v]).length;L<P;L++)h.holes.push(d[L].h)}return l},Gt.Shape=function(){Gt.Path.apply(this,arguments),this.holes=[]},Gt.Shape.prototype=Object.create(Gt.Path.prototype),Gt.Shape.prototype.constructor=Gt.Shape,Gt.Shape.prototype.extrude=function(e){return new Gt.ExtrudeGeometry(this,e)},Gt.Shape.prototype.makeGeometry=function(e){return new Gt.ShapeGeometry(this,e)},Gt.Shape.prototype.getPointsHoles=function(e){for(var t=[],r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t},Gt.Shape.prototype.extractAllPoints=function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},Gt.Shape.prototype.extractPoints=function(e){return this.extractAllPoints(e)},Gt.Shape.Utils=Gt.ShapeUtils,Gt.LineCurve=function(e,t){this.v1=e,this.v2=t},Gt.LineCurve.prototype=Object.create(Gt.Curve.prototype),Gt.LineCurve.prototype.constructor=Gt.LineCurve,Gt.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},Gt.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},Gt.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},Gt.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},Gt.QuadraticBezierCurve.prototype=Object.create(Gt.Curve.prototype),Gt.QuadraticBezierCurve.prototype.constructor=Gt.QuadraticBezierCurve,Gt.QuadraticBezierCurve.prototype.getPoint=function(e){var t=Gt.ShapeUtils.b2;return new Gt.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y))},Gt.QuadraticBezierCurve.prototype.getTangent=function(e){var t=Gt.CurveUtils.tangentQuadraticBezier;return new Gt.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y)).normalize()},Gt.CubicBezierCurve=function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},Gt.CubicBezierCurve.prototype=Object.create(Gt.Curve.prototype),Gt.CubicBezierCurve.prototype.constructor=Gt.CubicBezierCurve,Gt.CubicBezierCurve.prototype.getPoint=function(e){var t=Gt.ShapeUtils.b3;return new Gt.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y))},Gt.CubicBezierCurve.prototype.getTangent=function(e){var t=Gt.CurveUtils.tangentCubicBezier;return new Gt.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()},Gt.SplineCurve=function(e){this.points=null==e?[]:e},Gt.SplineCurve.prototype=Object.create(Gt.Curve.prototype),Gt.SplineCurve.prototype.constructor=Gt.SplineCurve,Gt.SplineCurve.prototype.getPoint=function(e){var t=this.points,r=(t.length-1)*e,i=Math.floor(r),n=r-i,o=t[0===i?i:i-1],a=t[i],s=t[i>t.length-2?t.length-1:i+1],h=t[i>t.length-3?t.length-1:i+2],l=Gt.CurveUtils.interpolate;return new Gt.Vector2(l(o.x,a.x,s.x,h.x,n),l(o.y,a.y,s.y,h.y,n))},Gt.EllipseCurve=function(e,t,r,i,n,o,a,s){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s||0},Gt.EllipseCurve.prototype=Object.create(Gt.Curve.prototype),Gt.EllipseCurve.prototype.constructor=Gt.EllipseCurve,Gt.EllipseCurve.prototype.getPoint=function(e){var t,r=this.aEndAngle-this.aStartAngle;r<0&&(r+=2*Math.PI),r>2*Math.PI&&(r-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-r):this.aStartAngle+e*r;var i=this.aX+this.xRadius*Math.cos(t),n=this.aY+this.yRadius*Math.sin(t);if(0!==this.aRotation){var o=Math.cos(this.aRotation),a=Math.sin(this.aRotation),s=i,h=n;i=(s-this.aX)*o-(h-this.aY)*a+this.aX,n=(s-this.aX)*a+(h-this.aY)*o+this.aY}return new Gt.Vector2(i,n)},Gt.ArcCurve=function(e,t,r,i,n,o){Gt.EllipseCurve.call(this,e,t,r,r,i,n,o)},Gt.ArcCurve.prototype=Object.create(Gt.EllipseCurve.prototype),Gt.ArcCurve.prototype.constructor=Gt.ArcCurve,Gt.LineCurve3=Gt.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new Gt.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),Gt.QuadraticBezierCurve3=Gt.Curve.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t=Gt.ShapeUtils.b2;return new Gt.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y),t(e,this.v0.z,this.v1.z,this.v2.z))}),Gt.CubicBezierCurve3=Gt.Curve.create(function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},function(e){var t=Gt.ShapeUtils.b3;return new Gt.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),Gt.SplineCurve3=Gt.Curve.create(function(e){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"),this.points=null==e?[]:e},function(e){var t=this.points,r=(t.length-1)*e,i=Math.floor(r),n=r-i,o=t[0==i?i:i-1],a=t[i],s=t[i>t.length-2?t.length-1:i+1],h=t[i>t.length-3?t.length-1:i+2],l=Gt.CurveUtils.interpolate;return new Gt.Vector3(l(o.x,a.x,s.x,h.x,n),l(o.y,a.y,s.y,h.y,n),l(o.z,a.z,s.z,h.z,n))}),Gt.CatmullRomCurve3=function(){var m=new Gt.Vector3,g=new e,v=new e,y=new e;function e(){}return e.prototype.init=function(e,t,r,i){this.c0=e,this.c1=r,this.c2=-3*e+3*t-2*r-i,this.c3=2*e-2*t+r+i},e.prototype.initNonuniformCatmullRom=function(e,t,r,i,n,o,a){var s=(t-e)/n-(r-e)/(n+o)+(r-t)/o,h=(r-t)/o-(i-t)/(o+a)+(i-r)/a;s*=o,h*=o,this.init(t,r,s,h)},e.prototype.initCatmullRom=function(e,t,r,i,n){this.init(t,r,n*(r-e),n*(i-t))},e.prototype.calc=function(e){var t=e*e,r=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*r},Gt.Curve.create(function(e){this.points=e||[]},function(e){var t,r,i,n,o,a,s,h,l=this.points;if((n=l.length)<2&&console.log("duh, you need at least 2 points"),0===(i=(t=(n-1)*e)-(r=Math.floor(t)))&&r===n-1&&(r=n-2,i=1),0===r?(m.subVectors(l[0],l[1]).add(l[0]),o=m):o=l[r-1],a=l[r],s=l[r+1],r+2<n?h=l[r+2]:(m.subVectors(l[n-1],l[n-2]).add(l[n-2]),h=m),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var c="chordal"===this.type?.5:.25,u=Math.pow(o.distanceToSquared(a),c),d=Math.pow(a.distanceToSquared(s),c),p=Math.pow(s.distanceToSquared(h),c);d<1e-4&&(d=1),u<1e-4&&(u=d),p<1e-4&&(p=d),g.initNonuniformCatmullRom(o.x,a.x,s.x,h.x,u,d,p),v.initNonuniformCatmullRom(o.y,a.y,s.y,h.y,u,d,p),y.initNonuniformCatmullRom(o.z,a.z,s.z,h.z,u,d,p)}else if("catmullrom"===this.type){var f=void 0!==this.tension?this.tension:.5;g.initCatmullRom(o.x,a.x,s.x,h.x,f),v.initCatmullRom(o.y,a.y,s.y,h.y,f),y.initCatmullRom(o.z,a.z,s.z,h.z,f)}return new Gt.Vector3(g.calc(i),v.calc(i),y.calc(i))})}(),Gt.ClosedSplineCurve3=Gt.Curve.create(function(e){this.points=null==e?[]:e},function(e){var t=this.points,r=(t.length-0)*e,i=Math.floor(r),n=r-i,o=t[((i+=0<i?0:(Math.floor(Math.abs(i)/t.length)+1)*t.length)-1)%t.length],a=t[i%t.length],s=t[(i+1)%t.length],h=t[(i+2)%t.length],l=Gt.CurveUtils.interpolate;return new Gt.Vector3(l(o.x,a.x,s.x,h.x,n),l(o.y,a.y,s.y,h.y,n),l(o.z,a.z,s.z,h.z,n))}),Gt.BoxGeometry=function(e,t,r,i,n,o){Gt.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:o},this.widthSegments=i||1,this.heightSegments=n||1,this.depthSegments=o||1;var k=this,a=e/2,s=t/2,h=r/2;function l(e,t,r,i,n,o,a,s){var h,l,c,u=k.widthSegments,d=k.heightSegments,p=n/2,f=o/2,m=k.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?h="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(h="y",d=k.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(h="x",u=k.depthSegments);var g=u+1,v=d+1,y=n/u,x=o/d,_=new Gt.Vector3;for(_[h]=0<a?1:-1,c=0;c<v;c++)for(l=0;l<g;l++){var b=new Gt.Vector3;b[e]=(l*y-p)*r,b[t]=(c*x-f)*i,b[h]=a,k.vertices.push(b)}for(c=0;c<d;c++)for(l=0;l<u;l++){var w=l+g*c,M=l+g*(c+1),S=l+1+g*(c+1),E=l+1+g*c,T=new Gt.Vector2(l/u,1-c/d),C=new Gt.Vector2(l/u,1-(c+1)/d),A=new Gt.Vector2((l+1)/u,1-(c+1)/d),L=new Gt.Vector2((l+1)/u,1-c/d),P=new Gt.Face3(w+m,M+m,E+m);P.normal.copy(_),P.vertexNormals.push(_.clone(),_.clone(),_.clone()),P.materialIndex=s,k.faces.push(P),k.faceVertexUvs[0].push([T,C,L]),(P=new Gt.Face3(M+m,S+m,E+m)).normal.copy(_),P.vertexNormals.push(_.clone(),_.clone(),_.clone()),P.materialIndex=s,k.faces.push(P),k.faceVertexUvs[0].push([C.clone(),A,L.clone()])}}l("z","y",-1,-1,r,t,a,0),l("z","y",1,-1,r,t,-a,1),l("x","z",1,1,e,r,s,2),l("x","z",1,-1,e,r,-s,3),l("x","y",1,-1,e,t,h,4),l("x","y",-1,-1,e,t,-h,5),this.mergeVertices()},Gt.BoxGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.BoxGeometry.prototype.constructor=Gt.BoxGeometry,Gt.BoxGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)},Gt.CubeGeometry=Gt.BoxGeometry,Gt.CircleGeometry=function(e,t,r,i){Gt.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},this.fromBufferGeometry(new Gt.CircleBufferGeometry(e,t,r,i))},Gt.CircleGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.CircleGeometry.prototype.constructor=Gt.CircleGeometry,Gt.CircleGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.CircleGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)},Gt.CircleBufferGeometry=function(e,t,r,i){Gt.BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},e=e||50,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var n=t+2,o=new Float32Array(3*n),a=new Float32Array(3*n),s=new Float32Array(2*n);a[2]=1,s[0]=.5,s[1]=.5;for(var h=0,l=3,c=2;h<=t;h++,l+=3,c+=2){var u=r+h/t*i;o[l]=e*Math.cos(u),o[l+1]=e*Math.sin(u),a[l+2]=1,s[c]=(o[l]/e+1)/2,s[c+1]=(o[l+1]/e+1)/2}var d=[];for(l=1;l<=t;l++)d.push(l,l+1,0);this.setIndex(new Gt.BufferAttribute(new Uint16Array(d),1)),this.addAttribute("position",new Gt.BufferAttribute(o,3)),this.addAttribute("normal",new Gt.BufferAttribute(a,3)),this.addAttribute("uv",new Gt.BufferAttribute(s,2)),this.boundingSphere=new Gt.Sphere(new Gt.Vector3,e)},Gt.CircleBufferGeometry.prototype=Object.create(Gt.BufferGeometry.prototype),Gt.CircleBufferGeometry.prototype.constructor=Gt.CircleBufferGeometry,Gt.CircleBufferGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.CircleBufferGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)},Gt.CylinderGeometry=function(e,t,r,i,n,o,a,s){Gt.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s},e=void 0!==e?e:20,t=void 0!==t?t:20,r=void 0!==r?r:100,i=i||8,n=n||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var h,l,c=r/2,u=[],d=[];for(l=0;l<=n;l++){var p=[],f=[],m=l/n,g=m*(t-e)+e;for(h=0;h<=i;h++){var v=h/i,y=new Gt.Vector3;y.x=g*Math.sin(v*s+a),y.y=-m*r+c,y.z=g*Math.cos(v*s+a),this.vertices.push(y),p.push(this.vertices.length-1),f.push(new Gt.Vector2(v,1-m))}u.push(p),d.push(f)}var x,_,b=(t-e)/r;for(h=0;h<i;h++)for(0!==e?(x=this.vertices[u[0][h]].clone(),_=this.vertices[u[0][h+1]].clone()):(x=this.vertices[u[1][h]].clone(),_=this.vertices[u[1][h+1]].clone()),x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*b).normalize(),_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*b).normalize(),l=0;l<n;l++){var w=u[l][h],M=u[l+1][h],S=u[l+1][h+1],E=u[l][h+1],T=x.clone(),C=x.clone(),A=_.clone(),L=_.clone(),P=d[l][h].clone(),k=d[l+1][h].clone(),R=d[l+1][h+1].clone(),D=d[l][h+1].clone();this.faces.push(new Gt.Face3(w,M,E,[T,C,L])),this.faceVertexUvs[0].push([P,k,D]),this.faces.push(new Gt.Face3(M,S,E,[C.clone(),A,L.clone()])),this.faceVertexUvs[0].push([k.clone(),R,D.clone()])}if(!1===o&&0<e)for(this.vertices.push(new Gt.Vector3(0,c,0)),h=0;h<i;h++){w=u[0][h],M=u[0][h+1],S=this.vertices.length-1,T=new Gt.Vector3(0,1,0),C=new Gt.Vector3(0,1,0),A=new Gt.Vector3(0,1,0),P=d[0][h].clone(),k=d[0][h+1].clone(),R=new Gt.Vector2(k.x,0);this.faces.push(new Gt.Face3(w,M,S,[T,C,A],void 0,1)),this.faceVertexUvs[0].push([P,k,R])}if(!1===o&&0<t)for(this.vertices.push(new Gt.Vector3(0,-c,0)),h=0;h<i;h++){w=u[n][h+1],M=u[n][h],S=this.vertices.length-1,T=new Gt.Vector3(0,-1,0),C=new Gt.Vector3(0,-1,0),A=new Gt.Vector3(0,-1,0),P=d[n][h+1].clone(),k=d[n][h].clone(),R=new Gt.Vector2(k.x,1);this.faces.push(new Gt.Face3(w,M,S,[T,C,A],void 0,2)),this.faceVertexUvs[0].push([P,k,R])}this.computeFaceNormals()},Gt.CylinderGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.CylinderGeometry.prototype.constructor=Gt.CylinderGeometry,Gt.CylinderGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)},Gt.EdgesGeometry=function(e,t){Gt.BufferGeometry.call(this),t=void 0!==t?t:1;var r=Math.cos(Gt.Math.degToRad(t)),i=[0,0],n={};function o(e,t){return e-t}var a,s=["a","b","c"];e instanceof Gt.BufferGeometry?(a=new Gt.Geometry).fromBufferGeometry(e):a=e.clone(),a.mergeVertices(),a.computeFaceNormals();for(var h=a.vertices,l=a.faces,c=0,u=l.length;c<u;c++)for(var d=l[c],p=0;p<3;p++){i[0]=d[s[p]],i[1]=d[s[(p+1)%3]],i.sort(o),void 0===n[m=i.toString()]?n[m]={vert1:i[0],vert2:i[1],face1:c,face2:void 0}:n[m].face2=c}var f=[];for(var m in n){var g=n[m];if(void 0===g.face2||l[g.face1].normal.dot(l[g.face2].normal)<=r){var v=h[g.vert1];f.push(v.x),f.push(v.y),f.push(v.z),v=h[g.vert2],f.push(v.x),f.push(v.y),f.push(v.z)}}this.addAttribute("position",new Gt.BufferAttribute(new Float32Array(f),3))},Gt.EdgesGeometry.prototype=Object.create(Gt.BufferGeometry.prototype),Gt.EdgesGeometry.prototype.constructor=Gt.EdgesGeometry,Gt.ExtrudeGeometry=function(e,t){void 0!==e?(Gt.Geometry.call(this),this.type="ExtrudeGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeFaceNormals()):e=[]},Gt.ExtrudeGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.ExtrudeGeometry.prototype.constructor=Gt.ExtrudeGeometry,Gt.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,i=0;i<r;i++){var n=e[i];this.addShape(n,t)}},Gt.ExtrudeGeometry.prototype.addShape=function(e,t){var r,i,n,o,a,s,h,l,c=void 0!==t.amount?t.amount:100,u=void 0!==t.bevelThickness?t.bevelThickness:6,d=void 0!==t.bevelSize?t.bevelSize:u-2,p=void 0!==t.bevelSegments?t.bevelSegments:3,f=void 0===t.bevelEnabled||t.bevelEnabled,m=void 0!==t.curveSegments?t.curveSegments:12,g=void 0!==t.steps?t.steps:1,v=t.extrudePath,y=!1,x=void 0!==t.UVGenerator?t.UVGenerator:Gt.ExtrudeGeometry.WorldUVGenerator;v&&(r=v.getSpacedPoints(g),f=!(y=!0),i=void 0!==t.frames?t.frames:new Gt.TubeGeometry.FrenetFrames(v,g,!1),n=new Gt.Vector3,o=new Gt.Vector3,a=new Gt.Vector3),f||(d=u=p=0);var _=this,b=this.vertices.length,w=e.extractPoints(m),M=w.shape,S=w.holes,E=!Gt.ShapeUtils.isClockWise(M);if(E){for(M=M.reverse(),h=0,l=S.length;h<l;h++)s=S[h],Gt.ShapeUtils.isClockWise(s)&&(S[h]=s.reverse());E=!1}var T=Gt.ShapeUtils.triangulateShape(M,S),C=M;for(h=0,l=S.length;h<l;h++)s=S[h],M=M.concat(s);function A(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var L,P,k,R,D,F,V=M.length,U=T.length;function B(e,t,r){var i,n,o=1,a=e.x-t.x,s=e.y-t.y,h=r.x-e.x,l=r.y-e.y,c=a*a+s*s,u=a*l-s*h;if(Math.abs(u)>Number.EPSILON){var d=Math.sqrt(c),p=Math.sqrt(h*h+l*l),f=t.x-s/d,m=t.y+a/d,g=((r.x-l/p-f)*l-(r.y+h/p-m)*h)/(a*l-s*h),v=(i=f+a*g-e.x)*i+(n=m+s*g-e.y)*n;if(v<=2)return new Gt.Vector2(i,n);o=Math.sqrt(v/2)}else{var y=!1;a>Number.EPSILON?h>Number.EPSILON&&(y=!0):a<-Number.EPSILON?h<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(l)&&(y=!0),y?(i=-s,n=a,o=Math.sqrt(c)):(i=a,n=s,o=Math.sqrt(c/2))}return new Gt.Vector2(i/o,n/o)}for(var O=[],N=0,G=C.length,I=G-1,z=N+1;N<G;N++,I++,z++)I===G&&(I=0),z===G&&(z=0),O[N]=B(C[N],C[I],C[z]);var H,j,W=[],X=O.concat();for(h=0,l=S.length;h<l;h++){for(s=S[h],H=[],N=0,I=(G=s.length)-1,z=N+1;N<G;N++,I++,z++)I===G&&(I=0),z===G&&(z=0),H[N]=B(s[N],s[I],s[z]);W.push(H),X=X.concat(H)}for(L=0;L<p;L++){for(R=u*(1-(k=L/p)),P=d*Math.sin(k*Math.PI/2),N=0,G=C.length;N<G;N++)Y((D=A(C[N],O[N],P)).x,D.y,-R);for(h=0,l=S.length;h<l;h++)for(s=S[h],H=W[h],N=0,G=s.length;N<G;N++)Y((D=A(s[N],H[N],P)).x,D.y,-R)}for(P=d,N=0;N<V;N++)D=f?A(M[N],X[N],P):M[N],y?(o.copy(i.normals[0]).multiplyScalar(D.x),n.copy(i.binormals[0]).multiplyScalar(D.y),a.copy(r[0]).add(o).add(n),Y(a.x,a.y,a.z)):Y(D.x,D.y,0);for(j=1;j<=g;j++)for(N=0;N<V;N++)D=f?A(M[N],X[N],P):M[N],y?(o.copy(i.normals[j]).multiplyScalar(D.x),n.copy(i.binormals[j]).multiplyScalar(D.y),a.copy(r[j]).add(o).add(n),Y(a.x,a.y,a.z)):Y(D.x,D.y,c/g*j);for(L=p-1;0<=L;L--){for(R=u*(1-(k=L/p)),P=d*Math.sin(k*Math.PI/2),N=0,G=C.length;N<G;N++)Y((D=A(C[N],O[N],P)).x,D.y,c+R);for(h=0,l=S.length;h<l;h++)for(s=S[h],H=W[h],N=0,G=s.length;N<G;N++)D=A(s[N],H[N],P),y?Y(D.x,D.y+r[g-1].y,r[g-1].x+R):Y(D.x,D.y,c+R)}function q(e,t){var r,i;for(N=e.length;0<=--N;){(i=(r=N)-1)<0&&(i=e.length-1);var n=0,o=g+2*p;for(n=0;n<o;n++){var a=V*n,s=V*(n+1);Q(t+r+a,t+i+a,t+i+s,t+r+s,e,n,o,r,i)}}}function Y(e,t,r){_.vertices.push(new Gt.Vector3(e,t,r))}function K(e,t,r){e+=b,t+=b,r+=b,_.faces.push(new Gt.Face3(e,t,r,null,null,0));var i=x.generateTopUV(_,e,t,r);_.faceVertexUvs[0].push(i)}function Q(e,t,r,i,n,o,a,s,h){e+=b,t+=b,r+=b,i+=b,_.faces.push(new Gt.Face3(e,t,i,null,null,1)),_.faces.push(new Gt.Face3(t,r,i,null,null,1));var l=x.generateSideWallUV(_,e,t,r,i);_.faceVertexUvs[0].push([l[0],l[1],l[3]]),_.faceVertexUvs[0].push([l[1],l[2],l[3]])}!function(){if(f){var e=0,t=V*e;for(N=0;N<U;N++)K((F=T[N])[2]+t,F[1]+t,F[0]+t);for(t=V*(e=g+2*p),N=0;N<U;N++)K((F=T[N])[0]+t,F[1]+t,F[2]+t)}else{for(N=0;N<U;N++)K((F=T[N])[2],F[1],F[0]);for(N=0;N<U;N++)K((F=T[N])[0]+V*g,F[1]+V*g,F[2]+V*g)}}(),function(){var e=0;for(q(C,e),e+=C.length,h=0,l=S.length;h<l;h++)q(s=S[h],e),e+=s.length}()},Gt.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,i){var n=e.vertices,o=n[t],a=n[r],s=n[i];return[new Gt.Vector2(o.x,o.y),new Gt.Vector2(a.x,a.y),new Gt.Vector2(s.x,s.y)]},generateSideWallUV:function(e,t,r,i,n){var o=e.vertices,a=o[t],s=o[r],h=o[i],l=o[n];return Math.abs(a.y-s.y)<.01?[new Gt.Vector2(a.x,1-a.z),new Gt.Vector2(s.x,1-s.z),new Gt.Vector2(h.x,1-h.z),new Gt.Vector2(l.x,1-l.z)]:[new Gt.Vector2(a.y,1-a.z),new Gt.Vector2(s.y,1-s.z),new Gt.Vector2(h.y,1-h.z),new Gt.Vector2(l.y,1-l.z)]}},Gt.ShapeGeometry=function(e,t){Gt.Geometry.call(this),!(this.type="ShapeGeometry")===Array.isArray(e)&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},Gt.ShapeGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.ShapeGeometry.prototype.constructor=Gt.ShapeGeometry,Gt.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,i=e.length;r<i;r++)this.addShape(e[r],t);return this},Gt.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var r,i,n,o=void 0!==t.curveSegments?t.curveSegments:12,a=t.material,s=void 0===t.UVGenerator?Gt.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,h=this.vertices.length,l=e.extractPoints(o),c=l.shape,u=l.holes,d=!Gt.ShapeUtils.isClockWise(c);if(d){for(c=c.reverse(),r=0,i=u.length;r<i;r++)n=u[r],Gt.ShapeUtils.isClockWise(n)&&(u[r]=n.reverse());d=!1}var p=Gt.ShapeUtils.triangulateShape(c,u);for(r=0,i=u.length;r<i;r++)n=u[r],c=c.concat(n);var f,m,g=c.length,v=p.length;for(r=0;r<g;r++)f=c[r],this.vertices.push(new Gt.Vector3(f.x,f.y,0));for(r=0;r<v;r++){var y=(m=p[r])[0]+h,x=m[1]+h,_=m[2]+h;this.faces.push(new Gt.Face3(y,x,_,null,null,a)),this.faceVertexUvs[0].push(s.generateTopUV(this,y,x,_))}},Gt.LatheGeometry=function(e,t,r,i){Gt.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=t||12,r=r||0,i=i||2*Math.PI;for(var n=1/(e.length-1),o=1/t,a=0,s=t;a<=s;a++)for(var h=r+a*o*i,l=Math.cos(h),c=Math.sin(h),u=0,d=e.length;u<d;u++){var p=e[u],f=new Gt.Vector3;f.x=l*p.x-c*p.y,f.y=c*p.x+l*p.y,f.z=p.z,this.vertices.push(f)}var m=e.length;for(a=0,s=t;a<s;a++)for(u=0,d=e.length-1;u<d;u++){var g=u+m*a,v=g,y=g+m,x=(l=g+1+m,g+1),_=a*o,b=u*n,w=_+o,M=b+n;this.faces.push(new Gt.Face3(v,y,x)),this.faceVertexUvs[0].push([new Gt.Vector2(_,b),new Gt.Vector2(w,b),new Gt.Vector2(_,M)]),this.faces.push(new Gt.Face3(y,l,x)),this.faceVertexUvs[0].push([new Gt.Vector2(w,b),new Gt.Vector2(w,M),new Gt.Vector2(_,M)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},Gt.LatheGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.LatheGeometry.prototype.constructor=Gt.LatheGeometry,Gt.PlaneGeometry=function(e,t,r,i){Gt.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new Gt.PlaneBufferGeometry(e,t,r,i))},Gt.PlaneGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.PlaneGeometry.prototype.constructor=Gt.PlaneGeometry,Gt.PlaneGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)},Gt.PlaneBufferGeometry=function(e,t,r,i){Gt.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};for(var n=e/2,o=t/2,a=Math.floor(r)||1,s=Math.floor(i)||1,h=a+1,l=s+1,c=e/a,u=t/s,d=new Float32Array(h*l*3),p=new Float32Array(h*l*3),f=new Float32Array(h*l*2),m=0,g=0,v=0;v<l;v++)for(var y=v*u-o,x=0;x<h;x++){var _=x*c-n;d[m]=_,d[m+1]=-y,p[m+2]=1,f[g]=x/a,f[g+1]=1-v/s,m+=3,g+=2}m=0;var b=new(65535<d.length/3?Uint32Array:Uint16Array)(a*s*6);for(v=0;v<s;v++)for(x=0;x<a;x++){var w=x+h*v,M=x+h*(v+1),S=x+1+h*(v+1),E=x+1+h*v;b[m]=w,b[m+1]=M,b[m+2]=E,b[m+3]=M,b[m+4]=S,b[m+5]=E,m+=6}this.setIndex(new Gt.BufferAttribute(b,1)),this.addAttribute("position",new Gt.BufferAttribute(d,3)),this.addAttribute("normal",new Gt.BufferAttribute(p,3)),this.addAttribute("uv",new Gt.BufferAttribute(f,2))},Gt.PlaneBufferGeometry.prototype=Object.create(Gt.BufferGeometry.prototype),Gt.PlaneBufferGeometry.prototype.constructor=Gt.PlaneBufferGeometry,Gt.PlaneBufferGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.PlaneBufferGeometry(e.width,e.height,e.widthSegments,e.heightSegments)},Gt.RingGeometry=function(e,t,r,i,n,o){Gt.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:o},e=e||0,t=t||50,n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var a,s,h=[],l=e,c=(t-e)/(i=void 0!==i?Math.max(1,i):8);for(a=0;a<i+1;a++){for(s=0;s<r+1;s++){var u=new Gt.Vector3,d=n+s/r*o;u.x=l*Math.cos(d),u.y=l*Math.sin(d),this.vertices.push(u),h.push(new Gt.Vector2((u.x/t+1)/2,(u.y/t+1)/2))}l+=c}var p=new Gt.Vector3(0,0,1);for(a=0;a<i;a++){var f=a*(r+1);for(s=0;s<r;s++){var m=d=s+f,g=d+r+1,v=d+r+2;this.faces.push(new Gt.Face3(m,g,v,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([h[m].clone(),h[g].clone(),h[v].clone()]),g=(m=d)+r+2,v=d+1,this.faces.push(new Gt.Face3(m,g,v,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([h[m].clone(),h[g].clone(),h[v].clone()])}}this.computeFaceNormals(),this.boundingSphere=new Gt.Sphere(new Gt.Vector3,l)},Gt.RingGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.RingGeometry.prototype.constructor=Gt.RingGeometry,Gt.RingGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.RingGeometry(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)},Gt.SphereGeometry=function(e,t,r,i,n,o,a){Gt.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Gt.SphereBufferGeometry(e,t,r,i,n,o,a))},Gt.SphereGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.SphereGeometry.prototype.constructor=Gt.SphereGeometry,Gt.SphereGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.SphereGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)},Gt.SphereBufferGeometry=function(e,t,r,i,n,o,a){Gt.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:o,thetaLength:a},e=e||50,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;for(var s=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),h=(t+1)*(r+1),l=new Gt.BufferAttribute(new Float32Array(3*h),3),c=new Gt.BufferAttribute(new Float32Array(3*h),3),u=new Gt.BufferAttribute(new Float32Array(2*h),2),d=0,p=[],f=new Gt.Vector3,m=0;m<=r;m++){for(var g=[],v=m/r,y=0;y<=t;y++){var x=y/t,_=-e*Math.cos(i+x*n)*Math.sin(o+v*a),b=e*Math.cos(o+v*a),w=e*Math.sin(i+x*n)*Math.sin(o+v*a);f.set(_,b,w).normalize(),l.setXYZ(d,_,b,w),c.setXYZ(d,f.x,f.y,f.z),u.setXY(d,x,1-v),g.push(d),d++}p.push(g)}var M=[];for(m=0;m<r;m++)for(y=0;y<t;y++){var S=p[m][y+1],E=p[m][y],T=p[m+1][y],C=p[m+1][y+1];(0!==m||0<o)&&M.push(S,E,C),(m!==r-1||s<Math.PI)&&M.push(E,T,C)}this.setIndex(new(65535<l.count?Gt.Uint32Attribute:Gt.Uint16Attribute)(M,1)),this.addAttribute("position",l),this.addAttribute("normal",c),this.addAttribute("uv",u),this.boundingSphere=new Gt.Sphere(new Gt.Vector3,e)},Gt.SphereBufferGeometry.prototype=Object.create(Gt.BufferGeometry.prototype),Gt.SphereBufferGeometry.prototype.constructor=Gt.SphereBufferGeometry,Gt.SphereBufferGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.SphereBufferGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)},Gt.TorusGeometry=function(e,t,r,i,n){Gt.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},e=e||100,t=t||40,r=r||8,i=i||6,n=n||2*Math.PI;for(var o=new Gt.Vector3,a=[],s=[],h=0;h<=r;h++)for(var l=0;l<=i;l++){var c=l/i*n,u=h/r*Math.PI*2;o.x=e*Math.cos(c),o.y=e*Math.sin(c);var d=new Gt.Vector3;d.x=(e+t*Math.cos(u))*Math.cos(c),d.y=(e+t*Math.cos(u))*Math.sin(c),d.z=t*Math.sin(u),this.vertices.push(d),a.push(new Gt.Vector2(l/i,h/r)),s.push(d.clone().sub(o).normalize())}for(h=1;h<=r;h++)for(l=1;l<=i;l++){var p=(i+1)*h+l-1,f=(i+1)*(h-1)+l-1,m=(i+1)*(h-1)+l,g=(i+1)*h+l,v=new Gt.Face3(p,f,g,[s[p].clone(),s[f].clone(),s[g].clone()]);this.faces.push(v),this.faceVertexUvs[0].push([a[p].clone(),a[f].clone(),a[g].clone()]),v=new Gt.Face3(f,m,g,[s[f].clone(),s[m].clone(),s[g].clone()]),this.faces.push(v),this.faceVertexUvs[0].push([a[f].clone(),a[m].clone(),a[g].clone()])}this.computeFaceNormals()},Gt.TorusGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.TorusGeometry.prototype.constructor=Gt.TorusGeometry,Gt.TorusGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)},Gt.TorusKnotGeometry=function(e,t,r,i,n,o,a){Gt.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,p:n,q:o,heightScale:a},e=e||100,t=t||40,r=r||64,i=i||8,n=n||2,o=o||3,a=a||1;for(var s=new Array(r),h=new Gt.Vector3,l=new Gt.Vector3,c=new Gt.Vector3,u=0;u<r;++u){s[u]=new Array(i);var d=u/r*2*n*Math.PI,p=P(d,o,n,e,a),f=P(d+.01,o,n,e,a);h.subVectors(f,p),l.addVectors(f,p),c.crossVectors(h,l),l.crossVectors(c,h),c.normalize(),l.normalize();for(var m=0;m<i;++m){var g=m/i*2*Math.PI,v=-t*Math.cos(g),y=t*Math.sin(g),x=new Gt.Vector3;x.x=p.x+v*l.x+y*c.x,x.y=p.y+v*l.y+y*c.y,x.z=p.z+v*l.z+y*c.z,s[u][m]=this.vertices.push(x)-1}}for(u=0;u<r;++u)for(m=0;m<i;++m){var _=(u+1)%r,b=(m+1)%i,w=s[u][m],M=s[_][m],S=s[_][b],E=s[u][b],T=new Gt.Vector2(u/r,m/i),C=new Gt.Vector2((u+1)/r,m/i),A=new Gt.Vector2((u+1)/r,(m+1)/i),L=new Gt.Vector2(u/r,(m+1)/i);this.faces.push(new Gt.Face3(w,M,E)),this.faceVertexUvs[0].push([T,C,L]),this.faces.push(new Gt.Face3(M,S,E)),this.faceVertexUvs[0].push([C.clone(),A,L.clone()])}function P(e,t,r,i,n){var o=Math.cos(e),a=Math.sin(e),s=t/r*e,h=Math.cos(s),l=i*(2+h)*.5*o,c=i*(2+h)*a*.5,u=n*i*Math.sin(s)*.5;return new Gt.Vector3(l,c,u)}this.computeFaceNormals(),this.computeVertexNormals()},Gt.TorusKnotGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.TorusKnotGeometry.prototype.constructor=Gt.TorusKnotGeometry,Gt.TorusKnotGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.TorusKnotGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.p,e.q,e.heightScale)},Gt.TubeGeometry=function(e,t,r,i,n,o){Gt.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:r,radialSegments:i,closed:n,taper:o},t=t||64,r=r||1,i=i||8,n=n||!1,o=o||Gt.TubeGeometry.NoTaper;var a,s,h,l,c,u,d,p,f,m,g,v,y,x,_,b,w,M,S,E,T,C,A,L=[],P=this,k=t+1,R=new Gt.Vector3,D=new Gt.TubeGeometry.FrenetFrames(e,t,n),F=D.tangents,V=D.normals,U=D.binormals;for(this.tangents=F,this.normals=V,this.binormals=U,f=0;f<k;f++)for(L[f]=[],h=f/(k-1),p=e.getPointAt(h),F[f],a=V[f],s=U[f],c=r*o(h),m=0;m<i;m++)l=m/i*2*Math.PI,u=-c*Math.cos(l),d=c*Math.sin(l),R.copy(p),R.x+=u*a.x+d*s.x,R.y+=u*a.y+d*s.y,R.z+=u*a.z+d*s.z,L[f][m]=(T=R.x,C=R.y,A=R.z,P.vertices.push(new Gt.Vector3(T,C,A))-1);for(f=0;f<t;f++)for(m=0;m<i;m++)g=n?(f+1)%t:f+1,v=(m+1)%i,y=L[f][m],x=L[g][m],_=L[g][v],b=L[f][v],w=new Gt.Vector2(f/t,m/i),M=new Gt.Vector2((f+1)/t,m/i),S=new Gt.Vector2((f+1)/t,(m+1)/i),E=new Gt.Vector2(f/t,(m+1)/i),this.faces.push(new Gt.Face3(y,x,b)),this.faceVertexUvs[0].push([w,M,E]),this.faces.push(new Gt.Face3(x,_,b)),this.faceVertexUvs[0].push([M.clone(),S,E.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},Gt.TubeGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.TubeGeometry.prototype.constructor=Gt.TubeGeometry,Gt.TubeGeometry.prototype.clone=function(){return new this.constructor(this.parameters.path,this.parameters.segments,this.parameters.radius,this.parameters.radialSegments,this.parameters.closed,this.parameters.taper)},Gt.TubeGeometry.NoTaper=function(e){return 1},Gt.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},Gt.TubeGeometry.FrenetFrames=function(e,t,r){var i,n,o,a,s,h,l,c=new Gt.Vector3,u=[],d=[],p=[],f=new Gt.Vector3,m=new Gt.Matrix4,g=t+1;for(this.tangents=u,this.normals=d,this.binormals=p,h=0;h<g;h++)l=h/(g-1),u[h]=e.getTangentAt(l),u[h].normalize();for(function(){d[0]=new Gt.Vector3,p[0]=new Gt.Vector3,n=Number.MAX_VALUE,o=Math.abs(u[0].x),a=Math.abs(u[0].y),s=Math.abs(u[0].z),o<=n&&(n=o,c.set(1,0,0));a<=n&&(n=a,c.set(0,1,0));s<=n&&c.set(0,0,1);f.crossVectors(u[0],c).normalize(),d[0].crossVectors(u[0],f),p[0].crossVectors(u[0],d[0])}(),h=1;h<g;h++)d[h]=d[h-1].clone(),p[h]=p[h-1].clone(),f.crossVectors(u[h-1],u[h]),f.length()>Number.EPSILON&&(f.normalize(),i=Math.acos(Gt.Math.clamp(u[h-1].dot(u[h]),-1,1)),d[h].applyMatrix4(m.makeRotationAxis(f,i))),p[h].crossVectors(u[h],d[h]);if(r)for(i=Math.acos(Gt.Math.clamp(d[0].dot(d[g-1]),-1,1)),i/=g-1,0<u[0].dot(f.crossVectors(d[0],d[g-1]))&&(i=-i),h=1;h<g;h++)d[h].applyMatrix4(m.makeRotationAxis(u[h],i*h)),p[h].crossVectors(u[h],d[h])},Gt.PolyhedronGeometry=function(e,t,r,i){Gt.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},r=r||1,i=i||0;for(var f=this,n=0,o=e.length;n<o;n+=3)_(new Gt.Vector3(e[n],e[n+1],e[n+2]));var a=this.vertices,s=[],h=(n=0,0);for(o=t.length;n<o;n+=3,h++){var l=a[t[n]],c=a[t[n+1]],u=a[t[n+2]];s[h]=new Gt.Face3(l.index,c.index,u.index,[l.clone(),c.clone(),u.clone()],void 0,h)}var d=new Gt.Vector3;for(n=0,o=s.length;n<o;n++)w(s[n],i);for(n=0,o=this.faceVertexUvs[0].length;n<o;n++){var p=this.faceVertexUvs[0][n],m=p[0].x,g=p[1].x,v=p[2].x,y=Math.max(m,g,v),x=Math.min(m,g,v);.9<y&&x<.1&&(m<.2&&(p[0].x+=1),g<.2&&(p[1].x+=1),v<.2&&(p[2].x+=1))}for(n=0,o=this.vertices.length;n<o;n++)this.vertices[n].multiplyScalar(r);function _(e){var t=e.normalize().clone();t.index=f.vertices.push(t)-1;var r,i=M(e)/2/Math.PI+.5,n=(r=e,Math.atan2(-r.y,Math.sqrt(r.x*r.x+r.z*r.z))/Math.PI+.5);return t.uv=new Gt.Vector2(i,1-n),t}function b(e,t,r,i){var n=new Gt.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()],void 0,i);f.faces.push(n),d.copy(e).add(t).add(r).divideScalar(3);var o=M(d);f.faceVertexUvs[0].push([S(e.uv,e,o),S(t.uv,t,o),S(r.uv,r,o)])}function w(e,t){for(var r=Math.pow(2,t),i=_(f.vertices[e.a]),n=_(f.vertices[e.b]),o=_(f.vertices[e.c]),a=[],s=e.materialIndex,h=0;h<=r;h++){a[h]=[];for(var l=_(i.clone().lerp(o,h/r)),c=_(n.clone().lerp(o,h/r)),u=r-h,d=0;d<=u;d++)a[h][d]=0===d&&h===r?l:_(l.clone().lerp(c,d/u))}for(h=0;h<r;h++)for(d=0;d<2*(r-h)-1;d++){var p=Math.floor(d/2);d%2==0?b(a[h][p+1],a[h+1][p],a[h][p],s):b(a[h][p+1],a[h+1][p+1],a[h+1][p],s)}}function M(e){return Math.atan2(e.z,-e.x)}function S(e,t,r){return r<0&&1===e.x&&(e=new Gt.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new Gt.Vector2(r/2/Math.PI+.5,e.y)),e.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new Gt.Sphere(new Gt.Vector3,r)},Gt.PolyhedronGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.PolyhedronGeometry.prototype.constructor=Gt.PolyhedronGeometry,Gt.PolyhedronGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.PolyhedronGeometry(e.vertices,e.indices,e.radius,e.detail)},Gt.DodecahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2,i=1/r,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i];Gt.PolyhedronGeometry.call(this,n,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}},Gt.DodecahedronGeometry.prototype=Object.create(Gt.PolyhedronGeometry.prototype),Gt.DodecahedronGeometry.prototype.constructor=Gt.DodecahedronGeometry,Gt.DodecahedronGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.DodecahedronGeometry(e.radius,e.detail)},Gt.IcosahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];Gt.PolyhedronGeometry.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},Gt.IcosahedronGeometry.prototype=Object.create(Gt.PolyhedronGeometry.prototype),Gt.IcosahedronGeometry.prototype.constructor=Gt.IcosahedronGeometry,Gt.IcosahedronGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.IcosahedronGeometry(e.radius,e.detail)},Gt.OctahedronGeometry=function(e,t){Gt.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},Gt.OctahedronGeometry.prototype=Object.create(Gt.PolyhedronGeometry.prototype),Gt.OctahedronGeometry.prototype.constructor=Gt.OctahedronGeometry,Gt.OctahedronGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.OctahedronGeometry(e.radius,e.detail)},Gt.TetrahedronGeometry=function(e,t){Gt.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},Gt.TetrahedronGeometry.prototype=Object.create(Gt.PolyhedronGeometry.prototype),Gt.TetrahedronGeometry.prototype.constructor=Gt.TetrahedronGeometry,Gt.TetrahedronGeometry.prototype.clone=function(){var e=this.parameters;return new Gt.TetrahedronGeometry(e.radius,e.detail)},Gt.ParametricGeometry=function(e,t,r){Gt.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r};var i,n,o,a,s,h,l,c,u,d,p,f,m=this.vertices,g=this.faces,v=this.faceVertexUvs[0],y=t+1;for(i=0;i<=r;i++)for(a=i/r,n=0;n<=t;n++)o=e(n/t,a),m.push(o);for(i=0;i<r;i++)for(n=0;n<t;n++)h=(s=i*y+n)+1,l=(i+1)*y+n+1,c=(i+1)*y+n,u=new Gt.Vector2(n/t,i/r),d=new Gt.Vector2((n+1)/t,i/r),p=new Gt.Vector2((n+1)/t,(i+1)/r),f=new Gt.Vector2(n/t,(i+1)/r),g.push(new Gt.Face3(s,h,c)),v.push([u,d,f]),g.push(new Gt.Face3(h,l,c)),v.push([d.clone(),p,f.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},Gt.ParametricGeometry.prototype=Object.create(Gt.Geometry.prototype),Gt.ParametricGeometry.prototype.constructor=Gt.ParametricGeometry,Gt.WireframeGeometry=function(e){Gt.BufferGeometry.call(this);var t=[0,0],r={};function i(e,t){return e-t}var n=["a","b","c"];if(e instanceof Gt.Geometry){for(var o=e.vertices,a=e.faces,s=0,h=new Uint32Array(6*a.length),l=0,c=a.length;l<c;l++)for(var u=a[l],d=0;d<3;d++){t[0]=u[n[d]],t[1]=u[n[(d+1)%3]],t.sort(i),void 0===r[w=t.toString()]&&(h[2*s]=t[0],h[2*s+1]=t[1],r[w]=!0,s++)}var p=new Float32Array(2*s*3);for(l=0,c=s;l<c;l++)for(d=0;d<2;d++){var f=o[h[2*l+d]];p[(M=6*l+3*d)+0]=f.x,p[M+1]=f.y,p[M+2]=f.z}this.addAttribute("position",new Gt.BufferAttribute(p,3))}else if(e instanceof Gt.BufferGeometry)if(null!==e.index){var m=e.index.array,g=(o=e.attributes.position,e.drawcalls);s=0;0===g.length&&e.addGroup(0,m.length);h=new Uint32Array(2*m.length);for(var v=0,y=g.length;v<y;++v)for(var x=g[v],_=x.start,b=(l=_,_+x.count);l<b;l+=3)for(d=0;d<3;d++){var w;t[0]=m[l+d],t[1]=m[l+(d+1)%3],t.sort(i),void 0===r[w=t.toString()]&&(h[2*s]=t[0],h[2*s+1]=t[1],r[w]=!0,s++)}for(p=new Float32Array(2*s*3),l=0,c=s;l<c;l++)for(d=0;d<2;d++){var M=6*l+3*d,S=h[2*l+d];p[M+0]=o.getX(S),p[M+1]=o.getY(S),p[M+2]=o.getZ(S)}this.addAttribute("position",new Gt.BufferAttribute(p,3))}else{var E=(s=(o=e.attributes.position.array).length/3)/3;for(p=new Float32Array(2*s*3),l=0,c=E;l<c;l++)for(d=0;d<3;d++){var T=9*l+3*d;p[(M=18*l+6*d)+0]=o[T],p[M+1]=o[T+1],p[M+2]=o[T+2];S=9*l+(d+1)%3*3;p[M+3]=o[S],p[M+4]=o[S+1],p[M+5]=o[S+2]}this.addAttribute("position",new Gt.BufferAttribute(p,3))}},Gt.WireframeGeometry.prototype=Object.create(Gt.BufferGeometry.prototype),Gt.WireframeGeometry.prototype.constructor=Gt.WireframeGeometry,Gt.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),r=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),i=new Gt.BufferGeometry;i.addAttribute("position",new Gt.BufferAttribute(t,3)),i.addAttribute("color",new Gt.BufferAttribute(r,3));var n=new Gt.LineBasicMaterial({vertexColors:Gt.VertexColors});Gt.LineSegments.call(this,i,n)},Gt.AxisHelper.prototype=Object.create(Gt.LineSegments.prototype),Gt.AxisHelper.prototype.constructor=Gt.AxisHelper,Gt.ArrowHelper=function(){var a=new Gt.Geometry;a.vertices.push(new Gt.Vector3(0,0,0),new Gt.Vector3(0,1,0));var s=new Gt.CylinderGeometry(0,.5,1,5,1);return s.translate(0,-.5,0),function(e,t,r,i,n,o){Gt.Object3D.call(this),void 0===i&&(i=16776960),void 0===r&&(r=1),void 0===n&&(n=.2*r),void 0===o&&(o=.2*n),this.position.copy(t),n<r&&(this.line=new Gt.Line(a,new Gt.LineBasicMaterial({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line)),this.cone=new Gt.Mesh(s,new Gt.MeshBasicMaterial({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,n,o)}}(),Gt.ArrowHelper.prototype=Object.create(Gt.Object3D.prototype),Gt.ArrowHelper.prototype.constructor=Gt.ArrowHelper,Gt.ArrowHelper.prototype.setDirection=(Et=new Gt.Vector3,function(e){.99999<e.y?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(Et.set(e.z,0,-e.x).normalize(),St=Math.acos(e.y),this.quaternion.setFromAxisAngle(Et,St))}),Gt.ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),t<e&&(this.line.scale.set(1,e-t,1),this.line.updateMatrix()),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},Gt.ArrowHelper.prototype.setColor=function(e){void 0!==this.line&&this.line.material.color.set(e),this.cone.material.color.set(e)},Gt.BoxHelper=function(e){var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Gt.BufferGeometry;i.setIndex(new Gt.BufferAttribute(t,1)),i.addAttribute("position",new Gt.BufferAttribute(r,3)),Gt.LineSegments.call(this,i,new Gt.LineBasicMaterial({color:16776960})),void 0!==e&&this.update(e)},Gt.BoxHelper.prototype=Object.create(Gt.LineSegments.prototype),Gt.BoxHelper.prototype.constructor=Gt.BoxHelper,Gt.BoxHelper.prototype.update=(Tt=new Gt.Box3,function(e){if(Tt.setFromObject(e),!Tt.empty()){var t=Tt.min,r=Tt.max,i=this.geometry.attributes.position,n=i.array;n[0]=r.x,n[1]=r.y,n[2]=r.z,n[3]=t.x,n[4]=r.y,n[5]=r.z,n[6]=t.x,n[7]=t.y,n[8]=r.z,n[9]=r.x,n[10]=t.y,n[11]=r.z,n[12]=r.x,n[13]=r.y,n[14]=t.z,n[15]=t.x,n[16]=r.y,n[17]=t.z,n[18]=t.x,n[19]=t.y,n[20]=t.z,n[21]=r.x,n[22]=t.y,n[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}),Gt.BoundingBoxHelper=function(e,t){var r=void 0!==t?t:8947848;this.object=e,this.box=new Gt.Box3,Gt.Mesh.call(this,new Gt.BoxGeometry(1,1,1),new Gt.MeshBasicMaterial({color:r,wireframe:!0}))},Gt.BoundingBoxHelper.prototype=Object.create(Gt.Mesh.prototype),Gt.BoundingBoxHelper.prototype.constructor=Gt.BoundingBoxHelper,Gt.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},Gt.CameraHelper=function(e){var r=new Gt.Geometry,t=new Gt.LineBasicMaterial({color:16777215,vertexColors:Gt.FaceColors}),i={},n=16755200,o=16711680,a=3355443;function s(e,t,r){h(e,r),h(t,r)}function h(e,t){r.vertices.push(new Gt.Vector3),r.colors.push(new Gt.Color(t)),void 0===i[e]&&(i[e]=[]),i[e].push(r.vertices.length-1)}s("n1","n2",n),s("n2","n4",n),s("n4","n3",n),s("n3","n1",n),s("f1","f2",n),s("f2","f4",n),s("f4","f3",n),s("f3","f1",n),s("n1","f1",n),s("n2","f2",n),s("n3","f3",n),s("n4","f4",n),s("p","n1",o),s("p","n2",o),s("p","n3",o),s("p","n4",o),s("u1","u2",43775),s("u2","u3",43775),s("u3","u1",43775),s("c","t",16777215),s("p","c",a),s("cn1","cn2",a),s("cn3","cn4",a),s("cf1","cf2",a),s("cf3","cf4",a),Gt.LineSegments.call(this,r,t),this.camera=e,this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=i,this.update()},Gt.CameraHelper.prototype=Object.create(Gt.LineSegments.prototype),Gt.CameraHelper.prototype.constructor=Gt.CameraHelper;Gt.CameraHelper.prototype.update=function(){var s,h,l=new Gt.Vector3,c=new Gt.Camera;function e(e,t,r,i){l.set(t,r,i).unproject(c);var n=h[e];if(void 0!==n)for(var o=0,a=n.length;o<a;o++)s.vertices[n[o]].copy(l)}return function(){s=this.geometry,h=this.pointMap;c.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),s.verticesNeedUpdate=!0}}(),Gt.DirectionalLightHelper=function(e,t){Gt.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var r=new Gt.Geometry;r.vertices.push(new Gt.Vector3(-t,t,0),new Gt.Vector3(t,t,0),new Gt.Vector3(t,-t,0),new Gt.Vector3(-t,-t,0),new Gt.Vector3(-t,t,0));var i=new Gt.LineBasicMaterial({fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new Gt.Line(r,i),this.add(this.lightPlane),(r=new Gt.Geometry).vertices.push(new Gt.Vector3,new Gt.Vector3),(i=new Gt.LineBasicMaterial({fog:!1})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new Gt.Line(r,i),this.add(this.targetLine),this.update()},Gt.DirectionalLightHelper.prototype=Object.create(Gt.Object3D.prototype),Gt.DirectionalLightHelper.prototype.constructor=Gt.DirectionalLightHelper,Gt.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Gt.DirectionalLightHelper.prototype.update=(Ct=new Gt.Vector3,At=new Gt.Vector3,Lt=new Gt.Vector3,function(){Ct.setFromMatrixPosition(this.light.matrixWorld),At.setFromMatrixPosition(this.light.target.matrixWorld),Lt.subVectors(At,Ct),this.lightPlane.lookAt(Lt),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(Lt),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}),Gt.EdgesHelper=function(e,t,r){var i=void 0!==t?t:16777215;Gt.LineSegments.call(this,new Gt.EdgesGeometry(e.geometry,r),new Gt.LineBasicMaterial({color:i})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},Gt.EdgesHelper.prototype=Object.create(Gt.LineSegments.prototype),Gt.EdgesHelper.prototype.constructor=Gt.EdgesHelper,Gt.FaceNormalsHelper=function(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==r?r:16776960,o=void 0!==i?i:1,a=0,s=this.object.geometry;s instanceof Gt.Geometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var h=new Gt.BufferGeometry,l=new Gt.Float32Attribute(2*a*3,3);h.addAttribute("position",l),Gt.LineSegments.call(this,h,new Gt.LineBasicMaterial({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()},Gt.FaceNormalsHelper.prototype=Object.create(Gt.LineSegments.prototype),Gt.FaceNormalsHelper.prototype.constructor=Gt.FaceNormalsHelper,Gt.FaceNormalsHelper.prototype.update=(Pt=new Gt.Vector3,kt=new Gt.Vector3,Rt=new Gt.Matrix3,function(){this.object.updateMatrixWorld(!0),Rt.getNormalMatrix(this.object.matrixWorld);for(var e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry,i=r.vertices,n=r.faces,o=0,a=0,s=n.length;a<s;a++){var h=n[a],l=h.normal;Pt.copy(i[h.a]).add(i[h.b]).add(i[h.c]).divideScalar(3).applyMatrix4(e),kt.copy(l).applyMatrix3(Rt).normalize().multiplyScalar(this.size).add(Pt),t.setXYZ(o,Pt.x,Pt.y,Pt.z),o+=1,t.setXYZ(o,kt.x,kt.y,kt.z),o+=1}return t.needsUpdate=!0,this}),Gt.GridHelper=function(e,t){var r=new Gt.Geometry,i=new Gt.LineBasicMaterial({vertexColors:Gt.VertexColors});this.color1=new Gt.Color(4473924),this.color2=new Gt.Color(8947848);for(var n=-e;n<=e;n+=t){r.vertices.push(new Gt.Vector3(-e,0,n),new Gt.Vector3(e,0,n),new Gt.Vector3(n,0,-e),new Gt.Vector3(n,0,e));var o=0===n?this.color1:this.color2;r.colors.push(o,o,o,o)}Gt.LineSegments.call(this,r,i)},Gt.GridHelper.prototype=Object.create(Gt.LineSegments.prototype),Gt.GridHelper.prototype.constructor=Gt.GridHelper,Gt.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},Gt.HemisphereLightHelper=function(e,t){Gt.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new Gt.Color,new Gt.Color];var r=new Gt.SphereGeometry(t,4,2);r.rotateX(-Math.PI/2);for(var i=0;i<8;i++)r.faces[i].color=this.colors[i<4?0:1];var n=new Gt.MeshBasicMaterial({vertexColors:Gt.FaceColors,wireframe:!0});this.lightSphere=new Gt.Mesh(r,n),this.add(this.lightSphere),this.update()},Gt.HemisphereLightHelper.prototype=Object.create(Gt.Object3D.prototype),Gt.HemisphereLightHelper.prototype.constructor=Gt.HemisphereLightHelper,Gt.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},Gt.HemisphereLightHelper.prototype.update=(Dt=new Gt.Vector3,function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(Dt.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}),Gt.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var r=new Gt.SphereGeometry(t,4,2),i=new Gt.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),Gt.Mesh.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},Gt.PointLightHelper.prototype=Object.create(Gt.Mesh.prototype),Gt.PointLightHelper.prototype.constructor=Gt.PointLightHelper,Gt.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Gt.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},Gt.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new Gt.Geometry,r=0;r<this.bones.length;r++){this.bones[r].parent instanceof Gt.Bone&&(t.vertices.push(new Gt.Vector3),t.vertices.push(new Gt.Vector3),t.colors.push(new Gt.Color(0,0,1)),t.colors.push(new Gt.Color(0,1,0)))}t.dynamic=!0;var i=new Gt.LineBasicMaterial({vertexColors:Gt.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});Gt.LineSegments.call(this,t,i),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},Gt.SkeletonHelper.prototype=Object.create(Gt.LineSegments.prototype),Gt.SkeletonHelper.prototype.constructor=Gt.SkeletonHelper,Gt.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof Gt.Bone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,this.getBoneList(e.children[r]));return t},Gt.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new Gt.Matrix4).getInverse(this.root.matrixWorld),r=new Gt.Matrix4,i=0,n=0;n<this.bones.length;n++){var o=this.bones[n];o.parent instanceof Gt.Bone&&(r.multiplyMatrices(t,o.matrixWorld),e.vertices[i].setFromMatrixPosition(r),r.multiplyMatrices(t,o.parent.matrixWorld),e.vertices[i+1].setFromMatrixPosition(r),i+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},Gt.SpotLightHelper=function(e){Gt.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new Gt.CylinderGeometry(0,1,1,8,1,!0);t.translate(0,-.5,0),t.rotateX(-Math.PI/2);var r=new Gt.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new Gt.Mesh(t,r),this.add(this.cone),this.update()},Gt.SpotLightHelper.prototype=Object.create(Gt.Object3D.prototype),Gt.SpotLightHelper.prototype.constructor=Gt.SpotLightHelper,Gt.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Gt.SpotLightHelper.prototype.update=(Ft=new Gt.Vector3,Vt=new Gt.Vector3,function(){var e=this.light.distance?this.light.distance:1e4,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Ft.setFromMatrixPosition(this.light.matrixWorld),Vt.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Vt.sub(Ft)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}),Gt.VertexNormalsHelper=function(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==r?r:16711680,o=void 0!==i?i:1,a=0,s=this.object.geometry;s instanceof Gt.Geometry?a=3*s.faces.length:s instanceof Gt.BufferGeometry&&(a=s.attributes.normal.count);var h=new Gt.BufferGeometry,l=new Gt.Float32Attribute(2*a*3,3);h.addAttribute("position",l),Gt.LineSegments.call(this,h,new Gt.LineBasicMaterial({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()},Gt.VertexNormalsHelper.prototype=Object.create(Gt.LineSegments.prototype),Gt.VertexNormalsHelper.prototype.constructor=Gt.VertexNormalsHelper,Gt.VertexNormalsHelper.prototype.update=(Ut=new Gt.Vector3,Bt=new Gt.Vector3,Ot=new Gt.Matrix3,function(){var e=["a","b","c"];this.object.updateMatrixWorld(!0),Ot.getNormalMatrix(this.object.matrixWorld);var t=this.object.matrixWorld,r=this.geometry.attributes.position,i=this.object.geometry;if(i instanceof Gt.Geometry)for(var n=i.vertices,o=i.faces,a=0,s=0,h=o.length;s<h;s++)for(var l=o[s],c=0,u=l.vertexNormals.length;c<u;c++){var d=n[l[e[c]]],p=l.vertexNormals[c];Ut.copy(d).applyMatrix4(t),Bt.copy(p).applyMatrix3(Ot).normalize().multiplyScalar(this.size).add(Ut),r.setXYZ(a,Ut.x,Ut.y,Ut.z),a+=1,r.setXYZ(a,Bt.x,Bt.y,Bt.z),a+=1}else if(i instanceof Gt.BufferGeometry){var f=i.attributes.position,m=i.attributes.normal;for(c=a=0,u=f.count;c<u;c++)Ut.set(f.getX(c),f.getY(c),f.getZ(c)).applyMatrix4(t),Bt.set(m.getX(c),m.getY(c),m.getZ(c)),Bt.applyMatrix3(Ot).normalize().multiplyScalar(this.size).add(Ut),r.setXYZ(a,Ut.x,Ut.y,Ut.z),a+=1,r.setXYZ(a,Bt.x,Bt.y,Bt.z),a+=1}return r.needsUpdate=!0,this}),Gt.WireframeHelper=function(e,t){var r=void 0!==t?t:16777215;Gt.LineSegments.call(this,new Gt.WireframeGeometry(e.geometry),new Gt.LineBasicMaterial({color:r})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},Gt.WireframeHelper.prototype=Object.create(Gt.LineSegments.prototype),Gt.WireframeHelper.prototype.constructor=Gt.WireframeHelper,Gt.ImmediateRenderObject=function(e){Gt.Object3D.call(this),this.material=e,this.render=function(e){}},Gt.ImmediateRenderObject.prototype=Object.create(Gt.Object3D.prototype),Gt.ImmediateRenderObject.prototype.constructor=Gt.ImmediateRenderObject,Gt.MorphBlendMesh=function(e,t){Gt.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,i=r-1,n=r/1;this.createAnimation("__default",0,i,n),this.setAnimationWeight("__default",1)},Gt.MorphBlendMesh.prototype=Object.create(Gt.Mesh.prototype),Gt.MorphBlendMesh.prototype.constructor=Gt.MorphBlendMesh,Gt.MorphBlendMesh.prototype.createAnimation=function(e,t,r,i){var n={start:t,end:r,length:r-t+1,fps:i,duration:(r-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},Gt.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,r=/([a-z]+)_?(\d+)/,i={},n=this.geometry,o=0,a=n.morphTargets.length;o<a;o++){var s=n.morphTargets[o].name.match(r);if(s&&1<s.length)i[h=s[1]]||(i[h]={start:1/0,end:-1/0}),o<(l=i[h]).start&&(l.start=o),o>l.end&&(l.end=o),t||(t=h)}for(var h in i){var l=i[h];this.createAnimation(h,l.start,l.end,e)}this.firstAnimation=t},Gt.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},Gt.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},Gt.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},Gt.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},Gt.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},Gt.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},Gt.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},Gt.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},Gt.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},Gt.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},Gt.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;t<r;t++){var i=this.animationsList[t];if(i.active){var n=i.duration/i.length;i.time+=i.direction*e,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration));var o=i.start+Gt.Math.clamp(Math.floor(i.time/n),0,i.length-1),a=i.weight;o!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*a,this.morphTargetInfluences[o]=0,i.lastFrame=i.currentFrame,i.currentFrame=o);var s=i.time%n/n;i.directionBackwards&&(s=1-s),i.currentFrame!==i.lastFrame?(this.morphTargetInfluences[i.currentFrame]=s*a,this.morphTargetInfluences[i.lastFrame]=(1-s)*a):this.morphTargetInfluences[i.currentFrame]=a}}},void 0!==r?(void 0!==t&&t.exports&&(r=t.exports=Gt),r.THREE=Gt):this.THREE=Gt},{}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}();function n(e){return e&&e.__esModule?e:{default:e}}var o=n(e("dat-gui")),a=n(e("stats-js")),s=n(e("three.js")),h=(n(e("./ScenePass")),e("three-orbit-controls")(s.default)),l=e("./PyramidBloomPass")(s.default);e("./EffectComposer")(s.default);var c=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.renderer=null,this.camera=null,this.scene=null,this.counter=0,this.gui=null,this.clock=new s.default.Clock,this.DEBUG=!1,this.SIZE={w:window.innerWidth,w2:window.innerWidth/2,h:window.innerHeight,h2:window.innerHeight/2},this.startStats(),this.createRender(),this.createScene(),this.startGUI(),this.addObjects(),this.addComposer(),this.onResize(),this.update()}return i(t,[{key:"startStats",value:function(){this.stats=new a.default,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top=0,this.stats.domElement.style.display=this.DEBUG?"block":"none",this.stats.domElement.style.left=0,this.stats.domElement.style.zIndex=50,document.body.appendChild(this.stats.domElement),document.querySelector(".help")&&(document.querySelector(".help").style.display="block"==this.stats.domElement.style.display?"none":"block")}},{key:"createRender",value:function(){this.renderer=new s.default.WebGLRenderer({antialias:!1}),this.renderer.setClearColor(0),this.renderer.setClearAlpha(0),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.gammaInput=!0,this.renderer.gammaOuput=!1,this.renderer.autoClear=!1,document.body.appendChild(this.renderer.domElement)}},{key:"createScene",value:function(){this.camera=new s.default.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.01,4e3),this.camera.position.set(0,0,15),this.controls=new h(this.camera,this.renderer.domElement),this.controls.maxDistance=500,this.scene=new s.default.Scene}},{key:"addObjects",value:function(){this.sys=this.createParticleSystem(),this.scene.add(this.sys)}},{key:"addComposer",value:function(){this.composer=new s.default.EffectComposer(this.renderer);var e=new s.default.RenderPass(this.scene,this.camera,!1,0,0),t=new s.default.ShaderPass(s.default.CopyShader);this.gamma={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new s.default.Vector2(window.innerWidth*(window.devicePixelRatio||1),window.innerHeight*(window.devicePixelRatio||1))}},vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define GLSLIFY 1\nfloat FXAA_REDUCE_MIN_0_0  = (1.0/128.0);\nfloat FXAA_REDUCE_MUL_0_1  = (1.0/8.0);\nfloat FXAA_SPAN_MAX_0_2    = 8.0;\n\nvec4 fxaa_0_3(sampler2D tDiffuse, vec2 xyFragCoord, vec2 res) {\n\n   vec2 resolution = vec2( 1.0/res.x, 1.0/res.y );\n   vec4 color;\n\n   vec3 rgbNW = texture2D( tDiffuse, ( xyFragCoord + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\n   vec3 rgbNE = texture2D( tDiffuse, ( xyFragCoord + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\n   vec3 rgbSW = texture2D( tDiffuse, ( xyFragCoord + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\n   vec3 rgbSE = texture2D( tDiffuse, ( xyFragCoord + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\n   vec4 rgbaM  = texture2D( tDiffuse,  xyFragCoord  * resolution );\n   vec3 rgbM  = rgbaM.xyz;\n   vec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n   float lumaNW = dot( rgbNW, luma );\n   float lumaNE = dot( rgbNE, luma );\n   float lumaSW = dot( rgbSW, luma );\n   float lumaSE = dot( rgbSE, luma );\n   float lumaM  = dot( rgbM,  luma );\n   float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\n   float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\n\n   vec2 dir;\n   dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n   dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n   float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL_0_1 ), FXAA_REDUCE_MIN_0_0 );\n   float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\n   dir = min( vec2( FXAA_SPAN_MAX_0_2, FXAA_SPAN_MAX_0_2), max( vec2(-FXAA_SPAN_MAX_0_2, -FXAA_SPAN_MAX_0_2), dir * rcpDirMin)) * resolution;\n   vec4 rgbA = (1.0/2.0) * (\n   texture2D(tDiffuse,  xyFragCoord  * resolution + dir * (1.0/3.0 - 0.5)) +\n   texture2D(tDiffuse,  xyFragCoord  * resolution + dir * (2.0/3.0 - 0.5)));\n   vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n   texture2D(tDiffuse,  xyFragCoord  * resolution + dir * (0.0/3.0 - 0.5)) +\n   texture2D(tDiffuse,  xyFragCoord  * resolution + dir * (3.0/3.0 - 0.5)));\n   float lumaB = dot(rgbB, vec4(luma, 0.0));\n\n   if(( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\n       color = rgbA;\n   }else{\n       color = rgbB;\n   }\n\n    return color;\n}\n\nvarying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 resolution;\n\nvoid main() {\n\n    vec2 fragCoord = vUv * resolution;\n    vec4 texel = fxaa_0_3(tDiffuse, fragCoord, resolution);\n\n    vec2 res = (gl_FragCoord.xy / resolution.xy) - vec2(0.5);\n    res.x *= resolution.x / resolution.y;\n\n    // vec4 texel = texture2D( tDiffuse, vUv );\n\n    // vignette\n    float len = length(res);\n    float vignette = smoothstep(.85, .5, len);\n\n    texel = pow(texel, vec4(3.)) * vignette;\n\n    gl_FragColor = texel;\n\n}"},this.composer.addPass(e),this.composer.addPass(t),this.bloom=new l,this.composer.addPass(this.bloom);var r=new s.default.ShaderPass(this.gamma);r.renderToScreen=!0,this.composer.addPass(r)}},{key:"createParticleSystem",value:function(){for(var e=new s.default.ShaderMaterial({uniforms:{color:{type:"c",value:new s.default.Color(16777215)},time:{type:"f",value:0}},transparent:!0,vertexShader:"#define GLSLIFY 1\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289_0_0(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289_0_0(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute_0_1(vec4 x) {\n     return mod289_0_0(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt_0_2(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise_0_3(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D_0_4 = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g_0_5 = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g_0_5;\n  vec3 i1 = min( g_0_5.xyz, l.zxy );\n  vec3 i2 = max( g_0_5.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D_0_4.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289_0_0(i);\n  vec4 p = permute_0_1( permute_0_1( permute_0_1(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D_0_4.wyz - D_0_4.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1_0_6 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0_0_7 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1_0_6.xy,h.z);\n  vec3 p3 = vec3(a1_0_6.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt_0_2(vec4(dot(p0_0_7,p0_0_7), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0_0_7 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0_0_7,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\nvec3 snoiseVec3_1_8( vec3 x ){\n\n  float s  = snoise_0_3(vec3( x ));\n  float s1 = snoise_0_3(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = snoise_0_3(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n\n}\n\nvec3 curlNoise_1_9( vec3 p ){\n  \n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3_1_8( p - dx );\n  vec3 p_x1 = snoiseVec3_1_8( p + dx );\n  vec3 p_y0 = snoiseVec3_1_8( p - dy );\n  vec3 p_y1 = snoiseVec3_1_8( p + dy );\n  vec3 p_z0 = snoiseVec3_1_8( p - dz );\n  vec3 p_z1 = snoiseVec3_1_8( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n\n}\n\n// varying vec2 vUv;\n// varying vec3 vPosition;\n\nuniform float time;\nattribute float _index;\n\nvoid main()\n{\n    float multiplier = -10.;\n\n    vec3 curlP = curlNoise_1_9(position + (time));\n    // curlP.x = curlP.x * smoothstep(0., 200., curlP.z);\n    curlP *= multiplier;\n\n    // curlP.z = position.z;\n\n    // curlP.y = abs(curlP.y);\n    // curlP.y += 1. / _index;\n\n    // vPosition = curlP;\n    // vUv = uv;\n\n    gl_PointSize = 1.;\n\n    vec4 mvPosition = modelViewMatrix * vec4( curlP, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"#define GLSLIFY 1\n// varying vec3 vPosition;\n// varying vec3 vColor;\nuniform vec3 color;\n\nvoid main() {\n\n    // float alpha = 7. - abs(distance(vPosition.xy, vec2(.0)));\n\n    gl_FragColor = vec4( color , .4 );\n    // gl_FragColor = gl_FragColor * texture2D( texture, vUv );\n}"}),t=Math.pow(512,2),r=new s.default.BufferGeometry,i=new Float32Array(3*t),n=0,o=0;n<i.length;n+=3,o++)i[n+0]=this.SIZE.w2/550-Math.random()*this.SIZE.w2/275,i[n+1]=this.SIZE.h2/550-Math.random()*this.SIZE.h2/275,i[n+2]=0;return r.addAttribute("position",new s.default.BufferAttribute(i,3)),new s.default.Points(r,e)}},{key:"startGUI",value:function(){this.gui=new o.default.GUI,this.gui.domElement.style.display=this.DEBUG?"block":"none"}},{key:"update",value:function(){this.stats.begin();var e=.05*this.clock.getElapsedTime(),t=this.clock.getDelta();this.renderer.clear(),this.sys.material.uniforms.time.value=e,this.sys.rotation.x+=.001,this.composer.render(t),this.stats.end(),requestAnimationFrame(this.update.bind(this))}},{key:"onKeyUp",value:function(e){switch(e.which||e.keyCode){case 68:this.stats.domElement.style.display="block"==this.stats.domElement.style.display?"none":"block",this.gui.domElement.style.display="block"==this.gui.domElement.style.display?"none":"block",document.querySelector(".help").style.display="block"==this.gui.domElement.style.display?"none":"block"}}},{key:"onResize",value:function(){this.SIZE={w:window.innerWidth,w2:window.innerWidth/2,h:window.innerHeight,h2:window.innerHeight/2},this.renderer.setSize(window.innerWidth,window.innerHeight),this.composer.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}}]),t}();r.default=c,t.exports=r.default},{"./EffectComposer":9,"./PyramidBloomPass":10,"./ScenePass":11,"dat-gui":1,"stats-js":4,"three-orbit-controls":5,"three.js":6}],9:[function(e,t,r){"use strict";t.exports=function(a){a.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},a.EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var r=e.getPixelRatio(),i=Math.floor(e.context.canvas.width/r)||1,n=Math.floor(e.context.canvas.height/r)||1,o={minFilter:a.LinearFilter,magFilter:a.LinearFilter,stencilBuffer:!1,blending:a.CustomBlending,blendSrc:a.SrcAlphaFactor,blendDst:a.OneFactor};(t=new a.WebGLRenderTarget(i,n,o)).texture.format=a.RGBAFormat}this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===a.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new a.ShaderPass(a.CopyShader)},a.EffectComposer.prototype={swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var t,r,i=!1,n=this.passes.length;for(r=0;r<n;r++)if((t=this.passes[r]).enabled){if(t.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),t.needsSwap){if(i){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}t instanceof a.MaskPass?i=!0:t instanceof a.ClearMaskPass&&(i=!1)}},reset:function(e){if(void 0===e){e=this.renderTarget1.clone();var t=this.renderer.getPixelRatio();e.width=Math.floor(this.renderer.context.canvas.width/t),e.height=Math.floor(this.renderer.context.canvas.height/t)}this.renderTarget1.dispose(),this.renderTarget1=e,this.renderTarget2.dispose(),this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this.renderTarget1.setSize(e,t),this.renderTarget2.setSize(e,t)}},a.ShaderPass=function(e,t){this.textureID=void 0!==t?t:"tDiffuse",this.uniforms=a.UniformsUtils.clone(e.uniforms),this.material=new a.ShaderMaterial({defines:e.defines||{},uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.camera=new a.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new a.Scene,this.quad=new a.Mesh(new a.PlaneBufferGeometry(2,2),null),this.scene.add(this.quad)},a.ShaderPass.prototype={render:function(e,t,r,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)}},a.MaskPass=function(e,t){this.scene=e,this.camera=t,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},a.MaskPass.prototype={render:function(e,t,r,i){var n,o,a=e.context;a.colorMask(!1,!1,!1,!1),a.depthMask(!1),this.inverse?(n=0,o=1):(n=1,o=0),a.enable(a.STENCIL_TEST),a.stencilOp(a.REPLACE,a.REPLACE,a.REPLACE),a.stencilFunc(a.ALWAYS,n,4294967295),a.clearStencil(o),e.render(this.scene,this.camera,r,this.clear),e.render(this.scene,this.camera,t,this.clear),a.colorMask(!0,!0,!0,!0),a.depthMask(!0),a.stencilFunc(a.EQUAL,1,4294967295),a.stencilOp(a.KEEP,a.KEEP,a.KEEP)}},a.ClearMaskPass=function(){this.enabled=!0},a.ClearMaskPass.prototype={render:function(e,t,r,i){var n=e.context;n.disable(n.STENCIL_TEST)}},a.RenderPass=function(e,t,r,i,n){this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=void 0!==n?n:1,this.oldClearColor=new a.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},a.RenderPass.prototype={render:function(e,t,r,i){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha),e.setClearAlpha(0)),e.render(this.scene,this.camera,r,this.clear),this.clearColor&&(e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.setClearAlpha(0)),this.scene.overrideMaterial=null}}}},{}],10:[function(e,t,r){"use strict";t.exports=function(s){var e=function(e){this.vertexShader=["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),this.bloom_multiplier_color=new s.Vector3(1,1,1),this.bloom_falloff_color=new s.Vector3(1,1,1);var t={vertexShader:this.vertexShader,fragmentShader:"#define GLSLIFY 1\nuniform vec2 d0;\nuniform vec2 d1;\nuniform vec2 d2;\nuniform vec2 d3;\nvarying vec2 vUv;\nuniform sampler2D my_color_texture;\nuniform vec2 uv_scale;\nuniform float blurAmount;\n\n#ifdef CUSTOM_COLOR_FUNC\nCUSTOM_COLOR_FUNC\n#else\nvec4 customColorFunc(vec4 c){\n  return clamp(c, 0.0, 60000.0);\n}\n#endif\n\nvoid main()\n{\n\t// blur from four samples\n\tvec4 c = blurAmount*(\n\tcustomColorFunc(texture2D(my_color_texture, (vUv * uv_scale)+d0))+\n\tcustomColorFunc(texture2D(my_color_texture, (vUv * uv_scale)+d1))+\n\tcustomColorFunc(texture2D(my_color_texture, (vUv * uv_scale)+d2))+\n\tcustomColorFunc(texture2D(my_color_texture, (vUv * uv_scale)+d3))\n\t);\n  gl_FragColor=c;\n}\n",uniforms:{blurAmount:{type:"f",value:.29},d0:{type:"v2",value:new s.Vector2(0,0)},d1:{type:"v2",value:new s.Vector2(0,0)},d2:{type:"v2",value:new s.Vector2(0,0)},d3:{type:"v2",value:new s.Vector2(0,0)},my_color_texture:{type:"t",value:null},uv_scale:{type:"v2",value:new s.Vector2(1,1)}}};this.blur1_shader=new s.ShaderMaterial(t),e&&(t.defines={CUSTOM_COLOR_FUNC:e}),this.blur1_first_shader=new s.ShaderMaterial(t),this.plain_draw_shader=new s.ShaderMaterial({vertexShader:this.vertexShader,transparent:!0,fragmentShader:"#define GLSLIFY 1\nvarying vec2 vUv;\nuniform sampler2D my_color_texture;\nuniform vec3 color_multiplier;\nuniform vec2 uv_scale;\n\nvoid main()\n{\n\tgl_FragColor = texture2D(my_color_texture, (vUv * uv_scale)) *vec4(color_multiplier, 1.0) ;\n}\n",uniforms:{color_multiplier:{type:"v3",value:new s.Vector3(1,1,1)},my_color_texture:{type:"t",value:null},uv_scale:{type:"v2",value:new s.Vector2(1,1)}}}),this.enabled=!0,this.needsSwap=!1,this.clear=!1,this.camera=new s.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new s.Scene,this.quad=new s.Mesh(new s.PlaneBufferGeometry(2,2),null),this.scene.add(this.quad),this.downsampled_buffer=[]};return e.prototype={downsample_one:function(e,t,r){t.width==Math.floor(e.width/2)&&t.height==Math.floor(e.height/2)||t.setSize(Math.floor(e.width/2),Math.floor(e.height/2)),(this.quad.material=r).uniforms.d0.value=new s.Vector2(-.75/e.width,-.75/e.height),r.uniforms.d1.value=new s.Vector2(.75/e.width,-.75/e.height),r.uniforms.d2.value=new s.Vector2(-.75/e.width,.75/e.height),r.uniforms.d3.value=new s.Vector2(.75/e.width,.75/e.height),r.uniforms.my_color_texture.value=e,r.uniforms.uv_scale.value.set(!0&e.width?1-1/e.width:1,!0&e.height?1-1/e.height:1),this.renderer.render(this.scene,this.camera,t)},downsample_all:function(e){var t,r=this.downsampled_buffer[0]=e;for(t=1;3<r.width&&3<r.height;++t){if(!this.downsampled_buffer[t]){var i={minFilter:s.LinearFilter,magFilter:s.LinearFilter,type:e.texture.type,stencilBuffer:!1,generateMipmaps:!1};this.downsampled_buffer[t]=new s.WebGLRenderTarget(Math.floor(r.width/2),Math.floor(r.height/2),i)}this.downsample_one(r,this.downsampled_buffer[t],1==t?this.blur1_first_shader:this.blur1_shader),r=this.downsampled_buffer[t]}for(var n=t;t<this.downsampled_buffer.length;)this.downsampled_buffer[t]&&this.downsampled_buffer[t].dispose(),delete this.downsampled_buffer[t],++t;this.downsampled_buffer.length=n},upsample_one:function(e,t){this.quad.material=this.plain_draw_shader,this.plain_draw_shader.uniforms.my_color_texture.value=e,this.plain_draw_shader.uniforms.uv_scale.value.set(t.width/(2*e.width),t.height/(2*e.height));var r=this.renderer.autoClear,i=this.renderer.autoClearColor;this.renderer.autoClear=!1,this.renderer.autoClearColor=!1,this.renderer.render(this.scene,this.camera,t,!1),this.renderer.autoClear=r,this.renderer.autoClearColor=i},upsample_all:function(){this.plain_draw_shader.transparent=!0,this.plain_draw_shader.blending=s.CustomBlending,this.plain_draw_shader.blendSrc=s.OneFactor,this.plain_draw_shader.blendDst=s.OneFactor,this.plain_draw_shader.depthTest=!1,this.plain_draw_shader.depthWrite=!1,this.plain_draw_shader.uniforms.color_multiplier.value=this.bloom_falloff_color;for(var e=this.downsampled_buffer.length-1;1<e;--e)this.upsample_one(this.downsampled_buffer[e],this.downsampled_buffer[e-1]);this.plain_draw_shader.uniforms.color_multiplier.value=this.bloom_multiplier_color,1<this.downsampled_buffer.length&&this.upsample_one(this.downsampled_buffer[1],this.downsampled_buffer[0])},render:function(e,t,r,i,n){this.renderer=e;var o=this.renderer.context,a=e.state.setColorWrite;r.texture.format==s.RGBAFormat&&(e.state.setColorWrite=function(){}),(this.maskActive=n)&&e.context.disable(e.context.STENCIL_TEST),this.downsample_all(r),this.upsample_all(),r.texture.format==s.RGBAFormat&&(o.colorMask(!0,!0,!0,!0),e.state.setColorWrite=a)}},e}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,n=e("three.js"),o=(i=n)&&i.__esModule?i:{default:i};r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rtt=new o.default.WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:o.default.LinearFilter,magFilter:o.default.NearestFilter}),this.rtt.texture.format=o.default.RGBAFormat,this.materialScreen=new o.default.ShaderMaterial({uniforms:{tDiffuse:{type:"t",value:this.rtt}},vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define GLSLIFY 1\nvarying vec2 vUv;\nuniform sampler2D tDiffuse;\n\nvoid main() {\n\n    gl_FragColor = texture2D( tDiffuse, vUv );\n\n}",depthWrite:!1}),this.scene=new o.default.Scene,this.quad=new o.default.Mesh(new o.default.PlaneBufferGeometry(window.innerWidth,window.innerHeight),this.materialScreen),this.quad.position.z=-100,this.scene.add(this.quad)},t.exports=r.default},{"three.js":6}],12:[function(e,t,r){"use strict";var i,n=e("./App"),o=new((i=n)&&i.__esModule?i:{default:i}).default;window.onresize=o.onResize.bind(o),window.onkeyup=o.onKeyUp.bind(o)},{"./App":8}]},{},[12]);
